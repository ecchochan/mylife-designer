import{makeCurtains}from"./curtain.js";import{styler}from"./styler.min.js";const Canvg=canvg.Canvg;var DEBUG=!1,CARDS_PER_PAGE=6,MAX_AUDIO_VOL=.7,WHATSAPP_TEL="+85261404750";const urlParams=decodeURI(window.location.search).replace("?","").split("&").map(e=>e.split("=")).reduce((e,[t,n])=>(e[t]=n,e),{});DEBUG=urlParams.debug;var counter=[0,0,0,0,0],colors="abdfbd,ffcfcd,aecfde,ffdc99,ccffff".split(","),sharable_link,best_type;const get_best_type=()=>{var e=CARDS.filter(e=>e.chosen).map(e=>e),t=e.reduce((e,t)=>(e[t.type]?e[t.type]++:e[t.type]=1)&&e,{});Object.keys(t).forEach(e=>counter[e]=t[e]);var n=e.length,r=document.querySelector("result-description-inner");LOG(t);var a=Array.from(doc.querySelectorAll("row"));a.sort((e,t)=>parseInt(e.getAttribute("data-type"))==parseInt(t.getAttribute("data-type"))?0:parseInt(e.getAttribute("data-type"))>parseInt(t.getAttribute("data-type"))?1:-1),a.forEach((t,r)=>{t.dtype=r,t.score=counter[r],t.querySelector("left h1").innerHTML=parseInt(counter[r]/n*100)+"<span font-smaller>%</span>";var a=t.querySelector(".chosen-history");if(a){var o=e.filter(e=>e.type==r);0==o.length?(a.nextElementSibling.remove(),a.remove()):(a.nextElementSibling.innerHTML="",o.forEach(e=>{var t=doc.createElement("li");t.setAttribute("en",e.name.en),t.setAttribute("zh",e.name.zh),a.nextElementSibling.appendChild(t)}),setLang())}}),a.sort((e,t)=>e.score==t.score?0:e.score<t.score?1:-1),doc.querySelectorAll("left h1").forEach((e,t)=>{var r=parseInt(counter[t]/n*100);e.innerHTML=r+"<span font-smaller>%</span>"}),a.forEach(e=>r.appendChild(e)),r.appendChild(doc.getElementById("result-credit")),best_type=a[0].dtype,document.getElementById("body").setAttribute("best_type",""+best_type);var o=CARDS_TYPES[best_type],i=e.reduce((e,t,n)=>{for(var r=new BigNumber("1"),a=0;a<n;a++)r=r.multipliedBy(encoded_expand_base);return r=r.multipliedBy(t.id),e.plus(r)},new BigNumber("0")).toString(encoded_base);return sharable_link=window.location.origin+"/"+o.code+"-"+current_lang+"?d="+i,LOGT(sharable_link),best_type},hide_footer2=()=>{var e=doc.querySelector("#body .footer2"),t=doc.querySelector("#body .footer3");e.style.opacity=0,t.style.opacity=0,t.style.pointerEvents="none",setTimeout(()=>{},1e3)};function getRandomSubarray(e,t){void 0===t&&(t=e.length);for(var n,r,a=e.slice(0),o=e.length;o--;)n=a[r=Math.floor((o+1)*Math.random())],a[r]=a[o],a[o]=n;var i=a.slice(0,t);for(o=0;i.length<0;)a.push(e[Math.floor(e.length*Math.random())]);return i}function requestFullScreen(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function copyToClipboard(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}finally{document.body.removeChild(t)}}}var pointerEventToXY=function(e){var t={x:0,y:0};if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var n=e.originalEvent?e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]:e.changedTouches[0];t.x=n.pageX,t.y=n.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t.x=e.pageX,t.y=e.pageY);return t};function min(e,t){if(void 0!==t)return e>t?t:e}function max(e,t){return e>t?e:t}document.querySelectorAll(".fullscreen").forEach(e=>{e.addEventListener("click",requestFullScreen),e.addEventListener("touchstart",requestFullScreen)}),Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.sum=function(){return this.reduce((e,t)=>e+t,0)},Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(let e=this.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this[e],this[t]]=[this[t],this[e]]}return this}});const mix=function(e,t,n,r,a){return n-r>0?((n=(n-r)/(a-r))>1&&(n=1),n<0&&(n=0),e*(1-n)+t*n):e};function getLinkWhastapp(e,t){return"https://api.whatsapp.com/send?phone="+e+"&text="+encodeURI(t)}const shuffle=e=>{var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(Math.random()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e},chunks=(e,t)=>{for(var n=[],r=0,a=e.length;r<a;)n.push(e.slice(r,r+=t));return n};var doc=document;const encode=e=>encodeURIComponent(btoa(unescape(encodeURIComponent(e)))),decode=e=>atob(e),hash=e=>btoa(unescape(encodeURIComponent(e))).replace(/^=+|=+$|[\+/]/g,"").substr(0,5),getBgImageDim=e=>{var t=e.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2").split(",")[0],n=new Image;return n.src=t,{width:n.width,height:n.height}};window.getBgImageDim=getBgImageDim;var LOGT_STYLE="padding:0.3em 0.7em;background: #ddd; color: #000;font-weight:900;",LOG=console.log,LOGT=e=>console.log("%c"+e,LOGT_STYLE);function assert(e,t){if(!e)throw t||"Assertion failed"}DEBUG?doc.getElementById("debug").style.display="":doc.getElementById("debug").remove();const BODY_MIN_WIDTH=480,BODY_MAX_WIDTH=480,BODY_MAX_HEIGHT=640,scale_to_fit_parent=()=>{doc.querySelectorAll("[scale-to-fit-parent-width]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-width-middle]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-"+e.clientWidth/2+"px, -"+e.clientHeight/2+"px) scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-width-middle-bottom]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.position="absolute",e.style.transformOrigin="center bottom ",e.style.left="50%",e.style.bottom="0",e.style.transform="translate(-"+e.clientWidth/2+"px, -0px) scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-width-middle-top]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.position="absolute",e.style.transformOrigin="center top ",e.style.left="50%",e.style.top="0",e.style.transform="translate(-"+e.clientWidth/2+"px, -0px) scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-height]").forEach(e=>{var t=e.parentElement.clientHeight/e.clientHeight,n=e.parentElement.clientWidth/e.clientWidth;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"})};function update_vh(){scale_to_fit_parent();let e=window.innerHeight,t=window.innerWidth,n=e,r=t,a=1;r>BODY_MAX_WIDTH?(document.getElementById("body").style.width=BODY_MAX_WIDTH+"px",document.getElementById("body").style.marginLeft=parseInt((r-BODY_MAX_WIDTH)/2)+"px",r=BODY_MAX_WIDTH):(document.getElementById("body").style.width="",document.getElementById("body").style.marginLeft=""),n>BODY_MAX_HEIGHT?(document.getElementById("body").style.height=BODY_MAX_HEIGHT+"px",document.getElementById("body").style.marginTop=parseInt((n-BODY_MAX_HEIGHT)/2)+"px",a=n/BODY_MAX_HEIGHT,n=BODY_MAX_HEIGHT):(document.getElementById("body").style.height="",document.getElementById("body").style.marginTop="",document.getElementById("body").style.transform="",a=1);t/e<.75&&(r=t/a,document.getElementById("body").style.width=r+"px",document.getElementById("body").style.marginLeft=parseInt((t-r)/2)+"px"),document.getElementById("body").style.transform=1==a?"":"scale("+a+")";let o=.01*n,i=.01*r;document.documentElement.style.setProperty("--vh",`${o}px`),document.documentElement.style.setProperty("--vw",`${i}px`),document.documentElement.style.setProperty("--scale",`${a}`),document.documentElement.style.setProperty("--window-height",`${n}px`),document.documentElement.style.setProperty("--window-width",`${r}px`),document.documentElement.style.setProperty("--window-width-for-font",`${mix(400,400,r,330,480)}px`),document.getElementById("zh-title-fix").setAttribute("zh",r<360?"探索\n你的旅程":"探索你的旅程"),setLang(current_lang),window.setLang=setLang,document.querySelectorAll("[full-width-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("width",r):e.style.width=r+"px"}),document.querySelectorAll("[full-height-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("height",n):e.style.height=n+"px"}),window.dispatchEvent(new Event("curtain-resize"))}var onresize=function(e){update_vh()};window.attachEvent?window.attachEvent("onresize",onresize):window.addEventListener&&window.addEventListener("resize",onresize,!0),window.update_vh=update_vh;var userLang=navigator.language||navigator.userLanguage,isChinese=userLang.indexOf("zh")>-1,current_lang=isChinese?"zh":"en";urlParams.lang&&(current_lang=urlParams.lang),doc.getElementById("app").classList.remove("hidden"),FastClick.attach(doc.body);var setLang=function(L){L||(L=current_lang),document.getElementById("body").setAttribute("lang",L),document.querySelectorAll("[en],[zh]").forEach(e=>{var EN=e.attributes.en,ZH=e.attributes.zh;EN&&(EN=EN.value),ZH&&(ZH=ZH.value),("en"==L&&EN||"zh"==L&&!ZH)&&(EN=EN.replace(/\{(.*?)\}/g,r=>e.getAttribute(r.slice(1,-1))||eval(r.slice(1,-1))).replace(/\\n/g,"<br/>").replace(/c/g,"<span fix-c>c</span>"),e._content!=EN&&(e._content=EN,EN.indexOf("<span")>=0||EN.indexOf("<br/>")>=0?e.innerHTML=EN:e.textContent=EN)),("zh"==L&&ZH||"en"==L&&!EN)&&(ZH=ZH.replace(/\{(.*?)\}/g,r=>e.getAttribute(r.slice(1,-1))||eval(r.slice(1,-1))).replace(/\\n/g,"<br/>").replace(/c/g,"<span fix-c>c</span>"),e._content!=ZH&&(e._content=ZH,ZH.indexOf("<span")>=0||ZH.indexOf("<br/>")>=0?e.innerHTML=ZH:e.textContent=ZH))}),window.dispatchEvent(new Event("set-lang"))};doc.addEventListener("DOMContentLoaded",(function(){setLang(current_lang),update_vh()}));var touched=!1;document.querySelectorAll("#lang-switcher > span").forEach(e=>{e.classList.remove("display-none");let t=function(e){"touchstart"==e.type&&(touched=!0),"click"==e.type&&touched||(document.querySelectorAll("#lang-switcher > span").forEach(e=>e.classList.remove("display-none")),this.classList.add("display-none"),setLang(this.getAttribute("data-lang")),current_lang=this.getAttribute("data-lang"))};e.addEventListener("click",t),e.addEventListener("touchstart",t)}),document.querySelector("#lang-switcher > span").classList.add("display-none"),"zh"==current_lang&&document.querySelector("#lang-switcher > span:not([class])").click(),window.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t};var CARDS_RAW="!內在滿足;;Intrinsic satisfaction\n精神層面上的​滿足;;Mentally satisfied\n與神有親密連繫;;Closely connected with God\n持續的認識自我;;Continuous ​self-exploration\n擁有自我內心的​空間;;Have an inner space \n安全感;;Sense of security\n內心的平靜;;Have an inner peace \n新鮮感;;Sense of freshness\n感到自在;;Feel comfortable \n\n!人際關係;;Inter-personal relationship\n擁有自在舒適的​人際關係;;Get a comfortable ​inter-personal ​relationship\n美滿婚姻;;Happy marriage\n有交心知己;;Have best friend forever\n有親近的好朋友;;Have good friends\n親密的家庭;;A close family \n孝順父母;;Filial piety\n和一群人一起打拼;;Work hard with others\n讚賞及鼓勵別人;;Appreciate and ​encourage others\n有意義的愛情;;A meaningful ​love-relationship  \n幫助別人;;Help others\n\n!物質享受;;Materialistic\n有車 / 有樓;;Own a car/house\n賺大錢;;Be wealthy\n時尚的打扮;;Fashionable ​dress up\n錢夠用 ​(沒有經濟上的​擔憂);;Sufficient amount of money ​(without financial burden)\n追上科技潮流;;Catch up on technology   \n建立社會地位;;Have social status\n環遊世界;;Travel around the world\n食盡美食;;Enjoy food\n\n!生活模式;;Life style\n簡簡單單的生活;;Simple life\n參加藝文青活動;;Participate art and ​cultural activities \n親親大自然;;Enjoy nature\n人生充滿樂趣;;Interesting life\n多姿多彩的生活;;Fruitful life\n參與宗教、政治、​社團活動;;Participate in religions, ​politics and/or ​different societies\n什麼事都不做;;Do nothing\n規律的生活;;Regular daily life\n安穩的工作;;Stable job\n享受獨處的時光;;Enjoy being alone \n做自己喜歡的事;;Do what you like\n持續地學習;;Continuous learning \n休息與放鬆;;Rest and relaxing\n運動;;Exercises\n擁有健康;;Be healthy\n長久的生命;;A long life\n為夢想奮鬥;;Work hard on your dream\n冒險與刺激;;Adventure and excitement\n成為眾人焦點;;Be the focus of everyone \n做善事;;Do good deed\n擁有自由;;Have freedom\n做自己;;Be yourself \n生小朋友;;Have kids\n有意義的工作;;A meaningful job\n\n!自我形象;;Self-image \n誠實正直;;Integrity\n心地善良;;Kind-hearted \n公平、公正;;Be fair and impartial \n擁有純潔及​真摯的心;;Be pure and true\n勇於改變;;Dare to Change \n有自信;;Confident\n有正義感;;Have a sense of justice\n義氣仔女;;Be loyal to friends \n腳踏實地;;Be practical and ​down-to-earth\n勇於接受挑戰;;Dare to accept challenge\n努力向上;;Hard-working\n用心/盡力做事;;Do your best on everything\n有美感;;Be aesthetic \n開放性的思維;;Open minded\n寛容;;Tolerance \n廣闊的視野;;Have wide horizon\n獨立自主;;Independence\n有影響力;;Be an influential person\n事業有成;;Successful in your career\n能夠發揮所長;;Able to use your talent\n擁有一己之長;;Have your own talent",SEP=";;",LANGS=["zh","en"],CARDS_NUM_LANGS=LANGS.length,CARDS_TYPES=[],CARDS_ITEMS={},CARDS=[],_bucket=[],_last_type;CARDS_RAW.split("\n").filter(e=>e.trim()).forEach(e=>{var t,n;e.startsWith("!")?(_bucket.length>0&&(CARDS_ITEMS[_last_type]=_bucket),assert((t=e.substr(1).split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),n={id:CARDS_TYPES.length,name:{}},LANGS.forEach((e,r)=>{n.name[e]=t[r]}),n.code=hash(n.name[LANGS[0]]),_last_type=n.id,CARDS_TYPES.push(n)):(assert((t=e.split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),_bucket.push(t),n={id:CARDS.length,name:{},type:_last_type,chosen:!1,droped:!1},LANGS.forEach((e,r)=>{n.name[e]=t[r]}),CARDS.push(n))}),_bucket.length>0&&(CARDS_ITEMS[CARDS_TYPES[CARDS_TYPES.length-1].id]=_bucket);var CARDS_SHUFFLED=CARDS.slice(0);shuffle(CARDS_SHUFFLED);var CARDS_CHUNKS=chunks(CARDS_SHUFFLED,CARDS_PER_PAGE),encoded_base=BigNumber.ALPHABET.length,encoded_expand_base=CARDS.length;const get_decoded=e=>{for(var t=new BigNumber(e,encoded_base),n=[],r=0;r<100;r++){var a=parseInt(t.modulo(encoded_expand_base).toString());if(r>0&&0==a)break;n.push(a),t=t.minus(a).dividedBy(encoded_expand_base)}return n};let d=urlParams.d;if(d)try{let e=get_decoded(d);urlParams.skip=8,e.forEach(e=>CARDS[e].chosen=!0)}catch(e){}const bgs=Array.from(document.querySelectorAll('[id^="selection"] background')).filter(e=>e).map(e=>e.innerHTML),skip=parseInt(urlParams.skip);if(skip){LOGT("Skipping "+skip+" stages");var stages_divs=Array.from(document.getElementById("stages").children);stages_divs.splice(1,skip).forEach(e=>{e.remove()}),document.querySelector("#lang-switcher").classList.add("hidden")}if(urlParams.chosen||urlParams.num_cards){let e=urlParams.type,t=0;urlParams.num_cards=urlParams.num_cards||urlParams.chosen||1,getRandomSubarray(CARDS).forEach(n=>{urlParams.num_cards&&t>=urlParams.num_cards||void 0!==e&&n.type!=e||(n.chosen=!0,t+=1)})}document.querySelectorAll("[data-href]").forEach(e=>e.setAttributeNS("http://www.w3.org/1999/xlink","href",e.getAttribute("data-href")));var files01="\nbg01-bg.jpg\nbg01-branch01.png\nbg01-branch02.png\nbg01-branch03.png\nbg01-branch04.png\nbg01-branch05.png\nbg01-branch06.png\nbg01-branch07.png\nbg01-branch08.png\nbg01-branch09.png\nbg01-branch10.png\nbg01-branch11.png\nbg01-branch12.png\nbg01-branch13.png\nbg01-branch14.png\nbg01-branch15.png\nbg01-branch16.png\nbg01-branch17.png\nbg01-branch18.png\nbg01-greens.png\nbg01-lotus.png\nbg01-wave01.png\nbg01-wave02.png".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files02="\nbg02-bg.jpg\nbg02-cloud-right.png\nbg02-leaf01.png\nbg02-leaf02.png\nbg02-leaf03.png\nbg02-ripples01.png\nbg02-ripples02.png\nbg02-ripples03.png\nbg02-ripples04.png\nbg02-ripples05.png\nbg02-ripples06.png\nbg02-ripples07.png\nbg02-ripples08.png\nbg02-ripples09.png\nbg02-ripples10.png\nbg02-ripples11.png\nbg02-ripples12.png\nbg02-ripples13.png\nbg02-ripples14.png\nbg02-ripples15.png\nbg02-ripples16.png\nbg02-ripples17.png\nbg02-ripples18.png\nbg02-ripples19.png\nbg02-ripples20.png\nbg02-ripples21.png\nbg02-ripples22.png\nbg02-ripples23.png\nbg02-ripples24.png\nbg02-ripples25.png\nbg02-ripples26.png\nbg02-ripples27.png\nbg02-seed.png\nbg02-track.png".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files03="\nbg03-bg.jpg\nbg03-star.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files04="\nbg04-bg.jpg\nbg04-flower01.png\nbg04-flower02.png\nbg04-flower03.png\nbg04-flower04.png\nbg04-flower05.png\nbg04-flower06.png\nbg04-flower07.png\nbg04-flower08.png\nbg04-flower09.png\nbg04-flower10.png\nbg04-flower11.png\nbg04-flower12.png\nbg04-flower13.png\nbg04-flower14.png\nbg04-flower15.png\nbg04-flower17.png\nbg04-flower18.png\nbg04-cloud.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files05="\nbg05-bg.jpg\nbg05-layer01.png\nbg05-layer02.png\nbg05-snow.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files06="\nluggage.jpg\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files07="".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files08="".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files00="\nICYSC.png\ntick-01.png\ntick-02.png\ntick-03.png\ntick-04.png\ntick-05.png\ntick-06.png\ntick-07.png\ntick-08.png\nbuddy-figure-01.png\nbuddy-figure-02.png\nbuddy-figure-03.png\nbuddy-figure-04.png\nbuddy-figure-05.png\nbuddy-figure-06.png\ncloud-bg.png\ncloud01.png\ncloud02.png\ncloud03.png\ncloud04.png\ncontact-button-01.jpg\ncontact-button-02.jpg\ncontact-button-03.jpg\ncontact-button-04.jpg\ncontact-button-05.jpg\ncontact-button-06.jpg\ncontact.jpg\ncover-bg.jpg\ncover-buddy.png\ncover-greens.png\ncover-leaf-01.png\ncover-leaf-02.png\ncover-leaf-03.png\ncover-leaf-04.png\ncover-stamen-01.png\ncover-stamen-02.png\ncover-stamen-03.png\ncover-wave.png\ncover.png\nintro.jpg".split("\n").filter(e=>e).map(e=>"assets/img/"+e),MUSIC_URL="assets/audio/bensound-beyondtheline.mp3",files="\nqr-code.svg\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_1_bgs="\nbg01-card-bg-01.png\nbg01-card-bg-02.png\nbg01-card-bg-03.png\nbg01-card-bg-04.png\nbg01-card-bg-05.png\nbg01-card-bg-06.png\nbg01-card-bg-07.png\nbg01-card-bg-08.png\nbg01-card-bg-09.png\nbg01-card-bg-10.png\nbg01-card-bg-11.png\nbg01-card-bg-12.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_2_bgs="\nbg02-card-bg-01.png\nbg02-card-bg-02.png\nbg02-card-bg-03.png\nbg02-card-bg-04.png\nbg02-card-bg-06.png\nbg02-card-bg-07.png\nbg02-card-bg-08.png\nbg02-card-bg-09.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_3_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_4_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_5_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),cards_bgs=[card_1_bgs,card_2_bgs,card_3_bgs,card_4_bgs,card_5_bgs];const svgs=document.getElementById("svgs");if(cards_bgs.forEach(e=>e.forEach(e=>{var t=document.createElementNS("http://www.w3.org/2000/svg","image");t.setAttributeNS("http://www.w3.org/1999/xlink","href",e),t.setAttribute("id",e.split("/").slice(-1)[0].split(".")[0]),t.setAttribute("width","100px"),t.setAttribute("height","100px"),svgs.appendChild(t)})),skip&&8==skip){var best_type=get_best_type();document.getElementById("body").setAttribute("best_type",""+best_type),files.push.apply(files,[files01,files02,files03,files04,files05][best_type]),LOG(files,best_type)}else files.push.apply(files,files00),files.push.apply(files,files01),files.push.apply(files,files02),files.push.apply(files,files03),files.push.apply(files,files04),files.push.apply(files,files05),files.push.apply(files,files06),files.push.apply(files,files07),files.push.apply(files,files08);const LANDSCAPE_BG="assets/img/desktop-bg.jpg",set_landscape=()=>{var e=0!=window.orientation;void 0===window.orientation&&(e=window.innerHeight<window.innerWidth),e?(document.body.setAttribute("is-landscape",""),document.querySelector("landscape-hint bg image").setAttributeNS("http://www.w3.org/1999/xlink","href",LANDSCAPE_BG)):document.body.removeAttribute("is-landscape")};window.addEventListener("orientationchange",set_landscape,!1),set_landscape(),window.matchMedia("(orientation: portrait)").matches&&document.body.removeAttribute("is-landscape"),window.matchMedia("(orientation: landscape)").matches&&(document.body.setAttribute("is-landscape",""),document.querySelector("landscape-hint bg image").setAttributeNS("http://www.w3.org/1999/xlink","href",LANDSCAPE_BG));var files_loaded=0,files_total=files.length,load_counter=doc.getElementById("load-percent"),load_wrapper=doc.getElementById("loading-wrapper"),files_obj={};window.files_obj=files_obj;var increment_files_loaded=function(e){if(load_counter.textContent=files_total?parseInt(++files_loaded/files_total*100):100,files_obj[e.item.id]=e.result,files_loaded==files_total){LOGT("All assets loaded."),start(),update_vh();const e=(e,t)=>{for(;e&&e.tagName!=t;)e=e.parentElement;return e};document.querySelectorAll("image").forEach(t=>{var n=t.getAttributeNS("http://www.w3.org/1999/xlink","href"),r=files_obj[n];if(r){var a=r,o=t.getAttribute("width"),i=t.getAttribute("height");e(t,"SVG"),i=i?parseFloat(i):i;(o=o?parseFloat(o):o)&&i||(o||t.setAttribute("width",a.width*i/a.height+"px"),i||t.setAttribute("height",a.height*o/a.width+"px"))}})}},preload=new createjs.LoadQueue(!1);preload.setMaxConnections(100),preload.addEventListener("fileload",increment_files_loaded),preload.loadManifest(files),0==files_total&&document.addEventListener("DOMContentLoaded",increment_files_loaded);const id_seen=new Set,makeid=()=>{for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<6;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return id_seen.has(e)?makeid():(id_seen.add(e),e)},prefixes=["-webkit-","-moz-","-o-","-webkit-",""],generate_css=e=>{var t="animation_"+makeid(),n=e.rotate,r=e.opacity,a=e.scale,o=e.translateX,i=e.translateY,s=e.reverse,l=("alternate"==e.direction?[[s?1:0,0],[s?0:1,50],[s?1:0,100]]:[[s?1:0,0],[s?0:1,100]]).map(e=>{var t=e[0],s=e[1],l=[];n&&l.push(`rotate(${n[t]}deg)`),a&&l.push(`scale(${a[t]})`),o&&l.push(`translateX(${o[t]}px)`),i&&l.push(`translateY(${i[t]}px)`);var c=l.join(" ");return s+"%{"+(c?prefixes.map(e=>`${e}transform:${c}`).join(";"):"")+(r?`opacity:${r[t]}`:"")+"}"}).join("");return[t,prefixes.map(e=>`@${e}keyframes ${t}{${l}}`).join("\n")]},EASINGS={linear:"linear",swing:"cubic-bezier(0.5, 0, 0.5, 1)"},apply_css_from_animejs_config=(e,t)=>{var n="animation_"+makeid(),r=generate_css(t),a=r[0],o=r[1];t.duration*=1.5,t.seek*=1.5;var i=EASINGS[t.easing||"linear"],s=prefixes.map(e=>`${e}animation: ${t.duration||0}ms ${i} -${t.seek||0}ms infinite running ${a};`).join(""),l=e.style.transformOrigin;l&&(e.style.webkitTransformOrigin=l,e.style.mozTransformOrigin=l,e.style.msTransformOrigin=l,e.style.oTransformOrigin=l),styler(n,o+`.${n}{${s}}`),e.classList.add(n)},activate_bg_animation=background=>{if(background){var animes=background.querySelectorAll("[anime]");animes.forEach(e=>{var args=eval("("+e.getAttribute("anime")+")"),animation;apply_css_from_animejs_config(e,args)})}},deactivate_bg_animation=e=>{e&&e.querySelectorAll("[anime]").forEach(e=>{e.anime&&anime.remove(e)})};window.deactivate_bg_animation=deactivate_bg_animation;var goNextFade=function(e,t,n){anime({targets:t,opacity:0,duration:750,easing:"easeOutQuad",delay:e,complete:function(e){t.remove(),n()}})},MOUSE={x:0,y:0};function isMouseInBox(e){MOUSE.x=e.pageX,MOUSE.y=e.pageY}document.addEventListener("mousemove",(function(e){isMouseInBox(e)}));var volumeButton=doc.getElementById("volume"),volumeSwitchContainer=volumeButton.querySelector(".switchContainer"),audio=new Howl({src:[MUSIC_URL],loop:!0,html5:!0,volume:MAX_AUDIO_VOL});window.audio=audio,audio.once("load",(function(){audio_canplaythrough=!0,audio_can_start&&playMusic()}));var audio_can_start=!1,audio_canplaythrough=!1,AUDIO_ON=volumeSwitchContainer.classList.contains("switchOn"),ua=window.navigator.userAgent,iOS=!!ua.match(/iPad/i)||!!ua.match(/iPhone/i),webkit=!!ua.match(/WebKit/i),iOSSafari=iOS&&webkit&&!ua.match(/CriOS/i),current_volume=MAX_AUDIO_VOL,setVolume=e=>{Howler.volume(e),current_volume=e},playMusic=()=>{audio.playing()||(Howler.volume(current_volume),audio.play())};window.playMusic=playMusic;var volume_recent=0,toggleMusic=()=>{var e=+new Date;e-volume_recent<300||(volume_recent=e,AUDIO_ON?(AUDIO_ON=!1,setVolume(0),audio.pause(),volumeSwitchContainer.classList.remove("switchOn"),volumeSwitchContainer.classList.add("switchOff")):(AUDIO_ON=!0,setVolume(MAX_AUDIO_VOL),audio.play(),volumeSwitchContainer.classList.add("switchOn"),volumeSwitchContainer.classList.remove("switchOff")))};volumeButton.onclick=toggleMusic,volumeButton.ontouchstart=toggleMusic,function(){var e="hidden";function t(t){var n="visible",r="hidden",a={focus:n,focusin:n,pageshow:n,blur:r,focusout:r,pagehide:r},o=!1;o=(t=t||window.event).type in a?"visible"==a[t.type]:!this[e],LOG(o),o&&AUDIO_ON?audio.play():audio.pause()}e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t,void 0!==document[e]&&t({type:document[e]?"blur":"focus"})}();var start=function(){goNextFade(0,load_wrapper,e=>{LOGT("Load wrapper removed."),skip||(curtains[0].show(),curtains[0].nextClick.push(e=>{}))}),skip&&(curtains[0].show(),curtains[0].endCurtain(!0),deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),setTimeout(update_vh,100),document.getElementById("float-top-right").classList.remove("hidden"),playMusic())};const FADE_DURATION=DEBUG?0:200,defaultNextCutain=e=>[function(){var t=e.obj.querySelector(".curtain-page");deactivate_bg_animation(e.obj.querySelector("background")),t&&(activate_bg_animation(t.querySelector("background")),t.curtain.show(),t.curtain.nextFrame.push(update_vh))},e.opened?0:500],sleep=e=>new Promise((function(t,n){setTimeout(t,DEBUG?0:e)})),timeline=function(e){if(0==e.length)return;var t=0,n=e[0];const r=e=>setTimeout(()=>a(e),n.duration||n[1]||0),a=function(a){var o,i=n.func||n[0]||n;if("function"!=typeof i)throw"timeline contains non-callable elements";o=i(a),(t+=1)<e.length&&(n=e[t],o&&o.then?o.then(e=>r(e)):r())};r()},fadeIn=(e,t)=>{DEBUG||(t=t||FADE_DURATION);var n=anime.timeline({targets:e,delay:anime.stagger(t||FADE_DURATION),easing:"linear"}).add({opacity:1});if(!DEBUG)return n.finished};window.intro_next=function(e){document.querySelector("html").style.background=e.obj.style.background;e.obj;timeline([()=>audio_can_start=!0,()=>audio_canplaythrough?document.getElementById("float-top-right").classList.remove("hidden"):0,()=>document.querySelector("#lang-switcher").classList.add("hidden"),()=>hide_footer2(),()=>sleep(500),()=>playMusic(),()=>sleep(500),()=>deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),()=>fadeIn("#intro-tran-text p",600),()=>sleep(200),defaultNextCutain(e)])};const intro_drags=Array.from(document.querySelectorAll("#intro [drag]")).map(e=>[e,parseInt(e.getAttribute("drag"))]);window.coverUpdate=(e,t,n)=>{intro_drags.forEach(e=>{var t=e[0],r=e[1];t.translateX=-r*n+"px",t.style.transform="translateX("+t.translateX+") scale("+(t.scale||1)+")"})};var current_cards_i=0,recent_touch=0,no_click=!1,current_stage=0;function is_hidden(e){return null===e.offsetParent}const card_click_listener=function(e){var t=!1,n=!1;if(!no_click||"click"!=e.type){var r=pointerEventToXY(e);"touchend"==e.type&&null!==last_start_cursor&&Math.sqrt(Math.pow(r.x-last_start_cursor.x,2)+Math.pow(r.y-last_start_cursor.y,2))>20&&(t=!0,n=last_start_cursor.y<r.y);var a=+new Date;if(!(a-recent_touch<50)){recent_touch=a,last_start_cursor=null;var o=Array.from(doc.querySelectorAll("card"));if(t||o.forEach(e=>{if(!is_hidden(e)){var t=e.getBoundingClientRect();if(!(r.x<t.x||r.y<t.y||r.x>t.x+t.width||r.y>t.y+t.height)){e.classList.toggle("chosen");var n=parseInt(e.id),a=CARDS[n];a.chosen=!a.chosen,n_chosen_at_last+=a.chosen?1:-1,setLang(),window.dispatchEvent(new Event("card-clicked"))}}}),8==current_stage){for(var i=e.target;i&&"RESULT-DESCRIPTION"!=i.tagName;)i=i.parentElement;if(i){var s=document.querySelector("result-container");if(t)if(s.classList.contains("active")){if(!(document.querySelector("result-description").scrollTop<=0&&n))return}else if(n)return;document.querySelector("result-description").scrollTop=0,s.classList.toggle("active"),s.classList.contains("active")?doc.body.setAttribute("float-higher",""):doc.body.removeAttribute("float-higher")}for(i=e.target;i&&"LEARN-MORE"!=i.tagName;)i=i.parentElement;if(i){s=document.getElementById("result");if(t)return;s.classList.toggle("switch"),document.body.classList.toggle("credit")}for(i=e.target;i&&!i.classList.contains("contact-us");)i=i.parentElement;if(i){if(t&&!document.querySelector(".contact-us-opened"))return;for(var l=e.target,c=document.querySelector("popup"),d=c.classList.contains("opened");l&&!l.classList.contains("contact-us-button");)l=l.parentElement;if(!t&&l&&document.querySelector(".contact-us-opened")){var u=c.last_contact_us.getAttribute("contact-us-channel"),p=l.querySelector("p");if(p){var g=p.getAttribute(current_lang+"-text")||p.getAttribute(current_lang),m="";if(m="zh"==current_lang?"我想傾吓"+g.replace(/\\n/g,"")+"。":"I want to talk about "+g+".",m+="\n"+sharable_link,"whatsapp"==u){var h=getLinkWhastapp(WHATSAPP_TEL,m);window.open(h,"_blank").focus()}else if("telegram"==u){var y;h="https://t.me/taliphoneservice";copyToClipboard(m),y="zh"==current_lang?"已將文字信息複製，請在打開 Telegram 後貼上信息！":"Contact message is copied! You can paste it after Telegram is opened!",alert(y),window.open(h,"_blank").focus()}return}}var b,f=doc.getElementById("app").getBoundingClientRect(),_=parseFloat(document.documentElement.style.getPropertyValue("--scale")||1);if(d){var v=c.last_contact_us.getBoundingClientRect();b={x:(v.x+v.width/2-f.x)/_,y:(v.y+v.height/2-f.y)/_},c.style.transition="all 1s cubic-bezier(0.2, 0.9, 0.25, 1)",c.style.clipPath="circle(0% at "+b.x+"px "+b.y+"px)",c.style.webkitClipPath="circle(0% at "+b.x+"px "+b.y+"px)",c.style.pointerEvents="none"}else b={x:(r.x-f.x)/_,y:(r.y-f.y)/_},c.style.transition="",c.style.clipPath="circle(0% at "+b.x+"px "+b.y+"px)",c.style.webkitClipPath="circle(0% at "+b.x+"px "+b.y+"px)",c.offsetHeight,c.style.transition="all 2s cubic-bezier(0.2, 0.9, 0.25, 1)",c.style.clipPath="circle(150% at "+b.x+"px "+b.y+"px)",c.style.webkitClipPath="circle(150% at "+b.x+"px "+b.y+"px)",c.style.pointerEvents="all";c.classList.toggle("opened"),document.getElementById("result").classList.toggle("contact-us-opened"),c.last_contact_us=i}}}}};var last_cursor,last_start_cursor;doc.getElementById("app").addEventListener("touchstart",e=>{last_cursor=pointerEventToXY(e),last_start_cursor=last_cursor,sort_container_cards&&(sort_container_cards_last_scroll_top=sort_container_cards.scrollTop),no_click=!0});var sort_container_cards=document.querySelector("#sort-container cards"),sort_container_cards_last_scroll_top;doc.getElementById("app").addEventListener("touchmove",e=>{if(6==current_stage&&sort_container_cards){e.preventDefault(),e.stopPropagation();var t=pointerEventToXY(e);last_cursor||(last_cursor=t);var n=(t.y-last_cursor.y)/parseFloat(document.documentElement.style.getPropertyValue("--scale")||1);sort_container_cards.scrollTop=sort_container_cards_last_scroll_top-n}}),doc.getElementById("app").addEventListener("click",card_click_listener),doc.getElementById("app").addEventListener("touchend",card_click_listener);var mousedowning=!1;doc.getElementById("app").addEventListener("mousedown",e=>{!no_click&&sort_container_cards&&(last_cursor=pointerEventToXY(e),sort_container_cards_last_scroll_top=sort_container_cards.scrollTop,mousedowning=!0)}),doc.getElementById("app").addEventListener("mouseup",e=>{no_click||(mousedowning=!1,card_click_listener(e))}),doc.getElementById("app").addEventListener("mousemove",e=>{if(!no_click&&mousedowning&&sort_container_cards&&6==current_stage){e.preventDefault(),e.stopPropagation();var t=pointerEventToXY(e);last_cursor||(last_cursor=t);var n=(t.y-last_cursor.y)/parseFloat(document.documentElement.style.getPropertyValue("--scale")||1);sort_container_cards.scrollTop=sort_container_cards_last_scroll_top-n}});const stage_get_arrows=e=>Array.from(e.children).filter(e=>"ARROWS"==e.tagName)[0],move_bg=(e,t,n)=>(LOG("level:",t,"/",n),new Promise((function(r,a){var o=Array.from(e.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelector("bg g");o.translateX="calc((-100% + var(--window-width, 100vw)) / "+n+" * "+t+")",o.style.transform="translateX("+o.translateX+") scale("+(o.scale||1)+")",r()}))),arrange_cards=(e,t,n,r)=>{t=Array.from(t).filter(e=>e.classList.contains("active"));var a=getRandomSubarray(cards_bgs[e]);t.forEach((e,t)=>{var n=e.querySelector("[card-bg]"),r=e.querySelector("use");n.style.display=a[t]?"unset":"none",a[t]&&r.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+a[t].split("/").slice(-1)[0].split(".")[0])});var o=void 0===n?Math.random()>.5:n,i=t.length,s=(o?0:-0)-.125,l=(o?.85:r?.85:.75)+.01*Math.random()-.06,c=(l-s)/i-.12,d=0,u=parseInt(document.documentElement.style.getPropertyValue("--window-width")),p=mix(.075,.1,u,340,480),g=mix(.01,.03,u,340,480),m=.5*mix(.01,.03,u,340,480),h=e=>{var t=Math.random()*p;return d=t,t=t*(1-m)+m,e.style.left=100*t+"%",e.style.right="unset",t},y=(n=e=>{var t=min(p,1-d-p),n=Math.random()*t;n=n*(1-g)+g,e.style.right=100*n+"%",e.style.left="unset"},t.map(e=>e.querySelector("card-text").clientHeight)),b=y.min(),f=y.max(),_=(y=y.map(e=>(((e-b)/f)**2+1)**1.3)).sum();t.forEach((e,r)=>{var a=(y.slice(0,r).sum()+y[r]/2)/_*t.length,i=s+Math.random()*c+.06+a*(c+.12);e.style.top=100*i+"%",(r%2==(o?1:0)?h:n)(e),e.style.pointerEvents="all",e})},hide=e=>{var t=e=>{e.style.pointerEvents="none",anime({targets:e,opacity:0,duration:400,easing:"linear"})};e.forEach?e.forEach(t):t(e)},show=e=>{var t=e=>{e.style.opacity="1",e.style.pointerEvents="all"};e.forEach?e.forEach(t):t(e)},set_card_divs=(e,t)=>{for(var n=CARDS_CHUNKS[t],r=0;r<e.length;r++){var a=e[[r]];if(r>=n.length)a.classList.remove("active");else{var o=n[r];a.classList.add("active"),o.chosen?a.classList.add("chosen"):a.classList.remove("chosen"),a.setAttribute("id",o.id);var i=a.querySelector("p");Object.keys(o.name).forEach(e=>i.setAttribute(e,o.name[e].replace(/ *\u200b/g,"\n"))),setLang(current_lang)}}},wait_for_arrows=e=>{var t=stage_get_arrows(e);return t.style.opacity=1,t.style.transform="translateX(0)",new Promise((function(e,n){var r=n=>{t.removeEventListener("click",r),t.removeEventListener("touchend",r),t.style.opacity=0,e()};t.addEventListener("click",r),t.addEventListener("touchend",r)}))};window.stage_next=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=e.max_i,r=e.card_type,a=Array.from(Array.from(t.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelectorAll("card")),o=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0],i=o.querySelectorAll("p"),s=[];s.push.apply(s,[()=>move_bg(t,0,n),()=>sleep(1500),()=>fadeIn(i,600),()=>sleep(500),()=>wait_for_arrows(t),()=>hide(o)]);for(let e=0;e<n;e++)s.push.apply(s,[()=>hide(a),()=>sleep(500),()=>move_bg(t,e+1,n),()=>sleep(2e3),()=>set_card_divs(a,current_cards_i++),()=>arrange_cards(r,a,e==n-1?!(a.filter(e=>e.classList.contains("active")).length%2==0):void 0,e==n-1||void 0),()=>fadeIn(getRandomSubarray(a)),()=>sleep(800),()=>e==n-1?1:wait_for_arrows(t)]);s.push.apply(s,[defaultNextCutain(e)]),timeline(s)};var n_chosen_at_last=0;window.sort_start=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=[],r=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0].querySelectorAll("p"),a=doc.getElementById("sort-container"),o=a.querySelector("cards");n_chosen_at_last=0;var i=CARDS.filter(e=>e.chosen).map(e=>e),s=i.reduce((e,t)=>(e[t.type]?e[t.type]++:e[t.type]=1)&&e,{});const l=t=>{var n=e.obj.querySelector(".curtain-page");deactivate_bg_animation(e.obj.querySelector("background")),activate_bg_animation(n.querySelector("background")),n_chosen_at_last<=10&&n_chosen_at_last>0?n&&(n.curtain.show(),n.curtain.nextFrame.push(update_vh)):n&&(n.curtain.hide(),n.curtain.nextFrame.push(update_vh))};if(console.log("chosen:",i),console.log("stats:",s),0==i.length)r[0].setAttribute("zh","認真聆聽你內心的聲音，有什麼是你想要的？"),r[0].setAttribute("en","Listen carefully to your inner voice, what do you want?"),r[1].setAttribute("zh","（請最少選擇一張卡）"),r[1].setAttribute("en","(Please choose at least 1 card)"),setLang(),timeline([()=>sleep(1e3),()=>fadeIn(r,600),()=>wait_for_arrows(t),()=>hide(r),()=>window.location="/"]);else if(i.length<=10){var c=e.obj.querySelector(".curtain-page");c.style.display="",c.style.clipPath="",c.style.webkitClipPath="",c.style.opacity=0,c.style.transition="0.5s ease all",c.curtain.finishCurtain(),t.offsetHeight,setTimeout(()=>{c.style.opacity=1,setTimeout(()=>{update_vh()},5)},5)}else timeline([()=>sleep(1e3),()=>fadeIn(r,600),()=>wait_for_arrows(t),()=>hide(r),()=>sleep(500),()=>a.style.display="flex",()=>i.shuffle().forEach(e=>{var t=doc.createElement("card"),r=doc.createElement("card-text"),a=doc.createElement("p");t.classList.add("card-sort"),Object.keys(e.name).forEach(t=>a.setAttribute(t,e.name[t].replace(/ *\u200b/g,"\n"))),t.appendChild(r),r.appendChild(a),e.chosen=!1,t.setAttribute("id",e.id),o.appendChild(t),n.push(t)}),()=>setLang(),()=>{var e=Array.from(document.querySelectorAll(".card-sort"));e.forEach((t,n)=>{n%2!=0&&(t.style.marginTop=e[n-1].clientHeight+50+"px")})},()=>show(a),()=>n.slice(8).forEach(e=>e.style.opacity=1),()=>current_stage=6,()=>fadeIn(doc.querySelectorAll("#sort-container .thin-body p"),600),()=>fadeIn(getRandomSubarray(n.slice(0,8)),200),()=>window.addEventListener("card-clicked",l,!1),()=>l()])};var result_bg_loaded=!1;window.pre_result=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0].querySelectorAll("p");t=doc.getElementById("result"),document.querySelector("html").style.background=t.style.background;var r=get_best_type();document.getElementById("body").setAttribute("best_type",""+r),document.querySelector("html").style.background="#"+colors[r],document.getElementById("result").style.background="#"+colors[r];var a=document.getElementById("result").querySelector("background");a.innerHTML=bgs[r],document.querySelectorAll("[data-href]").forEach(e=>e.setAttributeNS("http://www.w3.org/1999/xlink","href",e.getAttribute("data-href"))),document.getElementById("result-icon").setAttribute("src","assets/img/buddy-figure-0"+(r+1)+".png"),activate_bg_animation(a),result_bg_loaded=!0,setTimeout(()=>Array.from(document.querySelectorAll(".snow")).filter(e=>e.getBoundingClientRect().x>500).forEach(e=>e.style.display="none"),200),setTimeout(()=>Array.from(document.querySelectorAll(".star")).filter(e=>e.getBoundingClientRect().x>500).forEach(e=>e.style.display="none"),200),timeline([()=>sleep(1e3),()=>deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),()=>fadeIn(n,600),defaultNextCutain(e)])},window.show_result=function(e){var t=e.obj;t=doc.getElementById("result"),document.querySelector("html").style.background=t.style.background;var n=t.querySelector("result-container"),r=CARDS.filter(e=>e.chosen).map(e=>e),a=r.reduce((e,t)=>(e[t.type]?e[t.type]++:e[t.type]=1)&&e,{});Object.keys(a).forEach(e=>counter[e]=a[e]);var o=r.length,i=document.querySelector("result-description-inner");if(LOG(a),!result_bg_loaded){var s=Array.from(doc.querySelectorAll("row"));s.sort((e,t)=>parseInt(e.getAttribute("data-type"))==parseInt(t.getAttribute("data-type"))?0:parseInt(e.getAttribute("data-type"))>parseInt(t.getAttribute("data-type"))?1:-1),s.forEach((e,t)=>{e.dtype=t,e.score=counter[t],e.querySelector("left h1").innerHTML=parseInt(counter[t]/o*100)+"<span font-smaller>%</span>";var n=e.querySelector(".chosen-history"),a=r.filter(e=>e.type==t);n&&(0==a.length?(n.nextElementSibling.remove(),n.remove()):(n.nextElementSibling.innerHTML="",a.forEach(e=>{var t=doc.createElement("li");t.setAttribute("en",e.name.en),t.setAttribute("zh",e.name.zh),n.nextElementSibling.appendChild(t)}),setLang()))}),s.sort((e,t)=>e.score==t.score?0:e.score<t.score?1:-1),s.forEach(e=>i.appendChild(e)),i.appendChild(doc.getElementById("result-credit")),best_type=s[0].dtype,document.getElementById("body").setAttribute("best_type",""+best_type);var l=CARDS_TYPES[best_type];document.querySelector("html").style.background="#"+colors[best_type],document.getElementById("result").style.background="#"+colors[best_type];var c=document.getElementById("result").querySelector("background");c.innerHTML=bgs[best_type],document.querySelectorAll("[data-href]").forEach(e=>e.setAttributeNS("http://www.w3.org/1999/xlink","href",e.getAttribute("data-href"))),document.getElementById("result-icon").setAttribute("src","assets/img/buddy-figure-0"+(best_type+1)+".png"),activate_bg_animation(c),setTimeout(()=>Array.from(document.querySelectorAll(".snow")).filter(e=>e.getBoundingClientRect().x>500).forEach(e=>e.style.display="none"),200),setTimeout(()=>Array.from(document.querySelectorAll(".star")).filter(e=>e.getBoundingClientRect().x>500).forEach(e=>e.style.display="none"),200);var d=r.reduce((e,t,n)=>{for(var r=new BigNumber("1"),a=0;a<n;a++)r=r.multipliedBy(encoded_expand_base);return r=r.multipliedBy(t.id),e.plus(r)},new BigNumber("0")).toString(encoded_base);sharable_link=window.location.origin+"/"+l.code+"-"+current_lang+"?d="+d,LOGT(sharable_link)}var u=doc.getElementsByClassName("donut");const p=()=>{i.style.height="",Array.from(document.querySelectorAll("result-description-inner > *")).forEach(e=>e.style.height=""),i.style.height=Array.from(document.querySelectorAll("result-description-inner > *")).map(e=>e.clientHeight).sum()+"px"};window.addEventListener("set-lang",p),timeline([()=>sleep(1e3),()=>show(n),()=>(()=>{var e={targets:Array.from(u).map(e=>e.querySelector("circle")),easing:"easeInOutQuint",duration:3e3,"stroke-dashoffset":function(e,t,n){return[879.645943005142,879.645943005142*(1-(counter[t]-0)/o)]}};anime(e);var t=45*Math.random();anime({targets:u,easing:"easeInOutQuint",opacity:[0,1],rotate:function(e,n,r){return[-450-t,-90-t+(0==n?0:360*counter.slice(0,n).sum()/o)]},duration:3e3})})(),()=>sleep(2e3),()=>doc.querySelector("result-description").classList.add("active"),()=>doc.querySelector("learn-more").classList.add("active"),()=>p(),()=>current_stage=8,()=>sleep(3500)])};var curtains=makeCurtains(doc.getElementById("stages"));skip&&(current_cards_i=[0,0,3,6,8,10,12][skip],hide_footer2()),setInterval(update_vh,4e3);const generate_result=()=>{const e=document.createElement("canvas");e.width=630,e.height=1260,LOG(e);const t=e.getContext("2d");var n=Array.from(document.querySelectorAll("dounut-container > svg")).map(e=>e.cloneNode(!0)),r=n[0].querySelector("circle");r.removeAttribute("style"),r.removeAttribute("class"),r.setAttribute("cy","180"),LOG(best_type);var a=new createjs.LoadQueue(!0,null,!0);a.setMaxConnections(100);var o=`result-0${best_type+1}.jpg`,i=`buddy-figure-0${best_type+1}.png`;a.loadManifest(["/assets/img/"+o,"/assets/img/"+i]);var s=new QRious({value:sharable_link,size:60,level:"H",backgroundAlpha:0}).toDataURL(),l=new QRious({value:sharable_link,size:60,foreground:"white",level:"H",backgroundAlpha:0}).toDataURL();LOG(s),LOG(l),a.addEventListener("complete",s=>{var l=URL.createObjectURL(a.getResult("/assets/img/"+o,!0)),c=URL.createObjectURL(a.getResult("/assets/img/"+i,!0)),d='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 315 630">\n    <image x="0px" y="0px" width="315px" height="630px" xlink:href="'+l+'" >\n    </image>\n    ';d+=r.outerHTML+"\n",n.slice(1).forEach(e=>{var t=e.querySelector("circle");t.removeAttribute("class"),t.setAttribute("cy","180"),t.setAttribute("style","transform:"+e.style.transform+";transform-origin: 157.5px 180px; "),d+=t.outerHTML+"\n"}),d+='\n    <rect fill="#fff" x="31.5" y="54" clip-path="url(#circle-inner)" width="252px" height="252px" ></rect>\n    <image x="31.5" y="54" clip-path="url(#circle-inner)" width="252px" height="252px" xlink:href="'+c+'" \n    preserveAspectRatio="xMinYMin slice" >\n    </image>\n    <clipPath id="circle-inner">\n        <circle id="dounut-5" cx="50%" cy="180" r="124" ></circle>\n    </clipPath>\n    \n    <image x="31.5" y="154" width="252px" height="252px" xlink:href="'+c+'" \n    preserveAspectRatio="xMinYMin slice" >\n    </image>\n    \n    \n    ',LOG(d+="</svg>"),canvg.Canvg.fromString(t,d).start(),setTimeout(()=>{var t=e.toDataURL("image/png"),n=document.createElement("a");n.download="result",n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},100)})};window.generate_result=generate_result,setInterval(update_vh,4e3),setTimeout(e=>{document.querySelector(".font_preload").classList.add("tick")},1e3);