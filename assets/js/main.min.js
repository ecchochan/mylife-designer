import{makeCurtains}from"./curtain.js";import{styler}from"./styler.min.js";var DEBUG=!1,CARDS_PER_PAGE=6,NUM_SCENES=4,MAX_AUDIO_VOL=.5,OPACITY={EASING:"easeOutQuad",DURATION:500},TRANSITION={EASING:"easeOutQuart",DURATION:500};const urlParams=Object.fromEntries(new URLSearchParams(window.location.search));function requestFullScreen(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function min(e,t){if(void 0!==t)return e>t?t:e}function max(e,t){return e>t?e:t}console.log(urlParams),DEBUG=urlParams.debug,document.querySelectorAll(".fullscreen").forEach(e=>{e.addEventListener("click",requestFullScreen),e.addEventListener("touchstart",requestFullScreen)}),Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.sum=function(){return this.reduce((e,t)=>e+t,0)};const mix=function(e,t,n,a,o){return n-a>0?((n=(n-a)/(o-a))>1&&(n=1),n<0&&(n=0),e*(1-n)+t*n):e},shuffle=e=>{var t,n,a;for(a=e.length-1;a>0;a--)t=Math.floor(Math.random()*(a+1)),n=e[a],e[a]=e[t],e[t]=n;return e},chunks=(e,t)=>{for(var n=[],a=0,o=e.length;a<o;)n.push(e.slice(a,a+=t));return n};var doc=document;const encode=e=>encodeURIComponent(btoa(unescape(encodeURIComponent(e))));window.encode=encode;const decode=e=>atob(e);window.decode=decode;const hash=e=>btoa(unescape(encodeURIComponent(e))).replace(/^=+|=+$|[\+/]/g,"").substr(0,5);window.hash=hash;const getBgImageDim=e=>{var t=e.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2").split(",")[0],n=new Image;return n.src=t,{width:n.width,height:n.height}};window.getBgImageDim=getBgImageDim;var LOGT_STYLE="padding:0.3em 0.7em;background: #ddd; color: #000;font-weight:900;",LOG=console.log,LOGT=e=>console.log("%c"+e,LOGT_STYLE);function assert(e,t){if(!e)throw t||"Assertion failed"}DEBUG?doc.getElementById("debug").style.display="":doc.getElementById("debug").remove();const skip=parseInt(urlParams.skip);if(skip){LOGT("Skipping "+skip+" stages");var stages_divs=Array.from(document.getElementById("stages").children);stages_divs.splice(1,skip).forEach(e=>{LOG(e),e.remove()})}const BODY_MIN_WIDTH=480,BODY_MAX_WIDTH=480,BODY_MAX_HEIGHT=640,scale_to_fit_parent=()=>{doc.querySelectorAll("[scale-to-fit-parent-width]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-height]").forEach(e=>{var t=e.parentElement.clientHeight/e.clientHeight,n=e.parentElement.clientWidth/e.clientWidth;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"})};function update_vh(){scale_to_fit_parent();let e=window.innerHeight,t=window.innerWidth,n=e,a=t,o=1;a>BODY_MAX_WIDTH?(document.getElementById("body").style.width=BODY_MAX_WIDTH+"px",document.getElementById("body").style.marginLeft=parseInt((a-BODY_MAX_WIDTH)/2)+"px",a=BODY_MAX_WIDTH):(document.getElementById("body").style.width="",document.getElementById("body").style.marginLeft=""),n>BODY_MAX_HEIGHT?(document.getElementById("body").style.height=BODY_MAX_HEIGHT+"px",document.getElementById("body").style.marginTop=parseInt((n-BODY_MAX_HEIGHT)/2)+"px",o=n/BODY_MAX_HEIGHT,n=BODY_MAX_HEIGHT):(document.getElementById("body").style.height="",document.getElementById("body").style.marginTop="",document.getElementById("body").style.transform="",o=1);t/e<.75&&(a=t/o,document.getElementById("body").style.width=a+"px",document.getElementById("body").style.marginLeft=parseInt((t-a)/2)+"px"),document.getElementById("body").style.transform=1==o?"":"scale("+o+")";let r=.01*n,i=.01*a;document.documentElement.style.setProperty("--vh",`${r}px`),document.documentElement.style.setProperty("--vw",`${i}px`),document.documentElement.style.setProperty("--scale",`${o}`),document.documentElement.style.setProperty("--window-height",`${n}px`),document.documentElement.style.setProperty("--window-width",`${a}px`),document.documentElement.style.setProperty("--window-width-for-font",`${mix(400,460,a,330,480)}px`),document.getElementById("zh-title-fix").setAttribute("zh",a<360?"探索\n你的旅程":"探索你的旅程"),setLang(current_lang),document.querySelectorAll("[full-width-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("width",a):e.style.width=a+"px"}),document.querySelectorAll("[full-height-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("height",n):e.style.height=n+"px"}),window.dispatchEvent(new Event("curtain-resize"))}var onresize=function(e){update_vh()};window.attachEvent?window.attachEvent("onresize",onresize):window.addEventListener&&window.addEventListener("resize",onresize,!0),window.update_vh=update_vh;var userLang=navigator.language||navigator.userLanguage,isChinese=userLang.indexOf("zh")>-1,current_lang=isChinese?"zh":"en";doc.getElementById("app").classList.remove("hidden"),FastClick.attach(doc.body);var setLang=function(e){document.getElementById("body").setAttribute("lang",e),document.querySelectorAll("[en],[zh]").forEach(t=>{var n=t.attributes.en,a=t.attributes.zh;n&&(n=n.value),a&&(a=a.value),("en"==e&&n||"zh"==e&&!a)&&(t.textContent=n),("zh"==e&&a||"en"==e&&!n)&&(t.textContent=a)})};doc.addEventListener("DOMContentLoaded",(function(){setLang(current_lang),update_vh()})),DEBUG&&(document.querySelectorAll("#lang-switcher > span").forEach(e=>{e.classList.remove("display-none");let t=function(e){document.querySelectorAll("#lang-switcher > span").forEach(e=>e.classList.remove("display-none")),this.classList.add("display-none"),setLang(this.textContent),current_lang=this.textContent};e.addEventListener("click",t),e.addEventListener("touchstart",t)}),document.querySelector("#lang-switcher > span").classList.add("display-none"),"zh"==current_lang&&document.querySelector("#lang-switcher > span:not([class])").click()),window.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t};var CARDS_RAW="!內在滿足;;Intrinsic satisfaction\n精神層面上的​滿足;;Mentally Satisfied\n與神有親密連繫;;Closely connected with God\n持續的認識自我;;Continuous ​self-exploration\n擁有自我內心的​空間;;Have an inner space \n安全感;;Sense of secure\n內心的平靜;;Have an inner peace \n新鮮感;;Sense of freshness\n感到自在;;Feel comfortable \n\n!人際關係;;Inter-personal relationship\n擁有自在舒適的​人際關係;;Got a comfortable ​inter-personal ​relationship\n美滿婚姻;;Happy marriage\n有交心知己;;Have Best Friend Forever\n有親近的好朋友;;Have good friends\n親密的家庭;;A close family \n孝順父母;;Filial Piety\n和一群人一起打拼;;Work hard with others\n讚賞及鼓勵別人;;Appreciate and ​encourage others\n有意義的愛情;;A meaningful ​love-relationship  \n幫助別人;;Help others\n\n!物質享受;;Materialistic\n有車 / 有樓;;Own a Car/House\n賺大錢;;Be wealthy\n時尚的打扮;;Fashionable ​dress up\n錢夠用 ​(沒有經濟上的​擔憂);;Sufficient amount of money ​(without financial burden)\n追上科技潮流;;Catch up on technology   \n建立社會地位;;Have social status\n環遊世界;;Travel around the world\n食盡美食;;Enjoy food\n\n!生活模式;;Life style\n簡簡單單的生活;;Simple life\n參加藝文青活動;;Participate art and ​cultural activities \n親親大自然;;Enjoy nature\n人生充滿樂趣;;Interesting life\n多姿多彩的生活;;Fruitful life\n參與宗教、政治、​社團活動;;Participate in religions, ​politics and/or ​different societies\n什麼事都不做;;Do nothing\n規律的生活;;Regular daily life\n安穩的工作;;Stable job\n享受獨處的時光;;Enjoy being alone \n做自己喜歡的事;;Do what you like\n持續地學習;;Continuous learning \n休息與放鬆;;Rest and relaxing\n運動;;Exercises\n擁有健康;;Be healthy\n長久的生命;;A long life\n為夢想奮鬥;;Work hard on your dream\n冒險與刺激;;Adventure and excitement\n成為眾人焦點;;Be the focus of everyone \n做善事;;Do good deed\n擁有自由;;Have freedom\n做自己;;Be yourself \n生小朋友;;Have kids\n有意義的工作;;A meaningful job\n\n!自我形象;;Self-image \n誠實正直;;Integrity\n心地善良;;Kind-hearted \n公平、公正;;Be fair and impartial \n擁有純潔及​真摯的心;;Be pure and true\n勇於改變;;Dare to Change \n有自信;;Confident\n有正義感;;Have a sense of justice\n義氣仔女;;Be loyal to friends \n腳踏實地;;Be practical and ​down-to-earth\n勇於接受挑戰;;Dare to accept challenge\n努力向上;;Hard-working\n用心/盡力做事;;Do your best on everything\n有美感;;Be aesthetic \n開放性的思維;;Open minded\n寛容;;Tolerance \n廣闊的視野;;Have wide horizon\n獨立自主;;Independence\n有影響力;;Be an influential person\n事業有成;;Successful in your career\n能夠發揮所長;;Able to use your talent\n擁有一己之長;;Have your own talent",SEP=";;",LANGS=["zh","en"],CARDS_NUM_LANGS=LANGS.length,CARDS_TYPES=[],CARDS_ITEMS={},CARDS=[],_bucket=[],_last_type;CARDS_RAW.split("\n").filter(e=>e.trim()).forEach(e=>{var t,n;e.startsWith("!")?(_bucket.length>0&&(CARDS_ITEMS[_last_type]=_bucket),assert((t=e.substr(1).split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),n={id:CARDS_TYPES.length,name:{}},LANGS.forEach((e,a)=>{n.name[e]=t[a]}),n.code=hash(n.name[LANGS[0]]),_last_type=n.id,CARDS_TYPES.push(n)):(assert((t=e.split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),_bucket.push(t),n={id:CARDS.length,name:{},type:_last_type,chosen:!1,droped:!1},LANGS.forEach((e,a)=>{n.name[e]=t[a]}),CARDS.push(n))}),_bucket.length>0&&(CARDS_ITEMS[CARDS_TYPES[CARDS_TYPES.length-1].id]=_bucket);var CARDS_SHUFFLED=CARDS.slice(0);shuffle(CARDS_SHUFFLED);var CARDS_CHUNKS=chunks(CARDS_SHUFFLED,CARDS_PER_PAGE);console.log(CARDS_TYPES),window.CARDS=CARDS,window.CARDS_TYPES=CARDS_TYPES,window.CARDS_ITEMS=CARDS_ITEMS,window.CARDS_SHUFFLED=CARDS_SHUFFLED,window.CARDS_CHUNKS=CARDS_CHUNKS;var MUSIC_URL="https://www.bensound.com/bensound-music/bensound-beyondtheline.mp3",files="\ncover-bg.jpg\ncover.png\ncover-leaf-01.png\ncover-leaf-02.png\ncover-leaf-03.png\ncover-leaf-04.png\ncloud01.png\ncloud02.png\ncloud03.png\ncloud04.png\nbg01-bg.jpg\nbg01-branch01.png\nbg01-branch02.png\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),files_loaded=0,files_total=files.length,load_counter=doc.getElementById("load-percent"),load_wrapper=doc.getElementById("loading-wrapper"),increment_files_loaded=function(){load_counter.textContent=files_total?parseInt(++files_loaded/files_total*100):100,files_loaded==files_total&&(LOGT("All assets loaded."),start(),update_vh())};files.forEach(e=>loadjs(e,increment_files_loaded)),0==files_total&&document.addEventListener("DOMContentLoaded",increment_files_loaded);const id_seen=new Set,makeid=()=>{for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<6;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return id_seen.has(e)?makeid():(id_seen.add(e),e)},prefixes=["-webkit-","-moz-","-o-","-webkit-",""],generate_css=e=>{var t="animation_"+makeid(),n=e.rotate,a=e.opacity,o=e.scale,r=e.translateX,i=e.translateY,s=[[0,0],[1,50],[0,100]].map(e=>{var t=e[0],s=e[1],l=[];n&&l.push(`rotate(${n[t]}deg)`),o&&l.push(`scale(${o[t]})`),r&&l.push(`translateX(${r[t]}px)`),i&&l.push(`translateY(${i[t]}px)`);var c=l.join(" ");return s+"%{"+(c?prefixes.map(e=>`${e}transform:${c}`).join(";"):"")+(a?`opacity:${a[t]}`:"")+"}"}).join("");return[t,prefixes.map(e=>`@${e}keyframes ${t}{${s}}`).join("\n")]},apply_css_from_animejs_config=(e,t)=>{var n="animation_"+makeid(),a=generate_css(t),o=a[0],r=a[1];t.duration*=1.5;var i=prefixes.map(e=>`${e}animation: ${t.duration||0}ms cubic-bezier(0.5, 0, 0.5, 1) -${t.seek||0}ms infinite running ${o};`).join(""),s=e.style.transformOrigin;s&&(e.style.webkitTransformOrigin=s,e.style.mozTransformOrigin=s,e.style.msTransformOrigin=s,e.style.oTransformOrigin=s),styler(n,r+`.${n}{${i}}`),e.classList.add(n)},activate_bg_animation=background=>{if(background){var animes=background.querySelectorAll("[anime]");animes.forEach(e=>{var args=eval("("+e.getAttribute("anime")+")"),animation;apply_css_from_animejs_config(e,args)})}},deactivate_bg_animation=e=>{e.querySelectorAll("[anime]").forEach(e=>{e.anime&&anime.remove(e)})};window.deactivate_bg_animation=deactivate_bg_animation;var goNextFade=function(e,t,n){anime({targets:t,opacity:0,duration:750,easing:"easeOutQuad",delay:e,complete:function(e){t.remove(),n()}})},MOUSE={x:0,y:0};function isMouseInBox(e){MOUSE.x=e.pageX,MOUSE.y=e.pageY}document.addEventListener("mousemove",(function(e){isMouseInBox(e)}));var volumeButton=doc.getElementById("volume"),volumeSwitchContainer=volumeButton.querySelector(".switchContainer"),audio,AUDIO_ON=volumeSwitchContainer.classList.contains("switchOn"),setVolume=e=>{anime({targets:audio,volume:e,duration:500,easing:"easeOutQuad"})},playMusic=()=>{audio||((audio=new Audio(MUSIC_URL)).volume=MAX_AUDIO_VOL),audio.play()},toggleMusic=()=>{AUDIO_ON?(AUDIO_ON=!1,setVolume(0),volumeSwitchContainer.classList.remove("switchOn"),volumeSwitchContainer.classList.add("switchOff")):(AUDIO_ON=!0,setVolume(MAX_AUDIO_VOL),volumeSwitchContainer.classList.add("switchOn"),volumeSwitchContainer.classList.remove("switchOff"),playMusic())};volumeButton.onclick=toggleMusic,volumeButton.ontouchstart=toggleMusic;var start=function(){goNextFade(0,load_wrapper,e=>{LOGT("Load wrapper removed."),skip||curtains[0].show()}),skip&&(curtains[0].show(),curtains[0].endCurtain(!0),deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),activate_bg_animation(doc.getElementById("intro").querySelectorAll("background")[1]),setTimeout(update_vh,100))};const FADE_DURATION=DEBUG?0:800,defaultNextCutain=e=>[function(){var t=e.obj.querySelector(".curtain-page");deactivate_bg_animation(e.obj.querySelector("background")),activate_bg_animation(t.querySelector("background")),t&&(t.curtain.show(),t.curtain.nextFrame.push(update_vh))},e.opened?0:500],sleep=e=>new Promise((function(t,n){setTimeout(t,DEBUG?0:e)}));var cardSelectionTemplate=doc.getElementById("selection-1");const timeline=function(e){if(0==e.length)return;var t=0,n=e[0];const a=e=>setTimeout(()=>o(e),n.duration||n[1]||0),o=function(o){var r,i=n.func||n[0]||n;if("function"!=typeof i)throw"timeline contains non-callable elements";r=i(o),(t+=1)<e.length&&(n=e[t],r&&r.then?r.then(e=>a(e)):a())};a()},fadeIn=e=>{LOG("fade",e);var t=anime.timeline({targets:e,delay:anime.stagger(FADE_DURATION),easing:"linear"}).add({opacity:1});if(!DEBUG)return t.finished};window.intro_next=function(e){e.obj;timeline([()=>document.getElementById("float-top-right").classList.remove("hidden"),()=>sleep(500),()=>playMusic(),()=>sleep(1e3),()=>deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),()=>fadeIn("#intro-tran-text p"),defaultNextCutain(e)])};const intro_drags=Array.from(document.querySelectorAll("#intro [drag]")).map(e=>[e,parseInt(e.getAttribute("drag"))]);window.coverUpdate=(e,t,n)=>{intro_drags.forEach(e=>{var t=e[0],a=e[1];t.translateX=-a*n+"px",t.style.transform="translateX("+t.translateX+") scale("+(t.scale||1)+")"})};var current_cards_i=0;const card_click_listener=function(e){for(var t=e.target;t&&"CARD"!=t.tagName;)t=t.parentElement;if(t){t.classList.toggle("chosen");var n=parseInt(t.id),a=CARDS[n];a.chosen=!a.chosen}};doc.getElementById("app").addEventListener("click",card_click_listener),doc.getElementById("app").addEventListener("touchstart",card_click_listener);const stage_get_arrows=e=>Array.from(e.children).filter(e=>"ARROWS"==e.tagName)[0],move_bg=(e,t,n)=>(console.log("level:",t,"/",n),new Promise((function(a,o){var r=Array.from(e.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelector("bg g");r.translateX="calc((-100% + var(--window-width, 100vw)) / "+n+" * "+t+")",r.style.transform="translateX("+r.translateX+") scale("+(r.scale||1)+")",a()}))),arrange_cards=(e,t,n)=>{e=Array.from(e).filter(e=>e.classList.contains("active"));var a=void 0===t?Math.random()>.5:t,o=e.length,r=(a?0:-0)-.125,i=(a?.85:n?.85:.75)+.01*Math.random()-.06,s=(i-r)/o-.12,l=0,c=parseInt(document.documentElement.style.getPropertyValue("--window-width")),d=mix(.075,.1,c,340,480),u=mix(.01,.075,c,340,480),m=.5*mix(.01,.075,c,340,480),g=e=>{var t=Math.random()*d;return l=t,t=t*(1-m)+m,e.style.left=100*t+"%",e.style.right="unset",t},p=(t=e=>{var t=min(d,1-l-d),n=Math.random()*t;n=n*(1-u)+u,e.style.right=100*n+"%",e.style.left="unset"},e.map(e=>e.querySelector("card-text").clientHeight)),h=p.min(),f=p.max(),y=(p=p.map(e=>(((e-h)/f)**2+1)**1.3)).sum();e.forEach((n,o)=>{var i=(p.slice(0,o).sum()+p[o]/2)/y*e.length,l=r+Math.random()*s+.06+i*(s+.12);n.style.top=100*l+"%",(o%2==(a?1:0)?g:t)(n),n.style.pointerEvents="all",n})},hide=e=>{var t=e=>{e.style.opacity="0",e.style.pointerEvents="none"};e.forEach?e.forEach(t):t(e)},show=e=>{var t=e=>{e.style.opacity="1",e.style.pointerEvents="all"};e.forEach?e.forEach(t):t(e)},set_card_divs=(e,t)=>{for(var n=CARDS_CHUNKS[t],a=0;a<e.length;a++){var o=e[[a]];if(a>=n.length)o.classList.remove("active");else{var r=n[a];o.classList.add("active"),r.chosen?o.classList.add("chosen"):o.classList.remove("chosen"),o.setAttribute("id",r.id);var i=o.querySelector("p");Object.keys(r.name).forEach(e=>i.setAttribute(e,r.name[e].replace(/ *\u200b/g,"\n"))),setLang(current_lang)}}},wait_for_arrows=e=>{var t=stage_get_arrows(e);return t.style.opacity=1,t.style.transform="translateX(0)",new Promise((function(e,n){var a=n=>{t.removeEventListener("click",a),t.removeEventListener("touchend",a),t.style.opacity=0,e()};t.addEventListener("click",a),t.addEventListener("touchend",a)}))};window.stage_next=function(e){var t=e.obj,n=e.max_i,a=Array.from(t.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelectorAll("card"),o=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0],r=o.querySelectorAll("p"),i=[];i.push.apply(i,[()=>sleep(1500),()=>fadeIn(r),()=>sleep(500),()=>wait_for_arrows(t),()=>hide(o)]);for(let e=0;e<n;e++)i.push.apply(i,[()=>hide(a),()=>sleep(500),()=>move_bg(t,e+1,n),()=>sleep(2e3),()=>set_card_divs(a,current_cards_i++),()=>arrange_cards(a,e==n-1?!(Array.from(a).filter(e=>e.classList.contains("active")).length%2==0):void 0,e==n-1||void 0),()=>fadeIn(a),()=>sleep(1500),()=>e==n-1?1:wait_for_arrows(t)]);i.push.apply(i,[defaultNextCutain(e)]),timeline(i)},window.sort_start=function(e){e.obj;timeline([()=>fadeIn("#intro-tran-text p"),defaultNextCutain(e)])};var curtains=makeCurtains(doc.getElementById("stages"));activate_bg_animation(doc.getElementById("intro").querySelector("background")),skip&&(current_cards_i=[0,0,3,6,8,10,12][skip],LOG("current_cards_i",current_cards_i));