import{makeCurtains}from"./curtain.js";import{styler}from"./styler.min.js";var DEBUG=!1,CARDS_PER_PAGE=6,NUM_SCENES=4,MAX_AUDIO_VOL=.5,OPACITY={EASING:"easeOutQuad",DURATION:500},TRANSITION={EASING:"easeOutQuart",DURATION:500};const urlParams=Object.fromEntries(new URLSearchParams(window.location.search));function getRandomSubarray(e,t){void 0===t&&(t=e.length);for(var n,a,r=e.slice(0),o=e.length;o--;)n=r[a=Math.floor((o+1)*Math.random())],r[a]=r[o],r[o]=n;var i=r.slice(0,t);for(o=0;i.length<0;)r.push(e[Math.floor(e.length*Math.random())]);return i}function requestFullScreen(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}DEBUG=urlParams.debug;var pointerEventToXY=function(e){var t={x:0,y:0};if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var n=e.originalEvent?e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]:e.changedTouches[0];t.x=n.pageX,t.y=n.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t.x=e.pageX,t.y=e.pageY);return t};function min(e,t){if(void 0!==t)return e>t?t:e}function max(e,t){return e>t?e:t}document.querySelectorAll(".fullscreen").forEach(e=>{e.addEventListener("click",requestFullScreen),e.addEventListener("touchstart",requestFullScreen)}),Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.sum=function(){return this.reduce((e,t)=>e+t,0)},Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(let e=this.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this[e],this[t]]=[this[t],this[e]]}return this}});const mix=function(e,t,n,a,r){return n-a>0?((n=(n-a)/(r-a))>1&&(n=1),n<0&&(n=0),e*(1-n)+t*n):e},shuffle=e=>{var t,n,a;for(a=e.length-1;a>0;a--)t=Math.floor(Math.random()*(a+1)),n=e[a],e[a]=e[t],e[t]=n;return e},chunks=(e,t)=>{for(var n=[],a=0,r=e.length;a<r;)n.push(e.slice(a,a+=t));return n};var doc=document;const encode=e=>encodeURIComponent(btoa(unescape(encodeURIComponent(e))));window.encode=encode;const decode=e=>atob(e);window.decode=decode;const hash=e=>btoa(unescape(encodeURIComponent(e))).replace(/^=+|=+$|[\+/]/g,"").substr(0,5);window.hash=hash;const getBgImageDim=e=>{var t=e.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2").split(",")[0],n=new Image;return n.src=t,{width:n.width,height:n.height}};window.getBgImageDim=getBgImageDim;var LOGT_STYLE="padding:0.3em 0.7em;background: #ddd; color: #000;font-weight:900;",LOG=console.log,LOGT=e=>console.log("%c"+e,LOGT_STYLE);function assert(e,t){if(!e)throw t||"Assertion failed"}DEBUG?doc.getElementById("debug").style.display="":doc.getElementById("debug").remove();const skip=parseInt(urlParams.skip);if(skip){LOGT("Skipping "+skip+" stages");var stages_divs=Array.from(document.getElementById("stages").children);stages_divs.splice(1,skip).forEach(e=>{e.remove()})}const BODY_MIN_WIDTH=480,BODY_MAX_WIDTH=480,BODY_MAX_HEIGHT=640,scale_to_fit_parent=()=>{doc.querySelectorAll("[scale-to-fit-parent-width]").forEach(e=>{var t=e.parentElement.clientWidth/e.clientWidth,n=e.parentElement.clientHeight/e.clientHeight;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"}),doc.querySelectorAll("[scale-to-fit-parent-height]").forEach(e=>{var t=e.parentElement.clientHeight/e.clientHeight,n=e.parentElement.clientWidth/e.clientWidth;t<=n&&(t=n),e.scale=t,e.style.transform="translateX("+(e.translateX||"0px")+") scale("+(e.scale||1)+")"})};function update_vh(){scale_to_fit_parent();let e=window.innerHeight,t=window.innerWidth,n=e,a=t,r=1;a>BODY_MAX_WIDTH?(document.getElementById("body").style.width=BODY_MAX_WIDTH+"px",document.getElementById("body").style.marginLeft=parseInt((a-BODY_MAX_WIDTH)/2)+"px",a=BODY_MAX_WIDTH):(document.getElementById("body").style.width="",document.getElementById("body").style.marginLeft=""),n>BODY_MAX_HEIGHT?(document.getElementById("body").style.height=BODY_MAX_HEIGHT+"px",document.getElementById("body").style.marginTop=parseInt((n-BODY_MAX_HEIGHT)/2)+"px",r=n/BODY_MAX_HEIGHT,n=BODY_MAX_HEIGHT):(document.getElementById("body").style.height="",document.getElementById("body").style.marginTop="",document.getElementById("body").style.transform="",r=1);t/e<.75&&(a=t/r,document.getElementById("body").style.width=a+"px",document.getElementById("body").style.marginLeft=parseInt((t-a)/2)+"px"),document.getElementById("body").style.transform=1==r?"":"scale("+r+")";let o=.01*n,i=.01*a;document.documentElement.style.setProperty("--vh",`${o}px`),document.documentElement.style.setProperty("--vw",`${i}px`),document.documentElement.style.setProperty("--scale",`${r}`),document.documentElement.style.setProperty("--window-height",`${n}px`),document.documentElement.style.setProperty("--window-width",`${a}px`),document.documentElement.style.setProperty("--window-width-for-font",`${mix(400,400,a,330,480)}px`),document.getElementById("zh-title-fix").setAttribute("zh",a<360?"探索\n你的旅程":"探索你的旅程"),setLang(current_lang),window.setLang=setLang,document.querySelectorAll("[full-width-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("width",a):e.style.width=a+"px"}),document.querySelectorAll("[full-height-abs]").forEach(e=>{"svg"==e.tagName?e.setAttribute("height",n):e.style.height=n+"px"}),window.dispatchEvent(new Event("curtain-resize"))}var onresize=function(e){update_vh()};window.attachEvent?window.attachEvent("onresize",onresize):window.addEventListener&&window.addEventListener("resize",onresize,!0),window.update_vh=update_vh;var userLang=navigator.language||navigator.userLanguage,isChinese=userLang.indexOf("zh")>-1,current_lang=isChinese?"zh":"en";urlParams.lang&&(current_lang=urlParams.lang),doc.getElementById("app").classList.remove("hidden"),FastClick.attach(doc.body);var setLang=function(L){L||(L=current_lang),document.getElementById("body").setAttribute("lang",L),document.querySelectorAll("[en],[zh]").forEach(e=>{var EN=e.attributes.en,ZH=e.attributes.zh;EN&&(EN=EN.value),ZH&&(ZH=ZH.value),("en"==L&&EN||"zh"==L&&!ZH)&&(EN=EN.replace(/{(.*?)}/g,r=>e.getAttribute(r.slice(1,-1))||eval(r.slice(1,-1))).replace(/c/g,"<span fix-c>c</span>"),e._content!=EN&&(e._content=EN,EN.indexOf("<span")>=0?e.innerHTML=EN:e.textContent=EN)),("zh"==L&&ZH||"en"==L&&!EN)&&(ZH=ZH.replace(/\{(.*?)\}/g,r=>e.getAttribute(r.slice(1,-1))||eval(r.slice(1,-1))).replace(/c/g,"<span fix-c>c</span>"),e._content!=ZH&&(e._content=ZH,ZH.indexOf("<span")>=0?e.innerHTML=ZH:e.textContent=ZH))})};doc.addEventListener("DOMContentLoaded",(function(){setLang(current_lang),update_vh()})),DEBUG&&(document.querySelectorAll("#lang-switcher > span").forEach(e=>{e.classList.remove("display-none");let t=function(e){document.querySelectorAll("#lang-switcher > span").forEach(e=>e.classList.remove("display-none")),this.classList.add("display-none"),setLang(this.textContent),current_lang=this.textContent};e.addEventListener("click",t),e.addEventListener("touchstart",t)}),document.querySelector("#lang-switcher > span").classList.add("display-none"),"zh"==current_lang&&document.querySelector("#lang-switcher > span:not([class])").click()),window.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t};var CARDS_RAW="!內在滿足;;Intrinsic satisfaction\n精神層面上的​滿足;;Mentally Satisfied\n與神有親密連繫;;Closely connected with God\n持續的認識自我;;Continuous ​self-exploration\n擁有自我內心的​空間;;Have an inner space \n安全感;;Sense of secure\n內心的平靜;;Have an inner peace \n新鮮感;;Sense of freshness\n感到自在;;Feel comfortable \n\n!人際關係;;Inter-personal relationship\n擁有自在舒適的​人際關係;;Got a comfortable ​inter-personal ​relationship\n美滿婚姻;;Happy marriage\n有交心知己;;Have Best Friend Forever\n有親近的好朋友;;Have good friends\n親密的家庭;;A close family \n孝順父母;;Filial Piety\n和一群人一起打拼;;Work hard with others\n讚賞及鼓勵別人;;Appreciate and ​encourage others\n有意義的愛情;;A meaningful ​love-relationship  \n幫助別人;;Help others\n\n!物質享受;;Materialistic\n有車 / 有樓;;Own a Car/House\n賺大錢;;Be wealthy\n時尚的打扮;;Fashionable ​dress up\n錢夠用 ​(沒有經濟上的​擔憂);;Sufficient amount of money ​(without financial burden)\n追上科技潮流;;Catch up on technology   \n建立社會地位;;Have social status\n環遊世界;;Travel around the world\n食盡美食;;Enjoy food\n\n!生活模式;;Life style\n簡簡單單的生活;;Simple life\n參加藝文青活動;;Participate art and ​cultural activities \n親親大自然;;Enjoy nature\n人生充滿樂趣;;Interesting life\n多姿多彩的生活;;Fruitful life\n參與宗教、政治、​社團活動;;Participate in religions, ​politics and/or ​different societies\n什麼事都不做;;Do nothing\n規律的生活;;Regular daily life\n安穩的工作;;Stable job\n享受獨處的時光;;Enjoy being alone \n做自己喜歡的事;;Do what you like\n持續地學習;;Continuous learning \n休息與放鬆;;Rest and relaxing\n運動;;Exercises\n擁有健康;;Be healthy\n長久的生命;;A long life\n為夢想奮鬥;;Work hard on your dream\n冒險與刺激;;Adventure and excitement\n成為眾人焦點;;Be the focus of everyone \n做善事;;Do good deed\n擁有自由;;Have freedom\n做自己;;Be yourself \n生小朋友;;Have kids\n有意義的工作;;A meaningful job\n\n!自我形象;;Self-image \n誠實正直;;Integrity\n心地善良;;Kind-hearted \n公平、公正;;Be fair and impartial \n擁有純潔及​真摯的心;;Be pure and true\n勇於改變;;Dare to Change \n有自信;;Confident\n有正義感;;Have a sense of justice\n義氣仔女;;Be loyal to friends \n腳踏實地;;Be practical and ​down-to-earth\n勇於接受挑戰;;Dare to accept challenge\n努力向上;;Hard-working\n用心/盡力做事;;Do your best on everything\n有美感;;Be aesthetic \n開放性的思維;;Open minded\n寛容;;Tolerance \n廣闊的視野;;Have wide horizon\n獨立自主;;Independence\n有影響力;;Be an influential person\n事業有成;;Successful in your career\n能夠發揮所長;;Able to use your talent\n擁有一己之長;;Have your own talent",SEP=";;",LANGS=["zh","en"],CARDS_NUM_LANGS=LANGS.length,CARDS_TYPES=[],CARDS_ITEMS={},CARDS=[],_bucket=[],_last_type;CARDS_RAW.split("\n").filter(e=>e.trim()).forEach(e=>{var t,n;e.startsWith("!")?(_bucket.length>0&&(CARDS_ITEMS[_last_type]=_bucket),assert((t=e.substr(1).split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),n={id:CARDS_TYPES.length,name:{}},LANGS.forEach((e,a)=>{n.name[e]=t[a]}),n.code=hash(n.name[LANGS[0]]),_last_type=n.id,CARDS_TYPES.push(n)):(assert((t=e.split(SEP).map(e=>e.trim())).length==CARDS_NUM_LANGS,"invalid data: "+t),_bucket.push(t),n={id:CARDS.length,name:{},type:_last_type,chosen:!1,droped:!1},LANGS.forEach((e,a)=>{n.name[e]=t[a]}),CARDS.push(n))}),_bucket.length>0&&(CARDS_ITEMS[CARDS_TYPES[CARDS_TYPES.length-1].id]=_bucket);var CARDS_SHUFFLED=CARDS.slice(0);shuffle(CARDS_SHUFFLED);var CARDS_CHUNKS=chunks(CARDS_SHUFFLED,CARDS_PER_PAGE);console.log(CARDS_TYPES),window.CARDS=CARDS,window.CARDS_TYPES=CARDS_TYPES,window.CARDS_ITEMS=CARDS_ITEMS,window.CARDS_SHUFFLED=CARDS_SHUFFLED,window.CARDS_CHUNKS=CARDS_CHUNKS;var MUSIC_URL="https://www.bensound.com/bensound-music/bensound-beyondtheline.mp3",files="\nbg01-bg.jpg\nbg01-branch01.png\nbg01-branch02.png\nbg01-branch03.png\nbg01-branch04.png\nbg01-branch05.png\nbg01-branch06.png\nbg01-branch07.png\nbg01-branch08.png\nbg01-branch09.png\nbg01-branch10.png\nbg01-branch11.png\nbg01-branch12.png\nbg01-branch13.png\nbg01-branch14.png\nbg01-branch15.png\nbg01-branch16.png\nbg01-branch17.png\nbg01-branch18.png\nbg01-card-bg-01.png\nbg01-card-bg-02.png\nbg01-card-bg-03.png\nbg01-card-bg-04.png\nbg01-card-bg-05.png\nbg01-card-bg-06.png\nbg01-card-bg-07.png\nbg01-card-bg-08.png\nbg01-card-bg-09.png\nbg01-card-bg-10.png\nbg01-card-bg-11.png\nbg01-card-bg-12.png\nbg01-greens.png\nbg01-lotus.png\nbg01-wave01.png\nbg01-wave02.png\ncloud-bg.png\ncloud01.png\ncloud02.png\ncloud03.png\ncloud04.png\ncontact-button-01.jpg\ncontact-button-02.jpg\ncontact-button-03.jpg\ncontact-button-04.jpg\ncontact-button-05.jpg\ncontact-button-06.jpg\ncontact.jpg\ncover-bg.jpg\ncover-buddy.png\ncover-greens.png\ncover-leaf-01.png\ncover-leaf-02.png\ncover-leaf-03.png\ncover-leaf-04.png\ncover-stamen-01.png\ncover-stamen-02.png\ncover-stamen-03.png\ncover-wave.png\ncover.png\nintro.jpg\nluggage.jpg\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_1_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_2_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_3_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_4_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),card_5_bgs="\n".split("\n").filter(e=>e).map(e=>"assets/img/"+e),cards_bgs=[card_1_bgs,card_2_bgs,card_3_bgs,card_4_bgs,card_5_bgs],files_loaded=0,files_total=files.length,load_counter=doc.getElementById("load-percent"),load_wrapper=doc.getElementById("loading-wrapper"),increment_files_loaded=function(){load_counter.textContent=files_total?parseInt(++files_loaded/files_total*100):100,files_loaded==files_total&&(LOGT("All assets loaded."),start(),update_vh())};window.onload=function(){files.forEach(e=>loadjs(e,increment_files_loaded))},0==files_total&&document.addEventListener("DOMContentLoaded",increment_files_loaded);const id_seen=new Set,makeid=()=>{for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<6;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return id_seen.has(e)?makeid():(id_seen.add(e),e)},prefixes=["-webkit-","-moz-","-o-","-webkit-",""],generate_css=e=>{var t="animation_"+makeid(),n=e.rotate,a=e.opacity,r=e.scale,o=e.translateX,i=e.translateY,s=e.reverse,c=("alternate"==e.direction?[[s?1:0,0],[s?0:1,50],[s?1:0,100]]:[[s?1:0,0],[s?0:1,100]]).map(e=>{var t=e[0],s=e[1],c=[];n&&c.push(`rotate(${n[t]}deg)`),r&&c.push(`scale(${r[t]})`),o&&c.push(`translateX(${o[t]}px)`),i&&c.push(`translateY(${i[t]}px)`);var l=c.join(" ");return s+"%{"+(l?prefixes.map(e=>`${e}transform:${l}`).join(";"):"")+(a?`opacity:${a[t]}`:"")+"}"}).join("");return[t,prefixes.map(e=>`@${e}keyframes ${t}{${c}}`).join("\n")]},EASINGS={linear:"linear",swing:"cubic-bezier(0.5, 0, 0.5, 1)"},apply_css_from_animejs_config=(e,t)=>{var n="animation_"+makeid(),a=generate_css(t),r=a[0],o=a[1];t.duration*=1.5,t.seek*=1.5;var i=EASINGS[t.easing],s=prefixes.map(e=>`${e}animation: ${t.duration||0}ms ${i} -${t.seek||0}ms infinite running ${r};`).join(""),c=e.style.transformOrigin;c&&(e.style.webkitTransformOrigin=c,e.style.mozTransformOrigin=c,e.style.msTransformOrigin=c,e.style.oTransformOrigin=c),styler(n,o+`.${n}{${s}}`),e.classList.add(n)},activate_bg_animation=background=>{if(background){var animes=background.querySelectorAll("[anime]");animes.forEach(e=>{var args=eval("("+e.getAttribute("anime")+")"),animation;apply_css_from_animejs_config(e,args)})}},deactivate_bg_animation=e=>{e&&e.querySelectorAll("[anime]").forEach(e=>{e.anime&&anime.remove(e)})};window.deactivate_bg_animation=deactivate_bg_animation;var goNextFade=function(e,t,n){anime({targets:t,opacity:0,duration:750,easing:"easeOutQuad",delay:e,complete:function(e){t.remove(),n()}})},MOUSE={x:0,y:0};function isMouseInBox(e){MOUSE.x=e.pageX,MOUSE.y=e.pageY}document.addEventListener("mousemove",(function(e){isMouseInBox(e)}));var volumeButton=doc.getElementById("volume"),volumeSwitchContainer=volumeButton.querySelector(".switchContainer"),audio=new Audio,audio_can_start=!1,audio_canplaythrough=!1;audio.addEventListener("canplaythrough",(function(){audio_canplaythrough=!0,audio_can_start&&(document.getElementById("float-top-right").classList.remove("hidden"),audio.play())}),!1);var AUDIO_ON=volumeSwitchContainer.classList.contains("switchOn"),ua=window.navigator.userAgent,iOS=!!ua.match(/iPad/i)||!!ua.match(/iPhone/i),webkit=!!ua.match(/WebKit/i),iOSSafari=iOS&&webkit&&!ua.match(/CriOS/i),setVolume=e=>{if(iOS)try{e<.5?audio.pause():audio.play()}catch(e){audio=new Audio(MUSIC_URL),alert(e)}else anime({targets:audio,volume:e,duration:500,easing:"easeOutQuad"})},playMusic=()=>{audio||(audio.volume=MAX_AUDIO_VOL),audio.play()},volume_recent=0,toggleMusic=()=>{var e=+new Date;e-volume_recent<200||(volume_recent=e,AUDIO_ON?(AUDIO_ON=!1,setVolume(0),volumeSwitchContainer.classList.remove("switchOn"),volumeSwitchContainer.classList.add("switchOff")):(AUDIO_ON=!0,setVolume(MAX_AUDIO_VOL),volumeSwitchContainer.classList.add("switchOn"),volumeSwitchContainer.classList.remove("switchOff"),playMusic()))};audio.src=MUSIC_URL,audio.load(),volumeButton.onclick=toggleMusic,volumeButton.ontouchstart=toggleMusic;var start=function(){goNextFade(0,load_wrapper,e=>{LOGT("Load wrapper removed."),skip||(curtains[0].show(),curtains[0].nextClick.push(e=>{}))}),skip&&(curtains[0].show(),curtains[0].endCurtain(!0),deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),activate_bg_animation(doc.getElementById("intro").querySelectorAll("background")[1]),setTimeout(update_vh,100),document.getElementById("float-top-right").classList.remove("hidden"))};const FADE_DURATION=DEBUG?0:800,defaultNextCutain=e=>[function(){var t=e.obj.querySelector(".curtain-page");deactivate_bg_animation(e.obj.querySelector("background")),t&&(activate_bg_animation(t.querySelector("background")),t.curtain.show(),t.curtain.nextFrame.push(update_vh))},e.opened?0:500],sleep=e=>new Promise((function(t,n){setTimeout(t,DEBUG?0:e)})),timeline=function(e){if(0==e.length)return;var t=0,n=e[0];const a=e=>setTimeout(()=>r(e),n.duration||n[1]||0),r=function(r){var o,i=n.func||n[0]||n;if("function"!=typeof i)throw"timeline contains non-callable elements";o=i(r),(t+=1)<e.length&&(n=e[t],o&&o.then?o.then(e=>a(e)):a())};a()},fadeIn=(e,t)=>{DEBUG||(t=t||FADE_DURATION),LOG("duration",t,"for",e);var n=anime.timeline({targets:e,delay:anime.stagger(t||FADE_DURATION),easing:"linear"}).add({opacity:1});if(!DEBUG)return n.finished};window.intro_next=function(e){LOG(e.obj),document.querySelector("html").style.background=e.obj.style.background;e.obj;timeline([()=>audio_can_start=!0,()=>audio_canplaythrough?document.getElementById("float-top-right").classList.remove("hidden"):0,()=>sleep(1e3),()=>playMusic(),()=>sleep(1e3),()=>deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),()=>fadeIn("#intro-tran-text p"),()=>sleep(1e3),defaultNextCutain(e)])};const intro_drags=Array.from(document.querySelectorAll("#intro [drag]")).map(e=>[e,parseInt(e.getAttribute("drag"))]);window.coverUpdate=(e,t,n)=>{intro_drags.forEach(e=>{var t=e[0],a=e[1];t.translateX=-a*n+"px",t.style.transform="translateX("+t.translateX+") scale("+(t.scale||1)+")"})};var current_cards_i=0,recent_touch=0,no_click=!1;const card_click_listener=function(e){var t=!1,n=!1;if(!no_click||"click"!=e.type){if("touchend"==e.type){var a=pointerEventToXY(e);null!==last_cursor&&Math.sqrt(Math.pow(a.x-last_cursor.x,2)+Math.pow(a.y-last_cursor.y,2))>20&&(t=!0,n=last_cursor.y<a.y)}var r=+new Date;if(!(r-recent_touch<50)){recent_touch=r,last_cursor=null;for(var o=e.target;o&&"CARD"!=o.tagName;)o=o.parentElement;if(o){if(t)return;o.classList.toggle("chosen");var i=parseInt(o.id),s=CARDS[i];s.chosen=!s.chosen,n_chosen_at_last+=s.chosen?1:-1,setLang(),window.dispatchEvent(new Event("card-clicked"))}for(o=e.target;o&&"RESULT-DESCRIPTION"!=o.tagName;)o=o.parentElement;if(o){var c=document.querySelector("result-container");if(t&&c.classList.contains("active")&&(0!=document.querySelector("result-description").scrollTop||!n))return;c.classList.toggle("active"),c.classList.contains("active")?doc.body.setAttribute("float-higher",""):doc.body.removeAttribute("float-higher"),LOGT("!")}}}};var last_cursor;doc.getElementById("app").addEventListener("touchstart",e=>{last_cursor=pointerEventToXY(e),no_click=!0}),doc.getElementById("app").addEventListener("click",card_click_listener),doc.getElementById("app").addEventListener("touchend",card_click_listener);const stage_get_arrows=e=>Array.from(e.children).filter(e=>"ARROWS"==e.tagName)[0],move_bg=(e,t,n)=>(console.log("level:",t,"/",n),new Promise((function(a,r){var o=Array.from(e.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelector("bg g");o.translateX="calc((-100% + var(--window-width, 100vw)) / "+n+" * "+t+")",o.style.transform="translateX("+o.translateX+") scale("+(o.scale||1)+")",a()}))),arrange_cards=(e,t,n,a)=>{t=Array.from(t).filter(e=>e.classList.contains("active"));var r=getRandomSubarray(cards_bgs[e]);t.forEach((e,t)=>{var n=e.querySelector("[card-bg]"),a=e.querySelector("image");n.style.display=r[t]?"unset":"none",r[t]&&a.setAttributeNS("http://www.w3.org/1999/xlink","href",r[t])});var o=void 0===n?Math.random()>.5:n,i=t.length,s=(o?0:-0)-.125,c=(o?.85:a?.85:.75)+.01*Math.random()-.06,l=(c-s)/i-.12,d=0,u=parseInt(document.documentElement.style.getPropertyValue("--window-width")),m=mix(.075,.1,u,340,480),g=mix(.01,.03,u,340,480),p=.5*mix(.01,.03,u,340,480),h=e=>{var t=Math.random()*m;return d=t,t=t*(1-p)+p,e.style.left=100*t+"%",e.style.right="unset",t},y=(n=e=>{var t=min(m,1-d-m),n=Math.random()*t;n=n*(1-g)+g,e.style.right=100*n+"%",e.style.left="unset"},t.map(e=>e.querySelector("card-text").clientHeight)),f=y.min(),_=y.max(),v=(y=y.map(e=>(((e-f)/_)**2+1)**1.3)).sum();t.forEach((e,a)=>{var r=(y.slice(0,a).sum()+y[a]/2)/v*t.length,i=s+Math.random()*l+.06+r*(l+.12);e.style.top=100*i+"%",(a%2==(o?1:0)?h:n)(e),e.style.pointerEvents="all",e})},hide=e=>{var t=e=>{e.style.pointerEvents="none",anime({targets:e,opacity:0,duration:400,easing:"linear"})};e.forEach?e.forEach(t):t(e)},show=e=>{var t=e=>{e.style.opacity="1",e.style.pointerEvents="all"};e.forEach?e.forEach(t):t(e)},set_card_divs=(e,t)=>{for(var n=CARDS_CHUNKS[t],a=0;a<e.length;a++){var r=e[[a]];if(a>=n.length)r.classList.remove("active");else{var o=n[a];r.classList.add("active"),o.chosen?r.classList.add("chosen"):r.classList.remove("chosen"),r.setAttribute("id",o.id);var i=r.querySelector("p");Object.keys(o.name).forEach(e=>i.setAttribute(e,o.name[e].replace(/ *\u200b/g,"\n"))),setLang(current_lang)}}},wait_for_arrows=e=>{var t=stage_get_arrows(e);return t.style.opacity=1,t.style.transform="translateX(0)",new Promise((function(e,n){var a=n=>{t.removeEventListener("click",a),t.removeEventListener("touchend",a),t.style.opacity=0,e()};t.addEventListener("click",a),t.addEventListener("touchend",a)}))};window.stage_next=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=e.max_i,a=e.card_type,r=Array.from(t.children).filter(e=>"BACKGROUND"==e.tagName)[0].querySelectorAll("card"),o=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0],i=o.querySelectorAll("p"),s=[];s.push.apply(s,[()=>move_bg(t,0,n),()=>sleep(1500),()=>fadeIn(i),()=>sleep(500),()=>wait_for_arrows(t),()=>hide(o)]);for(let e=0;e<n;e++)s.push.apply(s,[()=>hide(r),()=>sleep(500),()=>move_bg(t,e+1,n),()=>sleep(2e3),()=>set_card_divs(r,current_cards_i++),()=>arrange_cards(a,r,e==n-1?!(Array.from(r).filter(e=>e.classList.contains("active")).length%2==0):void 0,e==n-1||void 0),()=>fadeIn(r),()=>sleep(1500),()=>e==n-1?1:wait_for_arrows(t)]);s.push.apply(s,[defaultNextCutain(e)]),timeline(s)};var n_chosen_at_last=0;window.sort_start=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=[],a=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0].querySelectorAll("p"),r=doc.getElementById("sort-container"),o=r.querySelector("cards");n_chosen_at_last=0;var i=CARDS.filter(e=>e.chosen).map(e=>e),s=i.reduce((e,t)=>(e[t.type]?e[t.type]++:e[t.type]=1)&&e,{});const c=t=>{var n=e.obj.querySelector(".curtain-page");deactivate_bg_animation(e.obj.querySelector("background")),activate_bg_animation(n.querySelector("background")),10==n_chosen_at_last?n&&(n.curtain.show(),n.curtain.nextFrame.push(update_vh)):n&&(n.curtain.hide(),n.curtain.nextFrame.push(update_vh))};if(console.log("chosen:",i),console.log("stats:",s),0==i.length)a[0].setAttribute("zh","認真聆聽你內心的聲音，有什麼是你想要的？"),a[0].setAttribute("en","Listen carefully to your inner voice, what do you want?"),a[1].setAttribute("zh","（請最少選擇一張卡）"),a[1].setAttribute("en","(Please choose at least 1 card)"),setLang(),timeline([()=>sleep(1e3),()=>fadeIn(a),()=>wait_for_arrows(t),()=>hide(a),()=>window.location="/"]);else if(i.length<=10){LOG(e);var l=e.obj.querySelector(".curtain-page");l.style.display="",l.style.clipPath="",l.style.webkitClipPath="",l.style.opacity=0,l.style.transition="0.5s ease all",l.curtain.finishCurtain(),t.offsetHeight,setTimeout(()=>{l.style.opacity=1},5)}else timeline([()=>sleep(1e3),()=>fadeIn(a),()=>wait_for_arrows(t),()=>hide(a),()=>sleep(500),()=>r.style.display="flex",()=>i.shuffle().forEach(e=>{var t=doc.createElement("card"),a=doc.createElement("card-text"),r=doc.createElement("p");t.classList.add("card-sort"),Object.keys(e.name).forEach(t=>r.setAttribute(t,e.name[t].replace(/ *\u200b/g,"\n"))),t.appendChild(a),a.appendChild(r),e.chosen=!1,t.setAttribute("id",e.id),o.appendChild(t),n.push(t)}),()=>setLang(),()=>{var e=Array.from(document.querySelectorAll(".card-sort"));e.forEach((t,n)=>{n%2!=0&&(t.style.marginTop=e[n-1].clientHeight+50+"px")})},()=>show(r),()=>n.slice(8).forEach(e=>e.style.opacity=1),()=>fadeIn(doc.querySelectorAll("#sort-container .thin-body p")),()=>fadeIn(n.slice(0,8),200),()=>window.addEventListener("card-clicked",c,!1),()=>sleep(2e3)])},window.pre_result=function(e){document.querySelector("html").style.background=e.obj.style.background;var t=e.obj,n=Array.from(t.children).filter(e=>e.classList.contains("thin-body"))[0].querySelectorAll("p");timeline([()=>sleep(1e3),()=>deactivate_bg_animation(doc.getElementById("intro").querySelector("background")),()=>fadeIn(n),defaultNextCutain(e)])},window.show_result=function(e){var t=e.obj;document.querySelector("html").style.background=t.style.background;var n=t.querySelector("result-container"),a=CARDS.filter(e=>e.chosen).map(e=>e),r=a.reduce((e,t)=>(e[t.type]?e[t.type]++:e[t.type]=1)&&e,{}),o=[0,0,0,0,0];Object.keys(r).forEach(e=>o[e]=r[e]);var i=doc.getElementsByClassName("donut"),s=a.length,c=document.querySelector("result-description-inner");LOG(i),LOG(s),LOG(r),LOG(o);var l=Array.from(doc.querySelectorAll("row"));l.forEach((e,t)=>e.score=o[t]),l.sort((e,t)=>e.score==t.score?0:e.score<t.score?1:-1),doc.querySelectorAll("left h1").forEach((e,t)=>{var n=parseInt(o[t]/s*100);e.textContent=n+"%"}),l.forEach(e=>c.appendChild(e));console.log(e.obj),timeline([()=>sleep(1e3),()=>show(n),()=>(()=>{var e={targets:Array.from(i).map(e=>e.querySelector("circle")),easing:"easeInOutQuint",duration:3e3,"stroke-dashoffset":function(e,t,n){return[879.645943005142,879.645943005142*(1-(o[t]-0)/s)]}};anime(e);var t=45*Math.random();anime({targets:i,easing:"easeInOutQuint",opacity:[0,1],rotate:function(e,n,a){return[-450-t,-90-t+(0==n?0:360*o.slice(0,n).sum()/s)]},duration:3e3})})(),()=>sleep(2e3),()=>doc.querySelector("result-description").classList.add("active"),()=>doc.querySelector("learn-more").classList.add("active"),()=>c.style.height=Array.from(document.querySelectorAll("result-description-inner > *")).map(e=>e.clientHeight).sum()+"px",()=>l.forEach(e=>e.style.flex="1"),defaultNextCutain(e)])};var curtains=makeCurtains(doc.getElementById("stages"));if(activate_bg_animation(doc.getElementById("intro").querySelector("background")),urlParams.chosen){let e=0;getRandomSubarray(CARDS).forEach(t=>{urlParams.num_cards&&e>=urlParams.num_cards||(t.chosen=!0,e+=1)})}skip&&(current_cards_i=[0,0,3,6,8,10,12][skip]);const set_landscape=()=>{var e=0!=window.orientation;void 0===window.orientation&&(e=window.innerHeight<window.innerWidth),e?doc.body.setAttribute("is-landscape",""):doc.body.removeAttribute("is-landscape")};window.addEventListener("orientationchange",set_landscape,!1),set_landscape(),setInterval(update_vh,1e3);