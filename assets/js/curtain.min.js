import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}.arrow{color:white;position: absolute;pointer-events: none;width: 25px;z-index:999;opacity: 0;transform: translate(-50%,-50%) rotateZ(0deg);}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,c=new Array;a[0]=0,o[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var u=1;u<i-1;u++)a[u]=1,o[u]=4,s[u]=1,c[u]=4*t[u]+2*t[u+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],u=1;u<i;u++)e=a[u]/o[u-1],o[u]=o[u]-e*s[u-1],c[u]=c[u]-e*c[u-1];for(n[i-1]=c[i-1]/o[i-1],u=i-2;u>=0;--u)n[u]=(c[u]-s[u]*n[u+1])/o[u];for(u=0;u<i-1;u++)r[u]=2*t[u+1]-n[u+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const a=t=>function(t){for(var e=t.length,n=new Array,r=new Array,a=0;a<e;a++)n[a]=t[a][0],r[a]=t[a][1];var o,s,c,u,d,l,v,p,f=i(n),h=i(r),x=[];for(a=0;a<e-1;a++)x.push((o=n[a],s=r[a],c=f.p1[a],u=h.p1[a],d=f.p2[a],l=h.p2[a],v=n[a+1],p=r[a+1],o+" "+s+" C "+c+" "+u+" "+d+" "+l+" "+v+" "+p));return"M "+x.join(" L ")+" Z"}(t);var o=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};const s=function(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t};function c(t,e){return t>e?e:t}function u(t,e){return t>e?t:e}function d(t,e,n){return(e-t)*n+t}var l,v,p;window.innerHeight,window.innerWidth;function f(){l=parseInt(document.documentElement.style.getPropertyValue("--window-height")||window.innerHeight),v=parseInt(document.documentElement.style.getPropertyValue("--window-width")||window.innerWidth),window.innerHeight,window.innerWidth,p=parseFloat(document.documentElement.style.getPropertyValue("--scale")||1)}window.addEventListener("curtain-resize",f,!1);var h=function(t){f()};window.attachEvent?window.attachEvent("onresize",h):window.addEventListener&&window.addEventListener("resize",h,!0),f();var x=0;var m={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,nextFrame:[],nextClick:[],startX:126,startY:54,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}},y=[],g=Date.now();return function t(){requestAnimationFrame(t);var e=Date.now(),n=e-g;n>1e3/60&&(g=e-n%(1e3/60),y.forEach(t=>t()))}(),function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i="curtainClip-"+(x+=1),f=document.createElementNS(n,"svg");f.setAttribute("viewbox","0 0 1000 1000"),f.innerHTML='<use xlink:href="#arrow-svg"></use>',f.classList.add("arrow");var h,g=document.createElementNS(n,"svg"),w=document.createElementNS(n,"path"),b=document.createElementNS(n,"clipPath");b.id=i,g.appendChild(b),g.appendChild(document.createElementNS(n,"g")),b.appendChild(w),w.setAttribute("fill","#000"),g.classList.add("curtain"),document.body.appendChild(g);var E=t.getBoundingClientRect();setInterval((function(){E=t.getBoundingClientRect()}),1e3),t.insertBefore(f,t.firstChild);var X=Object.assign({},m,e);X.curtain=g,X.path_dom=w,X.endX=X.startX,X.endY=X.startY,X.mousedown=!1;var C=!1,Y=!1;const A=function(){if(!Y){var e="url(#"+i+")";t.style.clipPath=e,t.style.webkitClipPath=e,Y=!0}},L=function(){Y&&(t.style.clipPath="",t.style.webkitClipPath="",Y=!1)};A(),X.closed&&(X.startX=0,X.startY=0,X.endX=0,X.endY=0),t.curtain=X,b.curtain=X,X.obj=t,setTimeout((function(t){X.start_ended=!0}),1e3),g.setAttribute("width",v),g.setAttribute("height",l),g.setAttribute("viewbox",`0 0 ${v} ${l}`),X.x=X.startX,X.y=X.startY,X.x2=36,X.y2=X.startY,X.x3=36,X.y3=X.startY,X.x4=36,X.y4=X.startY,X.x5=36,X.y5=X.startY;var M=v,P=l,k="",S=0;function _(t){if(X.mousedown){var e=o(t);X.endX=(e.x-E.x)/p,X.endY=(e.y-E.y)/p}}function j(t,e,n){return t<n&&t>e}function T(){var e=t.querySelector(".curtain-page");e&&e.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}y.push((function(){try{var e=X.endX;e<-v-3&&(e=-v-3);var n=e-X.startX,i=X.endY-X.startY;X.start_ended&&n>0&&(n=0),h=l*(1-X.but_y_pos);var o=u(0,l-h-100);i>o&&(i=o);var p=c(0,100-h);i<p&&(i=p),!X.start&&X.x>-1&&(n=78),n<-v-5&&(n=-v-5);var x=Math.abs(n-X.x)<1e-5,m=!1;if(v==M&&l==P||!X.start){if(!X.start&&X.x>=58)return C||(t.style.display="none"),C=!0,X.active=!1,void(X.x<5-v&&X.closing&&L());if(X.x<-v&&!X.mousedown)return L(),void(X.active=!1);if(x)return X.active=!1,void(X.x<5-v&&X.closing&&L());C&&(t.style.display="",C=!1)}else M=v,P=l,m=!0;X.active=!0,A(),X.x>-30&&T(),X.x=d(X.x,n,.09),X.y=d(X.y,i,.09);var y=X.x,g=h+X.y,b=54.5*(1-c(1,u(0,y)/38))-50;f.style.top=g+"px",f.style.right=b+"px",S=d(S,u(0,1-Math.abs(X.x)/38),.15),f.style.opacity=S;var E=-y/v;E<0&&(E=0),E>1&&(E=1);var Y=60*E,_=X.closing,j=s(_?.1:1,1,E,.2,1),N=s(0,36,y,0,60);X.x2=d(X.x2,c(y<-v?-v:y,s(0,54,y,0,60)),.54),X.x3=d(X.x3,c((X.x2<-v?-v:X.x2)*j,N),.54),X.x4=d(X.x4,c((X.x3<-v?-v:X.x3)*j,N),.54),X.x5=d(X.x5,c((X.x4<-v?-v:X.x4)*j,N),.54),(X.start||y<-60)&&(X.x2<y&&(X.x2=y),X.x3<y&&(X.x3=y),X.x4<y&&(X.x4=y),X.x5<y&&(X.x5=y)),X.x5=X.x4;var q=X.x2,z=(X.x3,X.x4),F=X.x5,H=y<0?10/(-y)**.5:1;H>1&&(H=1);var B=1/(H=.8+.2*H)*40*s(.9,1.3,E,0,.9),D=.06,W=40/H*1.2*2+s(1.2*Y,2*Y,E,D,1)+s(2*Y,5*Y,E,.7,1)+180+(_?1:.25)*s(Y,6*Y,E,0,.3)-(_?s(s(0,130,E,0,D),0,E,0,.7):0)+s(s(0,200,E,D,.5),0,E,.3,.7),I=40/H*1.2*2+s(1.2*Y,2*Y,E,D,1)+s(2*Y,3*Y,E,.7,1)+20+(_?1:.25)*s(0,6*Y,E,0,1)-(_?s(s(0,30,E,0,D),0,E,0,.7):0),R=40/H*1.2+s(1.2*Y,2*Y,E,D,1)+(_?1:.3)*s(0,Y*s(4,5,E,.25,.85),E,0,1)+(_?s(s(0,17,E,0,D),0,E,0,.5):0),V=40/H/s(2,3,E,0,D)+Y**.8+(_?s(0,Y/4,E,.8,1):0)+(_?1:.3)*s(0,2*Y,E,0,1)+(_?1:.6)*s(s(0,13,E,0,D),0,E,0,.5),O=s(s(0,_?20:-50,E,0,.7),0,E,.7,1),Z=s(s(0,_?50:-45,E,0,.7),0,E,.7,1)+(_?1:0)*s(s(0,v**1.5/1500,E,0,D),0,E,0,1),$=40/7-s(s(0,_?v/7:30,E,D,1),0,E,.7,1)+(_?s(s(0,9,E,0,D),0,E,0,.3):0),K=v-18-B+y,G=-18-B-1,J=function(t,e,n,r){if(!X.closing)return s(t,t-e-36,r,.3,.7);var i=.08595*n;if(t<i){var a=(t-i)/e*(n/(n+i));return 2*(-(a**2)+a)*n+i}return t}(K,G,2.5*-G,E);let nt=[[v+200,g-l-100],[v-18+F,g-l-100],[v-18+F,g-l-100],[N=v-18+F-O,g-W-s(500,700,E,0,.6)],[N,g-W-s(300,500,E,0,.6)],[N,g-W-s(200,300,E,0,.6)],[N,g-W],[v-18+z-Z,g-I],[v-18-$+q,g-R],[J,g-V],[J,g+V],[v-18-$+q,g+R],[v-18+z-Z,g+I],[N,g+W],[N,g+W+s(200,300,E,0,.6)],[N,g+W+s(300,500,E,0,.6)],[N,g+W+s(500,700,E,0,.6)],[v-18+F,g+l+100],[v-18+F,g+l+100],[v+200,l+200]];var Q=7,U=nt.length,tt=.05,et=s(-1,0,K,G/2,0)*s(0,-20,E,.6,.7);_||(et=0),nt[Q][0]<nt[Q+1][0]&&(nt[Q][0]=nt[Q+1][0]),nt[Q][0]=s(nt[Q][0],nt[Q+1][0]-et,E,tt,1),nt[Q-1][0]=s(nt[Q-1][0],nt[Q+1][0]-et,E,tt,1),nt[Q-2][0]=s(nt[Q-2][0],nt[Q+1][0]-et,E,tt,1),nt[Q-3][0]=s(nt[Q-3][0],nt[Q+1][0]-et,E,tt,1),nt[Q-4][0]=s(nt[Q-4][0],nt[Q+1][0]-et,E,tt,1),nt[Q=U-Q-1][0]<nt[Q-1][0]&&(nt[Q][0]=nt[Q-1][0]),nt[Q][0]=s(nt[Q][0],nt[Q-1][0]-et,E,tt,1),nt[Q+1][0]=s(nt[Q+1][0],nt[Q-1][0]-et,E,tt,1),nt[Q+2][0]=s(nt[Q+2][0],nt[Q-1][0]-et,E,tt,1),nt[Q+3][0]=s(nt[Q+3][0],nt[Q-1][0]-et,E,tt,1),nt[Q+4][0]=s(nt[Q+4][0],nt[Q-1][0]-et,E,tt,1),nt[Q=8][0]=nt[Q][0]+(X.closing?0:s(0,s(4,0,E,0,1),E,0,.3)),nt[Q=U-Q-1][0]=nt[Q][0]+(X.closing?0:s(0,s(4,0,E,0,1),E,0,.3)),nt=nt.map((t,e)=>[t[0],l-t[1]]);const rt=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))(nt,v,l,{yMin:0,yMax:l,xMin:0,xMax:v}),it=a(rt);(m||k!=it)&&(w.setAttributeNS(null,"d",it),k=it,X.update&&X.update(X,E,(E/.6)**3),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),X.nextFrame.length>0&&X.nextFrame.shift()()}catch(t){console.error(t)}}));var N=!1;function q(e){if(N)return;let n,r;N=!0,setTimeout(()=>{N=!1},300),e.preventDefault(),e.stopPropagation();let i=e.composedPath(),a=X.obj.querySelector(".curtain-page");if(!(X.closed||!X.start||!X.obj.contains(i[0])||a&&a.contains(i[0]))){E=t.getBoundingClientRect();var s=o(e);n=(s.x-E.x)/p,r=(s.y-E.y)/p;var c=X.endX<=-v/2;if(c){if(n>40)return}else{if(!j(r,h-80,h+80))return;if(!j(n,v-80,v+80))return}return c&&T(),X.closing=!c,X.mousedown=!0,X.startX=c?v:n,X.startY=r,_(e),!0}}function z(){X.startX=0,X.endX=-9999999,X.next&&(X.next(X),Array.from(X.obj.parentElement.children).filter(t=>t!=X.obj).forEach(t=>{t.style.pointerEvents="none",setTimeout((function(){t.style.display="none"}),1e3)})),X.reversible||(X.closed=!0)}function F(t){if(!0===t)return X.startX=0,X.endX=-9999999,X.next&&X.next(X),void(X.reversible||(X.closed=!0));let e,n;t.preventDefault(),t.stopPropagation();var r=o(t);if(e=(r.x-E.x)/p,n=(r.y-E.y)/p,X.mousedown){X.mousedown=!1;var i=!X.closing;X.closing&&(X.startX==e&&X.startY==n||Math.abs(X.startX-e)<3&&Math.abs(X.startY-n)<3)||X.endX-X.startX<(i?2*-v/3:-v/3)?z():(X.startX=0,X.startY=0,X.endX=0,X.endY=0)}}X.show=function(){X.start=!0,X.closing=!0},X.hide=function(){X.start=!1,X.closing=!1,X.mousedown=!1,X.startX=0,X.startY=0,X.endX=0,X.endY=0},X.endCurtain=F,X.finishCurtain=z;var H=!0;return document.addEventListener("mousedown",t=>{H&&(H=!1),X.nextClick.length>0&&X.nextClick.shift()(),q(t)&&document.addEventListener("mousemove",_)}),document.addEventListener("mouseup",t=>{F(t),document.removeEventListener("mousemove",_)}),document.addEventListener("touchstart",q),document.addEventListener("touchend",(function(t){F(t)})),document.addEventListener("touchmove",_,{passive:!1}),X}}();function makeCurtains(wrapper,load_first){var children=Array.from(wrapper.children),curtains=[];return children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),curtains.push(e.curtain),load_first&&i==children.length-2?e.curtain.show():e.curtain.hide()}}),curtains.reverse(),curtains}export{makeCurtains};