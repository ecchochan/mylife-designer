import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}.arrow{color:white;position: absolute;pointer-events: none;width: 25px;z-index:999;opacity: 0;transform: translate(-50%,-50%) rotateZ(180deg);}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,u=new Array;a[0]=0,o[0]=2,s[0]=1,u[0]=t[0]+2*t[1];for(var c=1;c<i-1;c++)a[c]=1,o[c]=4,s[c]=1,u[c]=4*t[c]+2*t[c+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,u[i-1]=8*t[i-1]+t[i],c=1;c<i;c++)e=a[c]/o[c-1],o[c]=o[c]-e*s[c-1],u[c]=u[c]-e*u[c-1];for(n[i-1]=u[i-1]/o[i-1],c=i-2;c>=0;--c)n[c]=(u[c]-s[c]*n[c+1])/o[c];for(c=0;c<i-1;c++)r[c]=2*t[c+1]-n[c+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const a=t=>function(t){for(var e=t.length,n=new Array,r=new Array,a=0;a<e;a++)n[a]=t[a][0],r[a]=t[a][1];var o,s,u,c,d,l,v,p,f=i(n),h=i(r),m=[];for(a=0;a<e-1;a++)m.push((o=n[a],s=r[a],u=f.p1[a],c=h.p1[a],d=f.p2[a],l=h.p2[a],v=n[a+1],p=r[a+1],o+" "+s+" C "+u+" "+c+" "+d+" "+l+" "+v+" "+p));return"M "+m.join(" L ")+" Z"}(t);var o=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};const s=function(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t};function u(t,e){return t>e?e:t}function c(t,e){return t>e?t:e}function d(t,e,n){return(e-t)*n+t}var l,v,p;window.innerHeight,window.innerWidth;function f(){l=parseInt(document.documentElement.style.getPropertyValue("--window-height")||window.innerHeight),v=parseInt(document.documentElement.style.getPropertyValue("--window-width")||window.innerWidth),window.innerHeight,window.innerWidth,p=parseFloat(document.documentElement.style.getPropertyValue("--scale")||1)}window.addEventListener("curtain-resize",f,!1);var h=function(t){f()};window.attachEvent?window.attachEvent("onresize",h):window.addEventListener&&window.addEventListener("resize",h,!0),f();var m=0;var x={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,nextFrame:[],startX:126,startY:54,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}},y=[],g=Date.now();return function t(){requestAnimationFrame(t);var e=Date.now(),n=e-g;n>1e3/60&&(g=e-n%(1e3/60),y.forEach(t=>t()))}(),function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i=m+=1,f="curtainClip-"+m,h=document.createElementNS(n,"svg");h.setAttribute("viewbox","0 0 1000 1000"),h.innerHTML='<use xlink:href="#arrow-svg"></use>',h.classList.add("arrow");var g,w=document.createElementNS(n,"svg"),b=document.createElementNS(n,"path"),E=document.createElementNS(n,"clipPath");E.id=f,w.appendChild(E),w.appendChild(document.createElementNS(n,"g")),E.appendChild(b),b.setAttribute("fill","#000"),w.classList.add("curtain"),document.body.appendChild(w);var X=t.getBoundingClientRect();setInterval((function(){X=t.getBoundingClientRect()}),1e3),t.insertBefore(h,t.firstChild);var Y=Object.assign({},x,e);Y.curtain=w,Y.path_dom=b,Y.endX=Y.startX,Y.endY=Y.startY,Y.mousedown=!1;var A=!1,C=!1;const L=function(){if(!C){var e="url(#"+f+")";t.style.clipPath=e,t.style.webkitClipPath=e,C=!0}},M=function(){C&&(t.style.clipPath="",t.style.webkitClipPath="",C=!1)};L(),Y.closed&&(Y.startX=0,Y.startY=0,Y.endX=0,Y.endY=0),t.curtain=Y,E.curtain=Y,Y.obj=t,setTimeout((function(t){Y.start_ended=!0}),1e3),w.setAttribute("width",v),w.setAttribute("height",l),w.setAttribute("viewbox",`0 0 ${v} ${l}`),Y.x=Y.startX,Y.y=Y.startY,Y.x2=36,Y.y2=Y.startY,Y.x3=36,Y.y3=Y.startY,Y.x4=36,Y.y4=Y.startY,Y.x5=36,Y.y5=Y.startY;var P=v,S=l,_="",j=0;function k(t){if(Y.mousedown){var e=o(t);Y.endX=(e.x-X.x)/p,Y.endY=(e.y-X.y)/p}}function T(t,e,n){return t<n&&t>e}function N(){var e=t.querySelector(".curtain-page");e&&e.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}y.push((function(){try{var e=Y.endX;e<-v-3&&(e=-v-3);var n=e-Y.startX,o=Y.endY-Y.startY;Y.start_ended&&n>0&&(n=0),g=l*(1-Y.but_y_pos);var p=c(0,l-g-100);o>p&&(o=p);var f=u(0,100-g);o<f&&(o=f),!Y.start&&Y.x>-1&&(n=78),n<-v-5&&(n=-v-5);var m=Math.abs(n-Y.x)<1e-5,x=!1;if(v==P&&l==S||!Y.start){if(!Y.start&&Y.x>=58)return A||(t.style.display="none"),A=!0,Y.active=!1,void(Y.x<5-v&&Y.closing&&M());if(Y.x<-v&&!Y.mousedown)return M(),void(Y.active=!1);if(m)return Y.active=!1,void(Y.x<5-v&&Y.closing&&M());A&&(t.style.display="",A=!1)}else P=v,S=l,x=!0;Y.active=!0,L(),Y.x>-30&&N(),Y.x=d(Y.x,n,.09),Y.y=d(Y.y,o,.09);var y=Y.x,w=g+Y.y,E=54.5*(1-u(1,c(0,y)/38))-50;h.style.top=w+"px",h.style.right=E+"px",j=d(j,c(0,1-Math.abs(Y.x)/38),.15),h.style.opacity=j;var X=-y/v;X<0&&(X=0),X>1&&(X=1);var C=60*X,k=Y.closing,T=s(k?.1:1,1,X,.2,1),q=s(0,36,y,0,60);Y.x2=d(Y.x2,u(y<-v?-v:y,s(0,54,y,0,60)),.54),Y.x3=d(Y.x3,u((Y.x2<-v?-v:Y.x2)*T,q),.54),Y.x4=d(Y.x4,u((Y.x3<-v?-v:Y.x3)*T,q),.54),Y.x5=d(Y.x5,u((Y.x4<-v?-v:Y.x4)*T,q),.54),(Y.start||y<-60)&&(Y.x2<y&&(Y.x2=y),Y.x3<y&&(Y.x3=y),Y.x4<y&&(Y.x4=y),Y.x5<y&&(Y.x5=y)),Y.x5=Y.x4;var z=Y.x2,F=(Y.x3,Y.x4),H=Y.x5,B=y<0?10/(-y)**.5:1;B>1&&(B=1);var D=1/(B=.8+.2*B)*40*s(.9,1.3,X,0,.9),W=.06,I=40/B*1.2*2+s(1.2*C,2*C,X,W,1)+s(2*C,5*C,X,.7,1)+180+(k?1:.25)*s(C,6*C,X,0,.3)-(k?s(s(0,130,X,0,W),0,X,0,.7):0)+s(s(0,200,X,W,.5),0,X,.3,.7),R=40/B*1.2*2+s(1.2*C,2*C,X,W,1)+s(2*C,3*C,X,.7,1)+20+(k?1:.25)*s(0,6*C,X,0,1)-(k?s(s(0,30,X,0,W),0,X,0,.7):0),V=40/B*1.2+s(1.2*C,2*C,X,W,1)+(k?1:.3)*s(0,C*s(4,5,X,.25,.85),X,0,1)+(k?s(s(0,17,X,0,W),0,X,0,.5):0),O=40/B/s(2,3,X,0,W)+C**.8+(k?s(0,C/4,X,.8,1):0)+(k?1:.3)*s(0,2*C,X,0,1)+(k?1:.6)*s(s(0,13,X,0,W),0,X,0,.5),Z=s(s(0,k?20:-50,X,0,.7),0,X,.7,1),$=s(s(0,k?50:-45,X,0,.7),0,X,.7,1)+(k?1:0)*s(s(0,v**1.5/1500,X,0,W),0,X,0,1),K=40/7-s(s(0,k?v/7:30,X,W,1),0,X,.7,1)+(k?s(s(0,9,X,0,W),0,X,0,.3):0),G=v-18-D+y,J=-18-D-1,Q=function(t,e,n,r){if(!Y.closing)return s(t,t-e-36,r,.3,.7);var i=.08595*n;if(t<i){var a=(t-i)/e*(n/(n+i));return 2*(-(a**2)+a)*n+i}return t}(G,J,2.5*-J,X);let rt=[[v+200,w-l-100],[v-18+H,w-l-100],[v-18+H,w-l-100],[q=v-18+H-Z,w-I-s(500,700,X,0,.6)],[q,w-I-s(300,500,X,0,.6)],[q,w-I-s(200,300,X,0,.6)],[q,w-I],[v-18+F-$,w-R],[v-18-K+z,w-V],[Q,w-O],[Q,w+O],[v-18-K+z,w+V],[v-18+F-$,w+R],[q,w+I],[q,w+I+s(200,300,X,0,.6)],[q,w+I+s(300,500,X,0,.6)],[q,w+I+s(500,700,X,0,.6)],[v-18+H,w+l+100],[v-18+H,w+l+100],[v+200,l+200]];var U=7,tt=rt.length,et=.05,nt=s(-1,0,G,J/2,0)*s(0,-20,X,.6,.7);k||(nt=0),rt[U][0]<rt[U+1][0]&&(rt[U][0]=rt[U+1][0]),rt[U][0]=s(rt[U][0],rt[U+1][0]-nt,X,et,1),rt[U-1][0]=s(rt[U-1][0],rt[U+1][0]-nt,X,et,1),rt[U-2][0]=s(rt[U-2][0],rt[U+1][0]-nt,X,et,1),rt[U-3][0]=s(rt[U-3][0],rt[U+1][0]-nt,X,et,1),rt[U-4][0]=s(rt[U-4][0],rt[U+1][0]-nt,X,et,1),rt[U=tt-U-1][0]<rt[U-1][0]&&(rt[U][0]=rt[U-1][0]),rt[U][0]=s(rt[U][0],rt[U-1][0]-nt,X,et,1),rt[U+1][0]=s(rt[U+1][0],rt[U-1][0]-nt,X,et,1),rt[U+2][0]=s(rt[U+2][0],rt[U-1][0]-nt,X,et,1),rt[U+3][0]=s(rt[U+3][0],rt[U-1][0]-nt,X,et,1),rt[U+4][0]=s(rt[U+4][0],rt[U-1][0]-nt,X,et,1),rt[U=8][0]=rt[U][0]+(Y.closing?0:s(0,s(4,0,X,0,1),X,0,.3)),rt[U=tt-U-1][0]=rt[U][0]+(Y.closing?0:s(0,s(4,0,X,0,1),X,0,.3)),rt=rt.map((t,e)=>[t[0],l-t[1]]);const it=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))(rt,v,l,{yMin:0,yMax:l,xMin:0,xMax:v}),at=a(it);(x||_!=at)&&(b.setAttributeNS(null,"d",at),_=at,Y.update&&Y.update(Y,X,(X/.6)**3),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),Y.nextFrame.length>0&&Y.nextFrame.shift()(),console.log("@",i)}catch(t){console.error(t)}}));var q=!1;function z(e){if(q)return;let n,r;q=!0,setTimeout(()=>{q=!1},300),e.preventDefault(),e.stopPropagation();let i=e.composedPath(),a=Y.obj.querySelector(".curtain-page");if(!(Y.closed||!Y.start||!Y.obj.contains(i[0])||a&&a.contains(i[0]))){X=t.getBoundingClientRect();var s=o(e);n=(s.x-X.x)/p,r=(s.y-X.y)/p;var u=Y.endX<=-v/2;if(u){if(n>40)return}else{if(!T(r,g-80,g+80))return;if(!T(n,v-80,v+80))return}return u&&N(),Y.closing=!u,Y.mousedown=!0,Y.startX=u?v:n,Y.startY=r,k(e),!0}}function F(t){if(!0===t)return Y.startX=0,Y.endX=-9999999,Y.next&&Y.next(Y),void(Y.reversible||(Y.closed=!0));let e,n;t.preventDefault(),t.stopPropagation();var r=o(t);if(e=(r.x-X.x)/p,n=(r.y-X.y)/p,Y.mousedown){Y.mousedown=!1;var i=!Y.closing;Y.closing&&(Y.startX==e&&Y.startY==n||Math.abs(Y.startX-e)<3&&Math.abs(Y.startY-n)<3)||Y.endX-Y.startX<(i?2*-v/3:-v/3)?(Y.startX=0,Y.endX=-9999999,Y.next&&(Y.next(Y),Array.from(Y.obj.parentElement.children).filter(t=>t!=Y.obj).forEach(t=>{t.style.pointerEvents="none",setTimeout((function(){t.style.display="none"}),1e3)})),Y.reversible||(Y.closed=!0)):(Y.startX=0,Y.startY=0,Y.endX=0,Y.endY=0)}}Y.show=function(){Y.start=!0,Y.closing=!0},Y.hide=function(){Y.start=!1,Y.closing=!1,Y.mousedown=!1,Y.startX=0,Y.startY=0,Y.endX=0,Y.endY=0},Y.endCurtain=F;var H=!0;return document.addEventListener("mousedown",t=>{H&&(H=!1),z(t)&&document.addEventListener("mousemove",k)}),document.addEventListener("mouseup",t=>{F(t),document.removeEventListener("mousemove",k)}),document.addEventListener("touchstart",z),document.addEventListener("touchend",(function(t){F(t)})),document.addEventListener("touchmove",k,{passive:!1}),Y}}();function makeCurtains(wrapper,load_first){var children=Array.from(wrapper.children),curtains=[];return children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),curtains.push(e.curtain),load_first&&i==children.length-2?e.curtain.show():e.curtain.hide()}}),curtains.reverse(),curtains}export{makeCurtains};