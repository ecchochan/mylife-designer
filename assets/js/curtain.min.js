import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}.arrow{position: absolute;pointer-events: none;width: 25px;z-index:999;opacity: 0;transform: translate(-50%,-50%) rotateY(180deg);}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,c=new Array;a[0]=0,o[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var u=1;u<i-1;u++)a[u]=1,o[u]=4,s[u]=1,c[u]=4*t[u]+2*t[u+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],u=1;u<i;u++)e=a[u]/o[u-1],o[u]=o[u]-e*s[u-1],c[u]=c[u]-e*c[u-1];for(n[i-1]=c[i-1]/o[i-1],u=i-2;u>=0;--u)n[u]=(c[u]-s[u]*n[u+1])/o[u];for(u=0;u<i-1;u++)r[u]=2*t[u+1]-n[u+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const a=t=>function(t){for(var e=t.length,n=new Array,r=new Array,a=0;a<e;a++)n[a]=t[a][0],r[a]=t[a][1];var o,s,c,u,d,l,x,p,v=i(n),g=i(r),m=[];for(a=0;a<e-1;a++)m.push((o=n[a],s=r[a],c=v.p1[a],u=g.p1[a],d=v.p2[a],l=g.p2[a],x=n[a+1],p=r[a+1],o.toFixed(3)+" "+s.toFixed(3)+" C "+c.toFixed(3)+" "+u.toFixed(3)+" "+d.toFixed(3)+" "+l.toFixed(3)+" "+x.toFixed(3)+" "+p.toFixed(3)));return"M "+m.join(" L ")+" Z"}(t);var o,s,c=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};function u(t,e){return t>e?e:t}function d(t,e){return t>e?t:e}function l(t,e,n){return(e-t)*n+t}function x(){o=parseInt(document.documentElement.style.getPropertyValue("--window-height")||window.innerHeight),s=parseInt(document.documentElement.style.getPropertyValue("--window-width")||window.innerWidth),.01*o,.01*s}window.addEventListener("curtain-resize",x,!1);var p=function(t){x()};window.attachEvent?window.attachEvent("onresize",p):window.addEventListener&&window.addEventListener("resize",p,!0),x();var v=0;var g={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:153,startY:63,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}};return function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i=v+=1,x="curtainClip-"+v,p=document.createElementNS(n,"svg");p.setAttribute("viewbox","0 0 1000 1000"),p.innerHTML='<use xlink:href="#arrow-svg"></use>',p.classList.add("arrow");var m,y=document.createElementNS(n,"svg"),h=document.createElementNS(n,"path"),f=document.createElementNS(n,"clipPath");f.id=x,y.appendChild(f),y.appendChild(document.createElementNS(n,"g")),f.appendChild(h),h.setAttribute("fill","#000"),y.classList.add("curtain"),document.body.appendChild(y),t.appendChild(p);var w=Object.assign({},g,e);w.curtain=y,w.path_dom=h,w.endX=w.startX,w.endY=w.startY,w.mousedown=!1;const b=function(){var e="url(#"+x+")";t.style.clipPath!=e&&(t.style.clipPath=e,t.style.webkitClipPath=e)};b(),w.closed&&(w.startX=0,w.startY=0,w.endX=0,w.endY=0),t.curtain=w,f.curtain=w,w.obj=t,setTimeout((function(t){w.start_ended=!0}),1e3),y.setAttribute("width",s),y.setAttribute("height",o),y.setAttribute("viewbox",`0 0 ${s} ${o}`),w.x=w.startX,w.y=w.startY,w.x2=36,w.y2=w.startY,w.x3=36,w.y3=w.startY,w.x4=36,w.y4=w.startY,w.x5=36,w.y5=w.startY;var E=s,A=o;function X(t){if(w.mousedown){var e=c(t),n=y.getBoundingClientRect();w.endX=e.x-n.x,w.endY=e.y-n.y}}function Y(t,e,n){return t<n&&t>e}function C(){t.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}!function e(){try{w.active=!1;var n=w.endX;n<-s-3&&(n=-s-3);var c=n-w.startX,x=w.endY-w.startY,v=Math.abs(c-w.x)<1e-5,g=!1;if(s==E&&o==A||!w.start){if(!w.start&&w.x>=68)return t.style.display="none",void requestAnimationFrame(e);if(w.x<-s&&!w.mousedown)return requestAnimationFrame(e),void(""!=t.style.clipPath&&(t.style.clipPath="",t.style.webkitClipPath=""));if(v)return void requestAnimationFrame(e);"none"==t.style.display&&(t.style.display="")}else E=s,g=!0,1==i&&console.log(1);w.active=!0,b(),w.start_ended&&c>0&&(c=0),m=o*(1-w.but_y_pos);var y=d(0,o-m-125);x>y&&(x=y);var f=u(0,125-m);x<f&&(x=f),w.x>-30&&C(),!w.start&&w.x>-1&&(c=60),c<-s/1-5&&(c=-s/1-5),w.x=l(w.x,c,.09),w.y=l(w.y,x,.09);var X=m+w.y,Y=59*(1-u(1,d(0,w.x)/43))-50;p.style.top=m+"px",p.style.right=Y+"px",p.style.opacity=1-Math.abs(w.x)/43;var L=-w.x/s;L<0&&(L=0),L>1&&(L=1);var M=60*L;function P(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t}w.x2=l(w.x2,u(w.x<-s?-s:w.x,P(0,54,w.x,0,60)),.54),w.x3=l(w.x3,u((w.x2<-s?-s:w.x2)*P(w.closing?.1:1,1,L,.2,1),P(0,36,w.x,0,60)),.54),w.x4=l(w.x4,u((w.x3<-s?-s:w.x3)*P(w.closing?.1:1,1,L,.2,1),P(0,36,w.x,0,60)),.54),w.x5=l(w.x5,u((w.x4<-s?-s:w.x4)*P(w.closing?.1:1,1,L,.2,1),P(0,36,w.x,0,60)),.54),(w.start||w.x<-60)&&(w.x2<w.x&&(w.x2=w.x),w.x3<w.x&&(w.x3=w.x),w.x4<w.x&&(w.x4=w.x),w.x5<w.x&&(w.x5=w.x)),w.x5=w.x4;var F=w.x<0?10/(-w.x)**.5:1;F>1&&(F=1);var S=1/(F=.8+.2*F)*50*P(.9,1.3,L,0,.9),_=.06,k=50/F*1.2*2+P(1.2*M,2*M,L,_,1)+P(2*M,5*M,L,.7,1)+180+(w.closing?1:.25)*P(M,6*M,L,0,.3)-(w.closing?P(P(0,130,L,0,_),0,L,0,.7):0)+P(P(0,200,L,_,.5),0,L,.3,.7),j=50/F*1.2*2+P(1.2*M,2*M,L,_,1)+P(2*M,3*M,L,.7,1)+20+(w.closing?1:.25)*P(0,6*M,L,0,1)-(w.closing?P(P(0,30,L,0,_),0,L,0,.7):0),q=50/F*1.2+P(1.2*M,2*M,L,_,1)+(w.closing?1:.3)*P(0,M*P(4,5,L,.25,.85),L,0,1)+(w.closing?P(P(0,17,L,0,_),0,L,0,.5):0),N=50/F/P(2,3,L,0,_)+M**.8+(w.closing?P(0,M/4,L,.8,1):0)+(w.closing?1:.3)*P(0,2*M,L,0,1)+(w.closing?1:.6)*P(P(0,13,L,0,_),0,L,0,.5),T=P(P(0,w.closing?20:-50,L,0,.7),0,L,.7,1),z=P(P(0,w.closing?50:-45,L,0,.7),0,L,.7,1)+(w.closing?1:0)*P(P(0,s**1.5/1500,L,0,_),0,L,0,1),B=50/7-P(P(0,w.closing?s/7:30,L,_,1),0,L,.7,1)+(w.closing?P(P(0,9,L,0,_),0,L,0,.3):0),H=s-18-S+w.x,R=-18-S-1,D=2.5*-R;var I=function(t){if(!w.closing)return P(t,t-R-36,L,.3,.7);var e=.08595*D;if(t<e){var n=(t-e)/R*(D/(D+e));return 2*(-(n**2)+n)*D+e}return t}(H);let Z=[[s+200,X-o-100],[s-18+1*w.x5-T,X-o-100],[s-18+1*w.x5-T,X-o-100],[s-18+1*w.x5-T,X-k-P(500,700,L,0,.6)],[s-18+1*w.x5-T,X-k-P(300,500,L,0,.6)],[s-18+1*w.x5-T,X-k-P(200,300,L,0,.6)],[s-18+1*w.x5-T,X-k],[s-18+1*w.x4-z,X-j],[s-18-B+w.x2,X-q],[I,X-N],[I,X+N],[s-18-B+w.x2,X+q],[s-18+1*w.x4-z,X+j],[s-18+1*w.x5-T,X+k],[s-18+1*w.x5-T,X+k+P(100,300,L,0,.6)],[s-18+1*w.x5-T,X+k+P(300,500,L,0,.6)],[s-18+1*w.x5-T,X+k+P(500,700,L,0,.6)],[s-18+1*w.x5,X+o+100],[s-18+1*w.x5,X+o+100],[s+200,o+200]];var O=7,V=Z.length,W=.05,$=P(-1,0,H,R/2,0)*P(0,-20,L,.6,.7);w.closing||($=0),Z[O][0]<Z[O+1][0]&&(Z[O][0]=Z[O+1][0]),Z[O][0]=P(Z[O][0],Z[O+1][0]-$,L,W,1),Z[O-1][0]=P(Z[O-1][0],Z[O+1][0]-$,L,W,1),Z[O-2][0]=P(Z[O-2][0],Z[O+1][0]-$,L,W,1),Z[O-3][0]=P(Z[O-3][0],Z[O+1][0]-$,L,W,1),Z[O-4][0]=P(Z[O-4][0],Z[O+1][0]-$,L,W,1),Z[O=V-O-1][0]<Z[O-1][0]&&(Z[O][0]=Z[O-1][0]),Z[O][0]=P(Z[O][0],Z[O-1][0]-$,L,W,1),Z[O+1][0]=P(Z[O+1][0],Z[O-1][0]-$,L,W,1),Z[O+2][0]=P(Z[O+2][0],Z[O-1][0]-$,L,W,1),Z[O+3][0]=P(Z[O+3][0],Z[O-1][0]-$,L,W,1),Z[O+4][0]=P(Z[O+4][0],Z[O-1][0]-$,L,W,1),Z[O=8][0]=Z[O][0]+(w.closing?0:P(0,P(4,0,L,0,1),L,0,.3)),Z[O=V-O-1][0]=Z[O][0]+(w.closing?0:P(0,P(4,0,L,0,1),L,0,.3)),Z=Z.map((t,e)=>[t[0],o-t[1]]);const G=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))(Z,s,o,{yMin:0,yMax:o,xMin:0,xMax:s}),J=a(G);var K=h.getAttribute("d")!=J;(g||K)&&(h.setAttributeNS(null,"d",J),w.update&&w.update(L,(L/.6)**3),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),requestAnimationFrame(e)}catch(t){console.error(t)}}();var L=!1;function M(t){if(L)return;let e,n;L=!0,setTimeout(()=>{L=!1},300),t.preventDefault(),t.stopPropagation();let r=t.composedPath(),i=w.obj.querySelector(".curtain-page");if(!(w.closed||!w.start||!w.obj.contains(r[0])||i&&i.contains(r[0]))){var a=c(t),o=y.getBoundingClientRect();e=a.x-o.x,n=a.y-o.y;var u=w.endX<=-s/2;if(u){if(e>40)return}else{if(!Y(n,m-50,m+50))return;if(!Y(e,s-50,s+50))return}return u&&C(),w.closing=!u,w.mousedown=!0,w.startX=u?s:e,w.startY=n,X(t),!0}}function P(t){let e,n;t.preventDefault(),t.stopPropagation();var r=c(t),i=y.getBoundingClientRect();if(e=r.x-i.x,n=r.y-i.y,w.mousedown){w.mousedown=!1;var a=!w.closing;w.closing&&(w.startX==e&&w.startY==n||Math.abs(w.startX-e)<3&&Math.abs(w.startY-n)<3)||w.endX-w.startX<(a?2*-s/3:-s/3)?(w.startX=0,w.endX=-9999999,w.next&&w.next(w),w.reversible||(w.closed=!0)):(w.startX=0,w.startY=0,w.endX=0,w.endY=0)}}return w.show=function(){w.start=!0,w.closing=!0},w.hide=function(){w.start=!1,w.closing=!1,w.mousedown=!1,w.startX=0,w.startY=0,w.endX=0,w.endY=0},w.endCurtain=P,document.addEventListener("mousedown",t=>{M(t)&&document.addEventListener("mousemove",X)}),document.addEventListener("mouseup",t=>{P(t),document.removeEventListener("mousemove",X)}),document.addEventListener("touchstart",M),document.addEventListener("touchend",(function(t){P(t)})),document.addEventListener("touchmove",X,{passive:!1}),w}}();function makeCurtains(wrapper,load_first){var children=Array.from(wrapper.children),curtains=[];return children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),curtains.push(e.curtain),load_first&&i==children.length-2?e.curtain.show():e.curtain.hide()}}),curtains.reverse(),curtains}export{makeCurtains};