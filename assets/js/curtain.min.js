import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}.arrow{position: absolute;pointer-events: none;width: 25px;z-index:999;opacity: 0;transform: translate(-50%,-50%) rotateZ(180deg);}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,a)=>(t-e)*(a-r)/(n-e)+r;function a(t){var e,n=new Array,r=new Array,a=t.length-1,i=new Array,o=new Array,s=new Array,u=new Array;i[0]=0,o[0]=2,s[0]=1,u[0]=t[0]+2*t[1];for(var c=1;c<a-1;c++)i[c]=1,o[c]=4,s[c]=1,u[c]=4*t[c]+2*t[c+1];for(i[a-1]=2,o[a-1]=7,s[a-1]=0,u[a-1]=8*t[a-1]+t[a],c=1;c<a;c++)e=i[c]/o[c-1],o[c]=o[c]-e*s[c-1],u[c]=u[c]-e*u[c-1];for(n[a-1]=u[a-1]/o[a-1],c=a-2;c>=0;--c)n[c]=(u[c]-s[c]*n[c+1])/o[c];for(c=0;c<a-1;c++)r[c]=2*t[c+1]-n[c+1];return r[a-1]=.5*(t[a]+n[a-1]),{p1:n,p2:r}}const i=t=>function(t){for(var e=t.length,n=new Array,r=new Array,i=0;i<e;i++)n[i]=t[i][0],r[i]=t[i][1];var o,s,u,c,d,l,v,p,f=a(n),x=a(r),h=[];for(i=0;i<e-1;i++)h.push((o=n[i],s=r[i],u=f.p1[i],c=x.p1[i],d=f.p2[i],l=x.p2[i],v=n[i+1],p=r[i+1],o+" "+s+" C "+u+" "+c+" "+d+" "+l+" "+v+" "+p));return"M "+h.join(" L ")+" Z"}(t);var o=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};const s=function(t,e,n,r,a){return n-r>0?((n=(n-r)/(a-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t};function u(t,e){return t>e?e:t}function c(t,e){return t>e?t:e}function d(t,e,n){return(e-t)*n+t}var l,v;function p(){l=parseInt(document.documentElement.style.getPropertyValue("--window-height")||window.innerHeight),v=parseInt(document.documentElement.style.getPropertyValue("--window-width")||window.innerWidth),.01*l,.01*v}window.addEventListener("curtain-resize",p,!1);var f=function(t){p()};window.attachEvent?window.attachEvent("onresize",f):window.addEventListener&&window.addEventListener("resize",f,!0),p();var x=0;var h={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:153,startY:63,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}},m=[],y=Date.now();return function t(){requestAnimationFrame(t);var e=Date.now(),n=e-y;n>1e3/60&&(y=e-n%(1e3/60),m.forEach(t=>t()))}(),function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",a=x+=1,p="curtainClip-"+x,f=document.createElementNS(n,"svg");f.setAttribute("viewbox","0 0 1000 1000"),f.innerHTML='<use xlink:href="#arrow-svg"></use>',f.classList.add("arrow");var y,w=document.createElementNS(n,"svg"),g=document.createElementNS(n,"path"),b=document.createElementNS(n,"clipPath");b.id=p,w.appendChild(b),w.appendChild(document.createElementNS(n,"g")),b.appendChild(g),g.setAttribute("fill","#000"),w.classList.add("curtain"),document.body.appendChild(w);var E=w.getBoundingClientRect();t.insertBefore(f,t.firstChild);var X=Object.assign({},h,e);X.curtain=w,X.path_dom=g,X.endX=X.startX,X.endY=X.startY,X.mousedown=!1;var Y=!1,A=!1;const C=function(){if(!A){var e="url(#"+p+")";t.style.clipPath=e,t.style.webkitClipPath=e,A=!0}},L=function(){A&&(t.style.clipPath="",t.style.webkitClipPath="",A=!1)};C(),X.closed&&(X.startX=0,X.startY=0,X.endX=0,X.endY=0),t.curtain=X,b.curtain=X,X.obj=t,setTimeout((function(t){X.start_ended=!0}),1e3),w.setAttribute("width",v),w.setAttribute("height",l),w.setAttribute("viewbox",`0 0 ${v} ${l}`),X.x=X.startX,X.y=X.startY,X.x2=36,X.y2=X.startY,X.x3=36,X.y3=X.startY,X.x4=36,X.y4=X.startY,X.x5=36,X.y5=X.startY;var M=v,P=l,S="";function _(t){if(X.mousedown){var e=o(t);X.endX=e.x-E.x,X.endY=e.y-E.y}}function k(t,e,n){return t<n&&t>e}function j(){t.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}m.push((function(){try{var e=X.endX;e<-v-3&&(e=-v-3);var n=e-X.startX,o=X.endY-X.startY;X.start_ended&&n>0&&(n=0),y=l*(1-X.but_y_pos);var p=c(0,l-y-125);o>p&&(o=p);var x=u(0,125-y);o<x&&(o=x),!X.start&&X.x>-1&&(n=78),n<-v-5&&(n=-v-5);var h=Math.abs(n-X.x)<1e-5,m=!1;if(v==M&&l==P||!X.start){if(!X.start&&X.x>=68)return Y||(t.style.display="none"),Y=!0,X.active=!1,void(X.x<5-v&&X.closing&&L());if(X.x<-v&&!X.mousedown)return L(),void(X.active=!1);if(h)return X.active=!1,void(X.x<5-v&&X.closing&&L());Y&&(t.style.display="",Y=!1)}else M=v,m=!0,1==a&&console.log(1);X.active=!0,C(),X.x>-30&&j(),X.x=d(X.x,n,.09),X.y=d(X.y,o,.09);var w=X.x,b=y+X.y,E=59*(1-u(1,c(0,w)/43))-50;f.style.top=y+"px",f.style.right=E+"px",f.style.opacity=1-Math.abs(X.x)/43;var A=-w/v;A<0&&(A=0),A>1&&(A=1);var _=60*A,k=X.closing,N=s(k?.1:1,1,A,.2,1),T=s(0,36,w,0,60);X.x2=d(X.x2,u(w<-v?-v:w,s(0,54,w,0,60)),.54),X.x3=d(X.x3,u((X.x2<-v?-v:X.x2)*N,T),.54),X.x4=d(X.x4,u((X.x3<-v?-v:X.x3)*N,T),.54),X.x5=d(X.x5,u((X.x4<-v?-v:X.x4)*N,T),.54),(X.start||w<-60)&&(X.x2<w&&(X.x2=w),X.x3<w&&(X.x3=w),X.x4<w&&(X.x4=w),X.x5<w&&(X.x5=w)),X.x5=X.x4;var z=X.x2,q=(X.x3,X.x4),D=X.x5,H=w<0?10/(-w)**.5:1;H>1&&(H=1);var B=1/(H=.8+.2*H)*50*s(.9,1.3,A,0,.9),I=.06,O=50/H*1.2*2+s(1.2*_,2*_,A,I,1)+s(2*_,5*_,A,.7,1)+180+(k?1:.25)*s(_,6*_,A,0,.3)-(k?s(s(0,130,A,0,I),0,A,0,.7):0)+s(s(0,200,A,I,.5),0,A,.3,.7),V=50/H*1.2*2+s(1.2*_,2*_,A,I,1)+s(2*_,3*_,A,.7,1)+20+(k?1:.25)*s(0,6*_,A,0,1)-(k?s(s(0,30,A,0,I),0,A,0,.7):0),W=50/H*1.2+s(1.2*_,2*_,A,I,1)+(k?1:.3)*s(0,_*s(4,5,A,.25,.85),A,0,1)+(k?s(s(0,17,A,0,I),0,A,0,.5):0),Z=50/H/s(2,3,A,0,I)+_**.8+(k?s(0,_/4,A,.8,1):0)+(k?1:.3)*s(0,2*_,A,0,1)+(k?1:.6)*s(s(0,13,A,0,I),0,A,0,.5),$=s(s(0,k?20:-50,A,0,.7),0,A,.7,1),F=s(s(0,k?50:-45,A,0,.7),0,A,.7,1)+(k?1:0)*s(s(0,v**1.5/1500,A,0,I),0,A,0,1),K=50/7-s(s(0,k?v/7:30,A,I,1),0,A,.7,1)+(k?s(s(0,9,A,0,I),0,A,0,.3):0),R=v-18-B+w,G=-18-B-1,J=function(t,e,n,r){if(!X.closing)return s(t,t-e-36,r,.3,.7);var a=.08595*n;if(t<a){var i=(t-a)/e*(n/(n+a));return 2*(-(i**2)+i)*n+a}return t}(R,G,2.5*-G,A);let rt=[[v+200,b-l-100],[T=v-18+D-$,b-l-100],[T,b-l-100],[T,b-O-s(500,700,A,0,.6)],[T,b-O-s(300,500,A,0,.6)],[T,b-O-s(200,300,A,0,.6)],[T,b-O],[v-18+q-F,b-V],[v-18-K+z,b-W],[J,b-Z],[J,b+Z],[v-18-K+z,b+W],[v-18+q-F,b+V],[T,b+O],[T,b+O+s(100,300,A,0,.6)],[T,b+O+s(300,500,A,0,.6)],[T,b+O+s(500,700,A,0,.6)],[v-18+D,b+l+100],[v-18+D,b+l+100],[v+200,l+200]];var Q=7,U=rt.length,tt=.05,et=s(-1,0,R,G/2,0)*s(0,-20,A,.6,.7);k||(et=0);var nt=rt[Q+1][0];rt[Q][0]<nt&&(rt[Q][0]=nt),rt[Q][0]=s(rt[Q][0],nt-et,A,tt,1),rt[Q-1][0]=s(rt[Q-1][0],nt-et,A,tt,1),rt[Q-2][0]=s(rt[Q-2][0],nt-et,A,tt,1),rt[Q-3][0]=s(rt[Q-3][0],nt-et,A,tt,1),rt[Q-4][0]=s(rt[Q-4][0],nt-et,A,tt,1),nt=rt[Q-1][0],rt[Q=U-Q-1][0]<nt&&(rt[Q][0]=nt),rt[Q][0]=s(rt[Q][0],nt-et,A,tt,1),rt[Q+1][0]=s(rt[Q+1][0],nt-et,A,tt,1),rt[Q+2][0]=s(rt[Q+2][0],nt-et,A,tt,1),rt[Q+3][0]=s(rt[Q+3][0],nt-et,A,tt,1),rt[Q+4][0]=s(rt[Q+4][0],nt-et,A,tt,1),rt[Q=8][0]=rt[Q][0]+(k?0:s(0,s(4,0,A,0,1),A,0,.3)),rt[Q=U-Q-1][0]=rt[Q][0]+(k?0:s(0,s(4,0,A,0,1),A,0,.3)),rt=rt.map((t,e)=>[c(-100,u(v+100,t[0])),c(-100,u(l+100,l-t[1]))]);const at=((t,e,n,a)=>t.map(t=>[r(t[0],a.xMin,a.xMax,0,e),r(t[1],a.yMin,a.yMax,n,0)]))(rt,v,l,{yMin:0,yMax:l,xMin:0,xMax:v}),it=i(at);(m||S!=it)&&(g.setAttributeNS(null,"d",it),S=it,X.update&&X.update(A,(A/.6)**3),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex")}catch(t){console.error(t)}}));var N=!1;function T(t){if(N)return;let e,n;N=!0,setTimeout(()=>{N=!1},300),t.preventDefault(),t.stopPropagation();let r=t.composedPath(),a=X.obj.querySelector(".curtain-page");if(!(X.closed||!X.start||!X.obj.contains(r[0])||a&&a.contains(r[0]))){var i=o(t);e=i.x-E.x,n=i.y-E.y;var s=X.endX<=-v/2;if(s){if(e>40)return}else{if(!k(n,y-100,y+100))return;if(!k(e,v-100,v+100))return}return s&&j(),X.closing=!s,X.mousedown=!0,X.startX=s?v:e,X.startY=n,_(t),!0}}function z(t){let e,n;t.preventDefault(),t.stopPropagation();var r=o(t);if(e=r.x-E.x,n=r.y-E.y,X.mousedown){X.mousedown=!1;var a=!X.closing;X.closing&&(X.startX==e&&X.startY==n||Math.abs(X.startX-e)<3&&Math.abs(X.startY-n)<3)||X.endX-X.startX<(a?2*-v/3:-v/3)?(X.startX=0,X.endX=-9999999,X.next&&X.next(X),X.reversible||(X.closed=!0)):(X.startX=0,X.startY=0,X.endX=0,X.endY=0)}}X.show=function(){X.start=!0,X.closing=!0},X.hide=function(){X.start=!1,X.closing=!1,X.mousedown=!1,X.startX=0,X.startY=0,X.endX=0,X.endY=0},X.endCurtain=z;var q=!0;return document.addEventListener("mousedown",t=>{q&&(q=!1),T(t)&&document.addEventListener("mousemove",_)}),document.addEventListener("mouseup",t=>{z(t),document.removeEventListener("mousemove",_)}),document.addEventListener("touchstart",T),document.addEventListener("touchend",(function(t){z(t)})),document.addEventListener("touchmove",_,{passive:!1}),X}}();function makeCurtains(wrapper,load_first){var children=Array.from(wrapper.children),curtains=[];return children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),curtains.push(e.curtain),load_first&&i==children.length-2?e.curtain.show():e.curtain.hide()}}),curtains.reverse(),curtains}export{makeCurtains};