import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,o=new Array,a=new Array,s=new Array,c=new Array;o[0]=0,a[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var d=1;d<i-1;d++)o[d]=1,a[d]=4,s[d]=1,c[d]=4*t[d]+2*t[d+1];for(o[i-1]=2,a[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],d=1;d<i;d++)e=o[d]/a[d-1],a[d]=a[d]-e*s[d-1],c[d]=c[d]-e*c[d-1];for(n[i-1]=c[i-1]/a[i-1],d=i-2;d>=0;--d)n[d]=(c[d]-s[d]*n[d+1])/a[d];for(d=0;d<i-1;d++)r[d]=2*t[d+1]-n[d+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const o=t=>function(t){for(var e=t.length,n=new Array,r=new Array,o=0;o<e;o++)n[o]=t[o][0],r[o]=t[o][1];var a,s,c,d,u,l,x,p,v=i(n),m=i(r),g=[];for(o=0;o<e-1;o++)g.push((a=n[o],s=r[o],c=v.p1[o],d=m.p1[o],u=v.p2[o],l=m.p2[o],x=n[o+1],p=r[o+1],a.toFixed(2)+" "+s.toFixed(2)+" C "+c.toFixed(2)+" "+d.toFixed(2)+" "+u.toFixed(2)+" "+l.toFixed(2)+" "+x.toFixed(2)+" "+p.toFixed(2)));return"M "+g.join(" L ")+" Z"}(t);var a,s,c=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};function d(t,e){return t>e?e:t}function u(t,e,n){return(e-t)*n+t}function l(){a=window.innerHeight,s=window.innerWidth,.01*window.innerHeight,.01*window.innerWidth}l();var x=function(t){l()};window.attachEvent?window.attachEvent("onresize",x):window.addEventListener&&window.addEventListener("resize",x,!0);var p=0;var v={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:141,startY:51,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}};return function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i="curtainClip-"+(p+=1),l=document.createElement("span");l.classList.add("arrow");var x,m=document.createElementNS(n,"svg"),g=document.createElementNS(n,"path"),f=document.createElementNS(n,"clipPath");f.id=i,m.appendChild(f),m.appendChild(document.createElementNS(n,"g")),f.appendChild(g),g.setAttribute("fill","#9300bb"),m.classList.add("curtain"),document.body.appendChild(m),document.body.appendChild(l);var h=Object.assign({},v,e);function y(t){if(h.mousedown){var e=c(t);h.endX=e.x,h.endY=e.y}}function w(t,e,n){return t<n&&t>e}function b(){t.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}h.curtain=m,h.path_dom=g,h.endX=h.startX,h.endY=h.startY,h.mousedown=!1,t.style.clipPath="url(#"+i+")",t.style.webkitClipPath="url(#"+i+")",h.closed&&(h.startX=0,h.startY=0,h.endX=0,h.endY=0),t.curtain=h,h.obj=t,setTimeout((function(t){h.start_ended=!0}),1e3),m.setAttribute("width",s),m.setAttribute("height",a),m.setAttribute("viewbox",`0 0 ${s} ${a}`),h.x=h.startX,h.y=h.startY,h.x2=12,h.y2=h.startY,h.x3=12,h.y3=h.startY,h.x4=12,h.y4=h.startY,h.x5=12,h.y5=h.startY,function e(){try{var n=h.endX-h.startX,i=h.endY-h.startY,c=Math.abs(n-h.x)<1e-5;if(!h.start&&h.x>=56)return t.style.display="none",void requestAnimationFrame(e);if(h.x<-s&&!h.mousedown||c)return void requestAnimationFrame(e);"none"==t.style.display&&(t.style.display=""),h.start_ended&&n>0&&(n=0),x=a*(1-h.but_y_pos);var l=(W=0)>(D=a-x-125)?W:D;i>l&&(i=l);var p=d(0,125-x);i<p&&(i=p),!h.start&&h.x>-1&&(b(),n=60),n<-s/1-5&&(n=-s/1-5),h.x=u(h.x,n,.09),h.y=u(h.y,i,.09);var v=x+h.y,m=-h.x/s;m<0&&(m=0),m>1&&(m=1);var f=-h.x/d(500,s);f<0&&(f=0),f>1&&(f=1);var y=60*(f=m);function w(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t}h.x2=u(h.x2,d(h.x<-s?-s:h.x,24),.54),h.x3=u(h.x3,d((h.x2<-s?-s:h.x2)*w(h.closing?.1:1,1,m,.2,1),18),.54),h.x4=u(h.x4,d((h.x3<-s?-s:h.x3)*w(h.closing?.1:1,1,m,.2,1),12),.54),h.x5=u(h.x5,d((h.x4<-s?-s:h.x4)*w(h.closing?.1:1,1,m,.2,1),12),.54),(h.start||h.x<-60)&&(h.x2<h.x&&(h.x2=h.x),h.x3<h.x&&(h.x3=h.x),h.x4<h.x&&(h.x4=h.x),h.x5<h.x&&(h.x5=h.x)),h.x5=h.x4;var X=h.x<0?10/(-h.x)**.5:1;X>1&&(X=1);var A=1/(X=.8+.2*X)*50*w(.9,1.3,f,0,.9),E=.06,Y=50/X*1.2*2+w(2*y,5*y,m,.7,1)+180+(h.closing?1:.25)*w(y,6*y,m,0,.3)-(h.closing?w(w(0,130,m,0,E),0,m,0,.7):0)+w(w(0,200,m,E,.5),0,m,.3,.7),C=50/X*1.2*2+w(1.2*y,2*y,m,E,1)+w(2*y,3*y,m,.7,1)+20+(h.closing?1:.25)*w(0,6*y,m,0,1)-(h.closing?w(w(0,30,m,0,E),0,m,0,.7):0),L=50/X*1.2+w(1.2*y,2*y,m,E,1)+(h.closing?1:.3)*w(0,y*w(4,5,m,.25,.85),m,0,1)+(h.closing?w(w(0,17,m,0,E),0,m,0,.5):0),F=50/X/w(2,3,m,0,E)+y**.8+(h.closing?w(0,y/4,m,.8,1):0)+(h.closing?1:.3)*w(0,2*y,m,0,1)+(h.closing?1:.6)*w(w(0,13,m,0,E),0,m,0,.5),M=w(w(0,h.closing?20:-50,m,0,.7),0,m,.7,1),S=w(w(0,h.closing?50:-45,m,0,.7),0,m,.7,1)+(h.closing?1:0)*w(w(0,s**1.5/1500,m,0,E),0,m,0,1),P=50/7-w(w(0,h.closing?s/8:30,m,E,1),0,m,.7,1)+(h.closing?w(w(0,9,m,0,E),0,m,0,.3):0),_=s-6-A+h.x,j=-6-A-1,k=2.5*-j;var q=function(t){if(!h.closing)return w(t,t-j-12,m,.3,.7);var e=.08595*k;if(t<e){var n=(t-e)/j*(k/(k+e));return 2*(-(n**2)+n)*k+e}return t}(_);let O=[[s+200,v-a-100],[s-6+1*h.x5-M,v-a-100],[s-6+1*h.x5-M,v-a-100],[s-6+1*h.x5-M,v-Y-w(500,700,m,0,.6)],[s-6+1*h.x5-M,v-Y-w(300,500,m,0,.6)],[s-6+1*h.x5-M,v-Y-w(200,300,m,0,.6)],[s-6+1*h.x5-M,v-Y],[s-6+1*h.x4-S,v-C],[s-6-P+h.x2,v-L],[q,v-F],[q,v+F],[s-6-P+h.x2,v+L],[s-6+1*h.x4-S,v+C],[s-6+1*h.x5-M,v+Y],[s-6+1*h.x5-M,v+Y+w(100,300,m,0,.6)],[s-6+1*h.x5-M,v+Y+w(300,500,m,0,.6)],[s-6+1*h.x5-M,v+Y+w(500,700,m,0,.6)],[s-6+1*h.x5,v+a+100],[s-6+1*h.x5,v+a+100],[s+200,a+200]];var N=7,T=O.length,z=.05,H=w(-1,0,_,j/2,0)*w(0,-20,m,.6,.7);h.closing||(H=0),O[N][0]<O[N+1][0]&&(O[N][0]=O[N+1][0]),O[N][0]=w(O[N][0],O[N+1][0]-H,m,z,1),O[N-1][0]=w(O[N-1][0],O[N+1][0]-H,m,z,1),O[N-2][0]=w(O[N-2][0],O[N+1][0]-H,m,z,1),O[N-3][0]=w(O[N-3][0],O[N+1][0]-H,m,z,1),O[N-4][0]=w(O[N-4][0],O[N+1][0]-H,m,z,1),O[N=T-N-1][0]<O[N-1][0]&&(O[N][0]=O[N-1][0]),O[N][0]=w(O[N][0],O[N-1][0]-H,m,z,1),O[N+1][0]=w(O[N+1][0],O[N-1][0]-H,m,z,1),O[N+2][0]=w(O[N+2][0],O[N-1][0]-H,m,z,1),O[N+3][0]=w(O[N+3][0],O[N-1][0]-H,m,z,1),O[N+4][0]=w(O[N+4][0],O[N-1][0]-H,m,z,1),O[N=8][0]=O[N][0]+(h.closing?0:w(0,w(4,0,f,0,1),f,0,.3)),O[N=T-N-1][0]=O[N][0]+(h.closing?0:w(0,w(4,0,f,0,1),f,0,.3)),O=O.map((t,e)=>[t[0],a-t[1]]);const $=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))(O,s,a,{yMin:0,yMax:a,xMin:0,xMax:s}),K=o($);g.getAttribute("d")!=K&&(g.setAttributeNS(null,"d",K),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),requestAnimationFrame(e)}catch(t){console.error(t)}var W,D}();var X=!1;function A(t){if(X)return;let e,n;X=!0,setTimeout(()=>{X=!1},300),t.preventDefault(),t.stopPropagation();let r=t.composedPath(),i=h.obj.querySelector(".curtain-page");if(!(h.closed||!h.start||!h.obj.contains(r[0])||i&&i.contains(r[0]))){var o=c(t);e=o.x,n=o.y;var a=h.endX<=-s/2;if(a){if(e>40)return}else{if(!w(n,x-50,x+50))return;if(!w(e,s-50,s+50))return}return a&&b(),h.closing=!a,h.mousedown=!0,h.startX=a?s:e,h.startY=n,y(t),!0}}function E(t){let e,n;t.preventDefault(),t.stopPropagation();var r=c(t);if(e=r.x,n=r.y,h.mousedown){h.mousedown=!1;var i=!h.closing;h.closing&&h.startX==e&&h.startY==n||h.endX-h.startX<(i?2*-s/3:-s/3)?(h.startX=0,h.endX=-s/1-3,h.next&&h.next(h),h.reversible||(h.closed=!0)):(h.startX=0,h.startY=0,h.endX=0,h.endY=0)}}return h.show=function(){h.start=!0,h.closing=!0},h.hide=function(){h.start=!1,h.closing=!1,h.mousedown=!1,h.startX=0,h.startY=0,h.endX=0,h.endY=0},h.endCurtain=E,document.addEventListener("mousedown",t=>{A(t)&&document.addEventListener("mousemove",y)}),document.addEventListener("mouseup",t=>{E(t),document.removeEventListener("mousemove",y)}),document.addEventListener("touchstart",A),document.addEventListener("touchend",(function(t){E(t)})),document.addEventListener("touchmove",y,{passive:!1}),h}}();function makeCurtains(wrapper){var children=Array.from(wrapper.children);children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),i==children.length-2?e.curtain.show():e.curtain.hide()}})}export{makeCurtains};