import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}.arrow{color:white;position: absolute;pointer-events: none;width: 25px;z-index:999;opacity: 0;transform: translate(-50%,-50%) rotateZ(0deg);    transform-origin: 150% 50%;}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,u=new Array;a[0]=0,o[0]=2,s[0]=1,u[0]=t[0]+2*t[1];for(var c=1;c<i-1;c++)a[c]=1,o[c]=4,s[c]=1,u[c]=4*t[c]+2*t[c+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,u[i-1]=8*t[i-1]+t[i],c=1;c<i;c++)e=a[c]/o[c-1],o[c]=o[c]-e*s[c-1],u[c]=u[c]-e*u[c-1];for(n[i-1]=u[i-1]/o[i-1],c=i-2;c>=0;--c)n[c]=(u[c]-s[c]*n[c+1])/o[c];for(c=0;c<i-1;c++)r[c]=2*t[c+1]-n[c+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const a=t=>function(t){for(var e=t.length,n=new Array,r=new Array,a=0;a<e;a++)n[a]=t[a][0],r[a]=t[a][1];var o,s,u,c,d,l,p,v,h=i(n),x=i(r),f=[];for(a=0;a<e-1;a++)f.push((o=n[a],s=r[a],u=h.p1[a],c=x.p1[a],d=h.p2[a],l=x.p2[a],p=n[a+1],v=r[a+1],o.toFixed(0)+" "+s.toFixed(0)+" C "+u.toFixed(0)+" "+c.toFixed(0)+" "+d.toFixed(0)+" "+l.toFixed(0)+" "+p.toFixed(0)+" "+v.toFixed(0)));return"M "+f.join(" L ")+" Z"}(t);var o=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};const s=function(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t};function u(t,e){return t>e?e:t}function c(t,e){return t>e?t:e}function d(t,e,n){return(e-t)*n+t}var l,p,v;window.innerHeight,window.innerWidth;function h(){l=parseInt(document.documentElement.style.getPropertyValue("--window-height")||window.innerHeight),p=parseInt(document.documentElement.style.getPropertyValue("--window-width")||window.innerWidth),window.innerHeight,window.innerWidth,v=parseFloat(document.documentElement.style.getPropertyValue("--scale")||1)}window.addEventListener("curtain-resize",h,!1);var x=function(t){h()};window.attachEvent?window.attachEvent("onresize",x):window.addEventListener&&window.addEventListener("resize",x,!0),h();var f=0;var m={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,right_pad:8,but_size:40,nextFrame:[],nextClick:[],next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}},y=[],w=Date.now();return function t(){requestAnimationFrame(t);var e=Date.now(),n=e-w;n>1e3/60&&(w=e-n%(1e3/60),y.forEach(t=>t()))}(),function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i="curtainClip-"+(f+=1),h=document.createElementNS(n,"svg");h.setAttribute("viewbox","0 0 1000 1000"),h.innerHTML='<use xlink:href="#arrow-svg"></use>',h.classList.add("arrow");var x,w=document.createElementNS(n,"svg"),g=document.createElementNS(n,"path"),b=document.createElementNS(n,"clipPath");b.id=i,w.appendChild(b),w.appendChild(document.createElementNS(n,"g")),b.appendChild(g),g.setAttribute("fill","#000"),w.classList.add("curtain"),document.body.appendChild(w);var E=t.getBoundingClientRect();setTimeout((function(){E=t.getBoundingClientRect()}),2e3),t.insertBefore(h,t.firstChild);var X=Object.assign({},m,e),C=X.but_size,Y=X.right_pad||0;X.curtain=w,X.path_dom=g,X.startX||(X.startX=Y+.9*C*3),X.startY||(X.startY=0),X.endX=X.startX,X.endY=X.startY,X.mousedown=!1,h.style.transform="translate(-50%,-50%) rotateZ(0deg) scale("+C/40+")";var A=!1,F=!1;const L=function(){if(!F){var e="url(#"+i+")";t.style.clipPath=e,t.style.webkitClipPath=e,F=!0,X.nextFrame.push(t=>window.dispatchEvent(new Event("resize")))}},M=function(){F&&(t.style.clipPath="",t.style.webkitClipPath="",F=!1,X.nextFrame.push(t=>window.dispatchEvent(new Event("resize"))))};L(),X.closed&&(X.startX=0,X.startY=0,X.endX=0,X.endY=0),t.curtain=X,b.curtain=X,X.obj=t,setTimeout((function(t){X.start_ended=!0}),1e3),w.setAttribute("width",p),w.setAttribute("height",l),w.setAttribute("viewbox",`0 0 ${p} ${l}`),X.x=X.startX,X.y=X.startY,X.x2=2*Y,X.y2=X.startY,X.x3=2*Y,X.y3=X.startY,X.x4=2*Y,X.y4=X.startY,X.x5=2*Y,X.y5=X.startY;var P=p,_=l,k="",S=0;function j(t){if(X.mousedown){var e=o(t);X.endX=(e.x-E.x)/v,X.endY=(e.y-E.y)/v,t.preventDefault(),t.stopPropagation()}}function z(t,e,n){return t<n&&t>e}function T(){var e=t.querySelector(".curtain-page");e&&e.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}y.push((function(){try{var e=X.endX;e<-p-3&&(e=-p-3);var n=e-X.startX,i=X.endY-X.startY;X.start_ended&&n>0&&(n=0),x=l*(1-X.but_y_pos);var o=c(0,l-x-2.5*C);i>o&&(i=o);var v=u(0,2.5*C-x);i<v&&(i=v);const it=X.x;!X.start&&X.x>-1&&(n=60+Y),n<-p-5&&(n=-p-5);var f=Math.abs(n-X.x)<1e-5,m=!1;if(p==P&&l==_||!X.start){if(!X.start&&X.x>=Y+C)return A||(t.style.display="none"),A=!0,X.active=!1,void(X.x<5-p&&X.closing&&M());if(X.x<-p&&!X.mousedown)return M(),void(X.active=!1);if(f)return X.active=!1,void(X.x<5-p&&X.closing&&M());A&&(t.style.display="",A=!1)}else P=p,_=l,m=!0;X.active=!0,L(),X.x>-30&&T(),X.x=d(X.x,n,.09),X.y=d(X.y,i,.09);var y=x+X.y,w=(1-u(1,c(0,it)/(Y+C/2)))*(Y/4+50)-50;h.style.top=y+"px",h.style.right=w+"px",S=d(S,c(0,1-Math.abs(X.x)/(Y+C/2)),.15),h.style.opacity=S;var b=-it/p;b<0&&(b=0),b>1&&(b=1);var E=60*b,F=X.closing,j=s(F?.1:1,1,b,.2,1),z=s(0,2*Y,it,0,60);X.x2=d(X.x2,u(it<-p?-p:it,s(0,3*Y,it,0,60)),.54),X.x3=d(X.x3,u((X.x2<-p?-p:X.x2)*j,z),.54),X.x4=d(X.x4,u((X.x3<-p?-p:X.x3)*j,z),.54),X.x5=d(X.x5,u((X.x4<-p?-p:X.x4)*j,z),.54),(X.start||it<-60)&&(X.x2<it&&(X.x2=it),X.x3<it&&(X.x3=it),X.x4<it&&(X.x4=it),X.x5<it&&(X.x5=it)),X.x5=X.x4;var N=X.x2,q=(X.x3,X.x4),D=X.x5,B=it<0?10/(-it)**.5:1;B>1&&(B=1);var H=C*(1/(B=.8+.2*B))*s(.9,1.3,b,0,.9),W=.06,R=C/B*1.2*2+s(1.2*E,2*E,b,W,1)+s(2*E,5*E,b,.7,1)+180+(F?1:.25)*s(E,6*E,b,0,.3)-(F?s(s(0,130,b,0,W),0,b,0,.7):0)+s(s(0,200,b,W,.5),0,b,.3,.7),V=C/B*1.2*2+s(1.2*E,2*E,b,W,1)+s(2*E,3*E,b,.7,1)+20+(F?1:.25)*s(0,6*E,b,0,1)-(F?s(s(0,30,b,0,W),0,b,0,.7):0),Z=C/B*1.2+s(1.2*E,2*E,b,W,1)+(F?1:.3)*s(0,E*s(4,5,b,.25,.85),b,0,1)+(F?s(s(0,17,b,0,W),0,b,0,.5):0),I=C/B/s(2,3,b,0,W)+E**.8+(F?s(0,E/4,b,.8,1):0)+(F?1:.3)*s(0,2*E,b,0,1)+(F?1:.6)*s(s(0,13,b,0,W),0,b,0,.5),O=s(s(0,F?20:-50,b,0,.7),0,b,.7,1),$=s(s(0,F?50:-45,b,0,.7),0,b,.7,1)+(F?1:0)*s(s(0,p**1.5/1500,b,0,W),0,b,0,1),K=C/7-s(s(0,F?p/7*C/40:30,b,W,1),0,b,.7,1)+(F?s(s(0,9,b,0,W),0,b,0,.3):0),G=p-Y-H+it,J=-Y-H-1,Q=function(t,e,n,r){if(!X.closing)return s(t,t-e-2*Y,r,.3,.7);var i=.08595*n;if(t<i){var a=(t-i)/e*(n/(n+i));return 2*(-(a**2)+a)*n+i}return t}(G,J,2.5*-J,b),U=[[p+200,y-l-120],[-200,y-l-110],[p+200,y-l-110],[p+200,y-l-100],[p-Y+D,y-l-100],[p-Y+D,y-l-100],[z=p-Y+D-O,y-R-s(500,700,b,0,.6)],[z,y-R-s(300,500,b,0,.6)],[z,y-R-s(200,300,b,0,.6)],[z,y-R],[p-Y+q-$,y-V],[p-Y-K+N,y-Z],[Q,y-I],[Q,y+I],[p-Y-K+N,y+Z],[p-Y+q-$,y+V],[z,y+R],[z,y+R+s(200,300,b,0,.6)],[z,y+R+s(300,500,b,0,.6)],[z,y+R+s(500,700,b,0,.6)],[p-Y+D,y+l+100],[p-Y+D,y+l+100],[p+200,l+200],[p+200,l+210],[-200,l+210],[p+200,l+220]],tt=7,et=U.length,nt=.05,rt=s(-1,0,G,J/2,0)*s(0,-20,b,.6,.7);F||(rt=0),U[tt][0]<U[tt+1][0]&&(U[tt][0]=U[tt+1][0]),U[tt][0]=s(U[tt][0],U[tt+1][0]-rt,b,nt,1),U[tt-1][0]=s(U[tt-1][0],U[tt+1][0]-rt,b,nt,1),U[tt-2][0]=s(U[tt-2][0],U[tt+1][0]-rt,b,nt,1),U[tt-3][0]=s(U[tt-3][0],U[tt+1][0]-rt,b,nt,1),U[tt-4][0]=s(U[tt-4][0],U[tt+1][0]-rt,b,nt,1),U[tt=et-tt-1][0]<U[tt-1][0]&&(U[tt][0]=U[tt-1][0]),U[tt][0]=s(U[tt][0],U[tt-1][0]-rt,b,nt,1),U[tt+1][0]=s(U[tt+1][0],U[tt-1][0]-rt,b,nt,1),U[tt+2][0]=s(U[tt+2][0],U[tt-1][0]-rt,b,nt,1),U[tt+3][0]=s(U[tt+3][0],U[tt-1][0]-rt,b,nt,1),U[tt+4][0]=s(U[tt+4][0],U[tt-1][0]-rt,b,nt,1),U[tt=8][0]=U[tt][0]+(X.closing?0:s(0,s(4,0,b,0,1),b,0,.3)),U[tt=et-tt-1][0]=U[tt][0]+(X.closing?0:s(0,s(4,0,b,0,1),b,0,.3));const at=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))(U=U.map((t,e)=>[t[0],l-t[1]]),p,l,{yMin:0,yMax:l,xMin:0,xMax:p}),ot=a(at);(m||k!=ot)&&(g.setAttributeNS(null,"d",ot),k=ot,X.update&&X.update(X,b,(b/.6)**3)),X.nextFrame.length>0&&X.nextFrame.shift()()}catch(t){console.error(t)}}));var N=!1;function q(e){if(!N){var n,r;N=!0,setTimeout(()=>{N=!1},300);var i=e.composedPath(),a=X.obj.querySelector(".curtain-page");if(!(X.closed||!X.start||!X.obj.contains(i[0])||a&&a.contains(i[0]))){E=t.getBoundingClientRect();var s=o(e);n=(s.x-E.x)/v,r=(s.y-E.y)/v;var u=X.endX<=-p/2;if(u){if(n>40)return}else{if(!z(r,x-2*C,x+2*C))return;if(!z(n,p-2*C,p+2*C))return}return u&&T(),e.preventDefault(),e.stopPropagation(),X.closing=!u,X.mousedown=!0,X.startX=u?p:n,X.startY=r,j(e),!0}}}function D(){X.startX=0,X.endX=-9999999,X.next&&(X.next(X),Array.from(X.obj.parentElement.children).filter(t=>t!=X.obj).forEach(t=>{t.style.pointerEvents="none",setTimeout((function(){t.style.display="none"}),1e3)})),X.reversible||(X.closed=!0)}function B(t){if(!0===t)return X.startX=0,X.endX=-9999999,X.next&&X.next(X),void(X.reversible||(X.closed=!0));var e,n,r=o(t);if(e=(r.x-E.x)/v,n=(r.y-E.y)/v,X.mousedown){X.mousedown=!1;var i=!X.closing,a=X.closing&&(X.startX==e&&X.startY==n||Math.abs(X.startX-e)<3&&Math.abs(X.startY-n)<3);t.preventDefault(),t.stopPropagation(),a||X.endX-X.startX<(i?2*-p/3:-p/3)?D():(X.startX=0,X.startY=0,X.endX=0,X.endY=0)}}X.show=function(){X.start=!0,X.closing=!0},X.hide=function(){X.start=!1,X.closing=!1,X.mousedown=!1,X.startX=0,X.startY=0,X.endX=0,X.endY=0},X.endCurtain=B,X.finishCurtain=D;var H=!0,W=document;return(W=X.obj.parentElement).addEventListener("mousedown",t=>{H&&(H=!1),X.nextClick.length>0&&X.nextClick.shift()(),q(t)&&W.addEventListener("mousemove",j)}),W.addEventListener("mouseup",t=>{B(t),W.removeEventListener("mousemove",j)}),W.addEventListener("touchstart",q),W.addEventListener("touchend",(function(t){B(t)})),W.addEventListener("touchmove",j,{passive:!1}),X}}();function makeCurtains(wrapper,load_first){var children=Array.from(wrapper.children),curtains=[];return children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),curtains.push(e.curtain),load_first&&i==children.length-2?e.curtain.show():e.curtain.hide()}}),curtains.reverse(),curtains}export{makeCurtains};