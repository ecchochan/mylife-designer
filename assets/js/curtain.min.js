import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}";styler("curtain-css",css);var makeCurtain=function(){const t=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function e(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,c=new Array;a[0]=0,o[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var d=1;d<i-1;d++)a[d]=1,o[d]=4,s[d]=1,c[d]=4*t[d]+2*t[d+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],d=1;d<i;d++)e=a[d]/o[d-1],o[d]=o[d]-e*s[d-1],c[d]=c[d]-e*c[d-1];for(n[i-1]=c[i-1]/o[i-1],d=i-2;d>=0;--d)n[d]=(c[d]-s[d]*n[d+1])/o[d];for(d=0;d<i-1;d++)r[d]=2*t[d+1]-n[d+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const n=t=>function(t){for(var n=t.length,r=new Array,i=new Array,a=0;a<n;a++)r[a]=t[a][0],i[a]=t[a][1];var o,s,c,d,u,l,x,p,g=e(r),v=e(i),h=[];for(a=0;a<n-1;a++)h.push((o=r[a],s=i[a],c=g.p1[a],d=v.p1[a],u=g.p2[a],l=v.p2[a],x=r[a+1],p=i[a+1],o+" "+s+" C "+c+" "+d+" "+u+" "+l+" "+x+" "+p));return"M "+h.join(" L ")+" Z"}(t);function r(t,e){return t>e?e:t}function i(t,e,n){return(e-t)*n+t}var a,o;function s(){a=window.innerHeight,o=window.innerWidth,.01*window.innerHeight,.01*window.innerWidth}s();var c=function(t){s()};window.attachEvent?window.attachEvent("onresize",c):window.addEventListener&&window.addEventListener("resize",c,!0);var d=0;var u={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:141,startY:51,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}};return function(e,s){s=s||{};var c="http://www.w3.org/2000/svg",l="curtainClip-"+(d+=1),x=document.createElement("span");x.classList.add("arrow");var p,g=document.createElementNS(c,"svg"),v=document.createElementNS(c,"path"),h=document.createElementNS(c,"clipPath");h.id=l,g.appendChild(h),g.appendChild(document.createElementNS(c,"g")),h.appendChild(v),v.setAttribute("fill","#9300bb"),g.classList.add("curtain"),document.body.appendChild(g),document.body.appendChild(x);var f=Object.assign({},u,s);function m(t){f.mousedown&&(t.type.includes("touch")?(f.endX=t.touches[0].pageX,f.endY=t.touches[0].pageY):(f.endX=t.pageX,f.endY=t.pageY))}function w(t,e,n){return t<n&&t>e}function y(t){let n,r,i=f.obj.querySelector(".curtain-page");if(!(f.closed||!f.start||!f.obj.contains(t.path[0])||i&&i.contains(t.path[0]))){t.type.includes("touch")?(n=t.touches[0].pageX,r=t.touches[0].pageY):(n=t.pageX,r=t.pageY);var a=f.endX<=-o/2;if(a){if(n>40)return}else{if(!w(r,p-50,p+50))return;if(!w(n,o-50,o+50))return}if(a){var s=e.querySelector(".curtain-page");s&&s.curtain.hide()}return t.stopPropagation(),t.preventDefault(),f.closing=!a,f.mousedown=!0,f.startX=a?o:n,f.startY=r,m(t),!0}}function X(t){let e,n;if(t.type.includes("touch")?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.pageX,n=t.pageY),f.mousedown){f.mousedown=!1;var r=!f.closing;f.closing&&f.startX==e&&f.startY==n||f.endX-f.startX<(r?2*-o/3:-o/3)?(f.startX=0,f.endX=-o/1-3,f.next&&f.next(f),f.reversible||(f.closed=!0)):(f.startX=0,f.startY=0,f.endX=0,f.endY=0)}}return f.curtain=g,f.path_dom=v,f.endX=f.startX,f.endY=f.startY,f.mousedown=!1,e.style.clipPath="url(#"+l+")",e.style.webkitClipPath="url(#"+l+")",f.closed&&(f.startX=0,f.startY=0,f.endX=0,f.endY=0),e.curtain=f,f.obj=e,setTimeout((function(t){f.start_ended=!0}),1e3),g.setAttribute("width",o),g.setAttribute("height",a),g.setAttribute("viewbox",`0 0 ${o} ${a}`),f.x=f.startX,f.y=f.startY,f.x2=12,f.y2=f.startY,f.x3=12,f.y3=f.startY,f.x4=12,f.y4=f.startY,f.x5=12,f.y5=f.startY,function s(){var c=f.endX-f.startX,d=f.endY-f.startY;if(!f.start&&f.x>=56)return e.style.display="none",void requestAnimationFrame(s);if(f.x<-o&&!f.mousedown)return void requestAnimationFrame(s);"none"==e.style.display&&(e.style.display=""),f.start_ended&&c>0&&(c=0),p=a*(1-f.but_y_pos);var u,l,x=(u=0)>(l=a-p-125)?u:l;d>x&&(d=x);var g=r(0,125-p);d<g&&(d=g),!f.start&&f.x>-1&&(c=60),c<-o/1-5&&(c=-o/1-5),f.x=i(f.x,c,.09),f.y=i(f.y,d,.09);var h=p+f.y,m=-f.x/o;m<0&&(m=0),m>1&&(m=1);var w=-f.x/r(500,o);w<0&&(w=0),w>1&&(w=1);var y=60*(w=m);function X(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t}f.x2=i(f.x2,r(f.x<-o?-o:f.x,60),.54),f.x3=i(f.x3,r((f.x2<-o?-o:f.x2)*X(f.closing?.1:1,1,m,.2,1),60),.54),f.x4=i(f.x4,r((f.x3<-o?-o:f.x3)*X(f.closing?.1:1,1,m,.2,1),60),.54),f.x5=i(f.x5,r((f.x4<-o?-o:f.x4)*X(f.closing?.1:1,1,m,.2,1),60),.54),(f.start||f.x<-60)&&(f.x2<f.x&&(f.x2=f.x),f.x3<f.x&&(f.x3=f.x),f.x4<f.x&&(f.x4=f.x),f.x5<f.x&&(f.x5=f.x)),f.x5=f.x4;var Y=f.x<0?10/(-f.x)**.5:1;Y>1&&(Y=1);var b=1/(Y=.8+.2*Y)*50*X(.9,1.3,w,0,.9),A=.06,E=50/Y*1.2*2+X(2*y,5*y,m,.7,1)+180+(f.closing?1:.25)*X(y,6*y,m,0,.3)-(f.closing?X(X(0,130,m,0,A),0,m,0,.7):0)+X(X(0,200,m,A,.5),0,m,.3,.7),C=50/Y*1.2*2+X(1.2*y,2*y,m,A,1)+X(2*y,3*y,m,.7,1)+20+(f.closing?1:.25)*X(0,6*y,m,0,1)-(f.closing?X(X(0,30,m,0,A),0,m,0,.7):0),L=50/Y*1.2+X(1.2*y,2*y,m,A,1)+(f.closing?1:.3)*X(0,y*X(4,5,m,.25,.85),m,0,1)+(f.closing?X(X(0,17,m,0,A),0,m,0,.5):0),M=50/Y/X(2,3,m,0,A)+y**.8+(f.closing?X(0,y/4,m,.8,1):0)+(f.closing?1:.3)*X(0,2*y,m,0,1)+(f.closing?1:.6)*X(X(0,13,m,0,A),0,m,0,.5),_=X(X(0,f.closing?20:-50,m,0,.7),0,m,.7,1),j=X(X(0,f.closing?50:-45,m,0,.7),0,m,.7,1)+(f.closing?1:0)*X(X(0,o**1.5/1500,m,0,A),0,m,0,1),S=50/7-X(X(0,f.closing?o/8:30,m,A,1),0,m,.7,1)+(f.closing?X(X(0,9,m,0,A),0,m,0,.3):X(X(0,0,m,0,.4),0,m,.4,.6)),k=o-6-b+f.x,q=-6-b-1,N=2.5*-q;function P(t){if(!f.closing)return X(t,t-q-12,m,.3,.7);var e=.08595*N;if(t<e){var n=(t-e)/q*(N/(N+e));return 2*(-(n**2)+n)*N+e}return t}let T=[[o+200,h-a-100],[o-6+1*f.x5-_,h-a-100],[o-6+1*f.x5-_,h-a-100],[o-6+1*f.x5-_,h-E-X(500,700,m,0,.6)],[o-6+1*f.x5-_,h-E-X(300,500,m,0,.6)],[o-6+1*f.x5-_,h-E-X(200,300,m,0,.6)],[o-6+1*f.x5-_,h-E],[o-6+1*f.x4-j,h-C],[o-6-S+f.x2,h-L],[P(k),h-M],[P(k),h+M],[o-6-S+f.x2,h+L],[o-6+1*f.x4-j,h+C],[o-6+1*f.x5-_,h+E],[o-6+1*f.x5-_,h+E+X(100,300,m,0,.6)],[o-6+1*f.x5-_,h+E+X(300,500,m,0,.6)],[o-6+1*f.x5-_,h+E+X(500,700,m,0,.6)],[o-6+1*f.x5,h+a+100],[o-6+1*f.x5,h+a+100],[o+200,a+200]];var z=7,F=T.length,H=.15,W=X(-1,0,k,q/2,0)*X(0,-20,m,.6,.7);f.closing||(W=0),T[z][0]<T[z+1][0]&&(T[z][0]=T[z+1][0]),T[z][0]=X(T[z][0],T[z+1][0]-W,m,H,1),T[z-1][0]=X(T[z-1][0],T[z+1][0]-W,m,H,1),T[z-2][0]=X(T[z-2][0],T[z+1][0]-W,m,H,1),T[z-3][0]=X(T[z-3][0],T[z+1][0]-W,m,H,1),T[z-4][0]=X(T[z-4][0],T[z+1][0]-W,m,H,1),T[z=F-z-1][0]<T[z-1][0]&&(T[z][0]=T[z-1][0]),T[z][0]=X(T[z][0],T[z-1][0]-W,m,H,1),T[z+1][0]=X(T[z+1][0],T[z-1][0]-W,m,H,1),T[z+2][0]=X(T[z+2][0],T[z-1][0]-W,m,H,1),T[z+3][0]=X(T[z+3][0],T[z-1][0]-W,m,H,1),T[z+4][0]=X(T[z+4][0],T[z-1][0]-W,m,H,1),T[z=8][0]=T[z][0]+(f.closing?0:X(0,X(4,0,w,0,1),w,0,.3)),T[z=F-z-1][0]=T[z][0]+(f.closing?0:X(0,X(4,0,w,0,1),w,0,.3)),T=T.map((t,e)=>[t[0],a-t[1]]);const $=((e,n,r,i)=>e.map(e=>[t(e[0],i.xMin,i.xMax,0,n),t(e[1],i.yMin,i.yMax,r,0)]))(T,o,a,{yMin:0,yMax:a,xMin:0,xMax:o}),D=n($);v.setAttribute("d",D),requestAnimationFrame(s)}(),f.show=function(){f.start=!0,f.closing=!0},f.hide=function(){f.start=!1,f.closing=!1,f.mousedown=!1,f.startX=0,f.startY=0,f.endX=0,f.endY=0},f.endCurtain=X,document.addEventListener("mousedown",t=>{y(t)&&document.addEventListener("mousemove",m)}),document.addEventListener("mouseup",t=>{X(t),document.removeEventListener("mousemove",m)}),document.addEventListener("touchstart",y),document.addEventListener("touchend",(function(t){X(t)})),document.addEventListener("touchmove",m),f}}();function makeCurtains(wrapper){var children=Array.from(wrapper.children);children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),i==children.length-2?e.curtain.show():e.curtain.hide()}})}export{makeCurtains};