import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,a=new Array,o=new Array,s=new Array,c=new Array;a[0]=0,o[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var u=1;u<i-1;u++)a[u]=1,o[u]=4,s[u]=1,c[u]=4*t[u]+2*t[u+1];for(a[i-1]=2,o[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],u=1;u<i;u++)e=a[u]/o[u-1],o[u]=o[u]-e*s[u-1],c[u]=c[u]-e*c[u-1];for(n[i-1]=c[i-1]/o[i-1],u=i-2;u>=0;--u)n[u]=(c[u]-s[u]*n[u+1])/o[u];for(u=0;u<i-1;u++)r[u]=2*t[u+1]-n[u+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const a=t=>function(t){for(var e=t.length,n=new Array,r=new Array,a=0;a<e;a++)n[a]=t[a][0],r[a]=t[a][1];var o,s,c,u,d,l,x,p,v=i(n),m=i(r),h=[];for(a=0;a<e-1;a++)h.push((o=n[a],s=r[a],c=v.p1[a],u=m.p1[a],d=v.p2[a],l=m.p2[a],x=n[a+1],p=r[a+1],o.toFixed(3)+" "+s.toFixed(3)+" C "+c.toFixed(3)+" "+u.toFixed(3)+" "+d.toFixed(3)+" "+l.toFixed(3)+" "+x.toFixed(3)+" "+p.toFixed(3)));return"M "+h.join(" L ")+" Z"}(t);var o,s,c=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};function u(t,e){return t>e?e:t}function d(t,e,n){return(e-t)*n+t}function l(){o=window.innerHeight,s=window.innerWidth,.01*window.innerHeight,.01*window.innerWidth}l();var x=function(t){l()};window.attachEvent?window.attachEvent("onresize",x):window.addEventListener&&window.addEventListener("resize",x,!0);var p=0;var v={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:141,startY:51,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}};return function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i="curtainClip-"+(p+=1),l=document.createElement("span");l.classList.add("arrow");var x,m=document.createElementNS(n,"svg"),h=document.createElementNS(n,"path"),f=document.createElementNS(n,"clipPath");f.id=i,m.appendChild(f),m.appendChild(document.createElementNS(n,"g")),f.appendChild(h),h.setAttribute("fill","#9300bb"),m.classList.add("curtain"),document.body.appendChild(m),document.body.appendChild(l);var g=Object.assign({},v,e);g.curtain=m,g.path_dom=h,g.endX=g.startX,g.endY=g.startY,g.mousedown=!1;const y=function(){var e="url(#"+i+")";t.style.clipPath!=e&&(t.style.clipPath=e,t.style.webkitClipPath=e)};function w(t){if(g.mousedown){var e=c(t);g.endX=e.x,g.endY=e.y}}function b(t,e,n){return t<n&&t>e}function X(){t.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}y(),g.closed&&(g.startX=0,g.startY=0,g.endX=0,g.endY=0),t.curtain=g,f.curtain=g,g.obj=t,setTimeout((function(t){g.start_ended=!0}),1e3),m.setAttribute("width",s),m.setAttribute("height",o),m.setAttribute("viewbox",`0 0 ${s} ${o}`),g.x=g.startX,g.y=g.startY,g.x2=12,g.y2=g.startY,g.x3=12,g.y3=g.startY,g.x4=12,g.y4=g.startY,g.x5=12,g.y5=g.startY,function e(){try{g.active=!1;var n=g.endX-g.startX,i=g.endY-g.startY,c=Math.abs(n-g.x)<1e-5;if(!g.start&&g.x>=56)return t.style.display="none",void requestAnimationFrame(e);if(g.x<-s&&!g.mousedown)return requestAnimationFrame(e),void(""!=t.style.clipPath&&(t.style.clipPath="",t.style.webkitClipPath=""));if(c)return void requestAnimationFrame(e);"none"==t.style.display&&(t.style.display=""),g.active=!0,y(),g.start_ended&&n>0&&(n=0),x=o*(1-g.but_y_pos);var l=(D=0)>(O=o-x-125)?D:O;i>l&&(i=l);var p=u(0,125-x);i<p&&(i=p),g.x>-30&&X(),!g.start&&g.x>-1&&(n=60),n<-s/1-5&&(n=-s/1-5),g.x=d(g.x,n,.09),g.y=d(g.y,i,.09);var v=x+g.y,m=-g.x/s;m<0&&(m=0),m>1&&(m=1);var f=-g.x/u(500,s);f<0&&(f=0),f>1&&(f=1);var w=60*(f=m);function b(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t}g.x2=d(g.x2,u(g.x<-s?-s:g.x,b(0,18,g.x,0,60)),.54),g.x3=d(g.x3,u((g.x2<-s?-s:g.x2)*b(g.closing?.1:1,1,m,.2,1),b(0,12,g.x,0,60)),.54),g.x4=d(g.x4,u((g.x3<-s?-s:g.x3)*b(g.closing?.1:1,1,m,.2,1),b(0,12,g.x,0,60)),.54),g.x5=d(g.x5,u((g.x4<-s?-s:g.x4)*b(g.closing?.1:1,1,m,.2,1),b(0,12,g.x,0,60)),.54),(g.start||g.x<-60)&&(g.x2<g.x&&(g.x2=g.x),g.x3<g.x&&(g.x3=g.x),g.x4<g.x&&(g.x4=g.x),g.x5<g.x&&(g.x5=g.x)),g.x5=g.x4;var A=g.x<0?10/(-g.x)**.5:1;A>1&&(A=1);var Y=1/(A=.8+.2*A)*50*b(.9,1.3,f,0,.9),E=.06,C=50/A*1.2*2+b(2*w,5*w,m,.7,1)+180+(g.closing?1:.25)*b(w,6*w,m,0,.3)-(g.closing?b(b(0,130,m,0,E),0,m,0,.7):0)+b(b(0,200,m,E,.5),0,m,.3,.7),L=50/A*1.2*2+b(1.2*w,2*w,m,E,1)+b(2*w,3*w,m,.7,1)+20+(g.closing?1:.25)*b(0,6*w,m,0,1)-(g.closing?b(b(0,30,m,0,E),0,m,0,.7):0),F=50/A*1.2+b(1.2*w,2*w,m,E,1)+(g.closing?1:.3)*b(0,w*b(4,5,m,.25,.85),m,0,1)+(g.closing?b(b(0,17,m,0,E),0,m,0,.5):0),M=50/A/b(2,3,m,0,E)+w**.8+(g.closing?b(0,w/4,m,.8,1):0)+(g.closing?1:.3)*b(0,2*w,m,0,1)+(g.closing?1:.6)*b(b(0,13,m,0,E),0,m,0,.5),P=b(b(0,g.closing?20:-50,m,0,.7),0,m,.7,1),S=b(b(0,g.closing?50:-45,m,0,.7),0,m,.7,1)+(g.closing?1:0)*b(b(0,s**1.5/1500,m,0,E),0,m,0,1),_=50/7-b(b(0,g.closing?s/7:30,m,E,1),0,m,.7,1)+(g.closing?b(b(0,9,m,0,E),0,m,0,.3):0),j=s-6-Y+g.x,k=-6-Y-1,q=2.5*-k;var N=function(t){if(!g.closing)return b(t,t-k-12,m,.3,.7);var e=.08595*q;if(t<e){var n=(t-e)/k*(q/(q+e));return 2*(-(n**2)+n)*q+e}return t}(j);let $=[[s+200,v-o-100],[s-6+1*g.x5-P,v-o-100],[s-6+1*g.x5-P,v-o-100],[s-6+1*g.x5-P,v-C-b(500,700,m,0,.6)],[s-6+1*g.x5-P,v-C-b(300,500,m,0,.6)],[s-6+1*g.x5-P,v-C-b(200,300,m,0,.6)],[s-6+1*g.x5-P,v-C],[s-6+1*g.x4-S,v-L],[s-6-_+g.x2,v-F],[N,v-M],[N,v+M],[s-6-_+g.x2,v+F],[s-6+1*g.x4-S,v+L],[s-6+1*g.x5-P,v+C],[s-6+1*g.x5-P,v+C+b(100,300,m,0,.6)],[s-6+1*g.x5-P,v+C+b(300,500,m,0,.6)],[s-6+1*g.x5-P,v+C+b(500,700,m,0,.6)],[s-6+1*g.x5,v+o+100],[s-6+1*g.x5,v+o+100],[s+200,o+200]];var T=7,z=$.length,H=.05,W=b(-1,0,j,k/2,0)*b(0,-20,m,.6,.7);g.closing||(W=0),$[T][0]<$[T+1][0]&&($[T][0]=$[T+1][0]),$[T][0]=b($[T][0],$[T+1][0]-W,m,H,1),$[T-1][0]=b($[T-1][0],$[T+1][0]-W,m,H,1),$[T-2][0]=b($[T-2][0],$[T+1][0]-W,m,H,1),$[T-3][0]=b($[T-3][0],$[T+1][0]-W,m,H,1),$[T-4][0]=b($[T-4][0],$[T+1][0]-W,m,H,1),$[T=z-T-1][0]<$[T-1][0]&&($[T][0]=$[T-1][0]),$[T][0]=b($[T][0],$[T-1][0]-W,m,H,1),$[T+1][0]=b($[T+1][0],$[T-1][0]-W,m,H,1),$[T+2][0]=b($[T+2][0],$[T-1][0]-W,m,H,1),$[T+3][0]=b($[T+3][0],$[T-1][0]-W,m,H,1),$[T+4][0]=b($[T+4][0],$[T-1][0]-W,m,H,1),$[T=8][0]=$[T][0]+(g.closing?0:b(0,b(4,0,f,0,1),f,0,.3)),$[T=z-T-1][0]=$[T][0]+(g.closing?0:b(0,b(4,0,f,0,1),f,0,.3)),$=$.map((t,e)=>[t[0],o-t[1]]);const K=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))($,s,o,{yMin:0,yMax:o,xMin:0,xMax:s}),Z=a(K);h.getAttribute("d")!=Z&&(h.setAttributeNS(null,"d",Z),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),requestAnimationFrame(e)}catch(t){console.error(t)}var D,O}();var A=!1;function Y(t){if(A)return;let e,n;A=!0,setTimeout(()=>{A=!1},300),t.preventDefault(),t.stopPropagation();let r=t.composedPath(),i=g.obj.querySelector(".curtain-page");if(!(g.closed||!g.start||!g.obj.contains(r[0])||i&&i.contains(r[0]))){var a=c(t);e=a.x,n=a.y;var o=g.endX<=-s/2;if(o){if(e>40)return}else{if(!b(n,x-50,x+50))return;if(!b(e,s-50,s+50))return}return o&&X(),g.closing=!o,g.mousedown=!0,g.startX=o?s:e,g.startY=n,w(t),!0}}function E(t){let e,n;t.preventDefault(),t.stopPropagation();var r=c(t);if(e=r.x,n=r.y,g.mousedown){g.mousedown=!1;var i=!g.closing;g.closing&&(g.startX==e&&g.startY==n||Math.abs(g.startX-e)<3&&Math.abs(g.startY-n)<3)||g.endX-g.startX<(i?2*-s/3:-s/3)?(g.startX=0,g.endX=-s/1-3,g.next&&g.next(g),g.reversible||(g.closed=!0)):(g.startX=0,g.startY=0,g.endX=0,g.endY=0)}}return g.show=function(){g.start=!0,g.closing=!0},g.hide=function(){g.start=!1,g.closing=!1,g.mousedown=!1,g.startX=0,g.startY=0,g.endX=0,g.endY=0},g.endCurtain=E,document.addEventListener("mousedown",t=>{Y(t)&&document.addEventListener("mousemove",w)}),document.addEventListener("mouseup",t=>{E(t),document.removeEventListener("mousemove",w)}),document.addEventListener("touchstart",Y),document.addEventListener("touchend",(function(t){E(t)})),document.addEventListener("touchmove",w,{passive:!1}),g}}();function makeCurtains(wrapper){var children=Array.from(wrapper.children);children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),i==children.length-2?e.curtain.show():e.curtain.hide()}})}export{makeCurtains};