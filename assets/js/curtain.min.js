import{styler}from"./styler.min.js";var css=".curtain {pointer-events: none;position: absolute;z-index: 999;left: 0;top: 0;-webkit-transform-origin: top left;transform-origin: top left;}";styler("curtain-css",css);var makeCurtain=function(){var t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);e&&n&&t.match(/CriOS/i);const r=(t,e,n,r,i)=>(t-e)*(i-r)/(n-e)+r;function i(t){var e,n=new Array,r=new Array,i=t.length-1,o=new Array,a=new Array,s=new Array,c=new Array;o[0]=0,a[0]=2,s[0]=1,c[0]=t[0]+2*t[1];for(var u=1;u<i-1;u++)o[u]=1,a[u]=4,s[u]=1,c[u]=4*t[u]+2*t[u+1];for(o[i-1]=2,a[i-1]=7,s[i-1]=0,c[i-1]=8*t[i-1]+t[i],u=1;u<i;u++)e=o[u]/a[u-1],a[u]=a[u]-e*s[u-1],c[u]=c[u]-e*c[u-1];for(n[i-1]=c[i-1]/a[i-1],u=i-2;u>=0;--u)n[u]=(c[u]-s[u]*n[u+1])/a[u];for(u=0;u<i-1;u++)r[u]=2*t[u+1]-n[u+1];return r[i-1]=.5*(t[i]+n[i-1]),{p1:n,p2:r}}const o=t=>function(t){for(var e=t.length,n=new Array,r=new Array,o=0;o<e;o++)n[o]=t[o][0],r[o]=t[o][1];var a,s,c,u,d,l,x,p,v=i(n),m=i(r),f=[];for(o=0;o<e-1;o++)f.push((a=n[o],s=r[o],c=v.p1[o],u=m.p1[o],d=v.p2[o],l=m.p2[o],x=n[o+1],p=r[o+1],a.toFixed(3)+" "+s.toFixed(3)+" C "+c.toFixed(3)+" "+u.toFixed(3)+" "+d.toFixed(3)+" "+l.toFixed(3)+" "+x.toFixed(3)+" "+p.toFixed(3)));return"M "+f.join(" L ")+" Z"}(t);var a,s,c=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e};function u(t,e){return t>e?e:t}function d(t,e,n){return(e-t)*n+t}function l(){a=window.innerHeight,s=window.innerWidth,.01*window.innerHeight,.01*window.innerWidth}l();var x=function(t){l()};window.attachEvent?window.attachEvent("onresize",x):window.addEventListener&&window.addEventListener("resize",x,!0);var p=0;var v={start_ended:!0,closed:!1,start:!1,closing:!0,reversible:!0,but_y_pos:.25,startX:141,startY:51,next:function(t){var e=t.obj;setTimeout((function(){var t=e.querySelector(".curtain-page");t&&t.curtain.show()}),t.opened?0:500)}};return function(t,e){e=e||{};var n="http://www.w3.org/2000/svg",i="curtainClip-"+(p+=1),l=document.createElement("span");l.classList.add("arrow");var x,m=document.createElementNS(n,"svg"),f=document.createElementNS(n,"path"),g=document.createElementNS(n,"clipPath");g.id=i,m.appendChild(g),m.appendChild(document.createElementNS(n,"g")),g.appendChild(f),f.setAttribute("fill","#9300bb"),m.classList.add("curtain"),document.body.appendChild(m),document.body.appendChild(l);var h=Object.assign({},v,e);h.curtain=m,h.path_dom=f,h.endX=h.startX,h.endY=h.startY,h.mousedown=!1;const y=function(){var e="url(#"+i+")";t.style.clipPath!=e&&(t.style.clipPath=e,t.style.webkitClipPath=e)};function w(t){if(h.mousedown){var e=c(t);h.endX=e.x,h.endY=e.y}}function b(t,e,n){return t<n&&t>e}function A(){t.querySelectorAll(".curtain-page").forEach(t=>t.curtain.hide())}y(),h.closed&&(h.startX=0,h.startY=0,h.endX=0,h.endY=0),t.curtain=h,g.curtain=h,h.obj=t,setTimeout((function(t){h.start_ended=!0}),1e3),m.setAttribute("width",s),m.setAttribute("height",a),m.setAttribute("viewbox",`0 0 ${s} ${a}`),h.x=h.startX,h.y=h.startY,h.x2=12,h.y2=h.startY,h.x3=12,h.y3=h.startY,h.x4=12,h.y4=h.startY,h.x5=12,h.y5=h.startY,function e(){try{h.active=!1;var n=h.endX-h.startX,i=h.endY-h.startY,c=Math.abs(n-h.x)<1e-5;if(!h.start&&h.x>=56)return t.style.display="none",void requestAnimationFrame(e);if(h.x<-s&&!h.mousedown)return requestAnimationFrame(e),void(""!=t.style.clipPath&&(t.style.clipPath="",t.style.webkitClipPath=""));if(c)return void requestAnimationFrame(e);"none"==t.style.display&&(t.style.display=""),h.active=!0,y(),h.start_ended&&n>0&&(n=0),x=a*(1-h.but_y_pos);var l=(D=0)>(O=a-x-125)?D:O;i>l&&(i=l);var p=u(0,125-x);i<p&&(i=p),h.x>-30&&A(),!h.start&&h.x>-1&&(n=60),n<-s/1-5&&(n=-s/1-5),h.x=d(h.x,n,.09),h.y=d(h.y,i,.09);var v=x+h.y,m=-h.x/s;m<0&&(m=0),m>1&&(m=1);var g=-h.x/u(500,s);g<0&&(g=0),g>1&&(g=1);var w=60*(g=m);function b(t,e,n,r,i){return n-r>0?((n=(n-r)/(i-r))>1&&(n=1),n<0&&(n=0),t*(1-n)+e*n):t}h.x2=d(h.x2,u(h.x<-s?-s:h.x,b(0,18,h.x,0,60)),.54),h.x3=d(h.x3,u((h.x2<-s?-s:h.x2)*b(h.closing?.1:1,1,m,.2,1),b(0,12,h.x,0,60)),.54),h.x4=d(h.x4,u((h.x3<-s?-s:h.x3)*b(h.closing?.1:1,1,m,.2,1),b(0,12,h.x,0,60)),.54),h.x5=d(h.x5,u((h.x4<-s?-s:h.x4)*b(h.closing?.1:1,1,m,.2,1),b(0,12,h.x,0,60)),.54),(h.start||h.x<-60)&&(h.x2<h.x&&(h.x2=h.x),h.x3<h.x&&(h.x3=h.x),h.x4<h.x&&(h.x4=h.x),h.x5<h.x&&(h.x5=h.x)),h.x5=h.x4;var X=h.x<0?10/(-h.x)**.5:1;X>1&&(X=1);var E=1/(X=.8+.2*X)*50*b(.9,1.3,g,0,.9),Y=.06,C=50/X*1.2*2+b(2*w,5*w,m,.7,1)+180+(h.closing?1:.25)*b(w,6*w,m,0,.3)-(h.closing?b(b(0,130,m,0,Y),0,m,0,.7):0)+b(b(0,200,m,Y,.5),0,m,.3,.7),L=50/X*1.2*2+b(1.2*w,2*w,m,Y,1)+b(2*w,3*w,m,.7,1)+20+(h.closing?1:.25)*b(0,6*w,m,0,1)-(h.closing?b(b(0,30,m,0,Y),0,m,0,.7):0),F=50/X*1.2+b(1.2*w,2*w,m,Y,1)+(h.closing?1:.3)*b(0,w*b(4,5,m,.25,.85),m,0,1)+(h.closing?b(b(0,17,m,0,Y),0,m,0,.5):0),P=50/X/b(2,3,m,0,Y)+w**.8+(h.closing?b(0,w/4,m,.8,1):0)+(h.closing?1:.3)*b(0,2*w,m,0,1)+(h.closing?1:.6)*b(b(0,13,m,0,Y),0,m,0,.5),M=b(b(0,h.closing?20:-50,m,0,.7),0,m,.7,1),S=b(b(0,h.closing?50:-45,m,0,.7),0,m,.7,1)+(h.closing?1:0)*b(b(0,s**1.5/1500,m,0,Y),0,m,0,1),_=50/7-b(b(0,h.closing?s/7:30,m,Y,1),0,m,.7,1)+(h.closing?b(b(0,9,m,0,Y),0,m,0,.3):0),j=s-6-E+h.x,k=-6-E-1,q=2.5*-k;var N=function(t){if(!h.closing)return b(t,t-k-12,m,.3,.7);var e=.08595*q;if(t<e){var n=(t-e)/k*(q/(q+e));return 2*(-(n**2)+n)*q+e}return t}(j);let $=[[s+200,v-a-100],[s-6+1*h.x5-M,v-a-100],[s-6+1*h.x5-M,v-a-100],[s-6+1*h.x5-M,v-C-b(500,700,m,0,.6)],[s-6+1*h.x5-M,v-C-b(300,500,m,0,.6)],[s-6+1*h.x5-M,v-C-b(200,300,m,0,.6)],[s-6+1*h.x5-M,v-C],[s-6+1*h.x4-S,v-L],[s-6-_+h.x2,v-F],[N,v-P],[N,v+P],[s-6-_+h.x2,v+F],[s-6+1*h.x4-S,v+L],[s-6+1*h.x5-M,v+C],[s-6+1*h.x5-M,v+C+b(100,300,m,0,.6)],[s-6+1*h.x5-M,v+C+b(300,500,m,0,.6)],[s-6+1*h.x5-M,v+C+b(500,700,m,0,.6)],[s-6+1*h.x5,v+a+100],[s-6+1*h.x5,v+a+100],[s+200,a+200]];var T=7,z=$.length,H=.05,W=b(-1,0,j,k/2,0)*b(0,-20,m,.6,.7);h.closing||(W=0),$[T][0]<$[T+1][0]&&($[T][0]=$[T+1][0]),$[T][0]=b($[T][0],$[T+1][0]-W,m,H,1),$[T-1][0]=b($[T-1][0],$[T+1][0]-W,m,H,1),$[T-2][0]=b($[T-2][0],$[T+1][0]-W,m,H,1),$[T-3][0]=b($[T-3][0],$[T+1][0]-W,m,H,1),$[T-4][0]=b($[T-4][0],$[T+1][0]-W,m,H,1),$[T=z-T-1][0]<$[T-1][0]&&($[T][0]=$[T-1][0]),$[T][0]=b($[T][0],$[T-1][0]-W,m,H,1),$[T+1][0]=b($[T+1][0],$[T-1][0]-W,m,H,1),$[T+2][0]=b($[T+2][0],$[T-1][0]-W,m,H,1),$[T+3][0]=b($[T+3][0],$[T-1][0]-W,m,H,1),$[T+4][0]=b($[T+4][0],$[T-1][0]-W,m,H,1),$[T=8][0]=$[T][0]+(h.closing?0:b(0,b(4,0,g,0,1),g,0,.3)),$[T=z-T-1][0]=$[T][0]+(h.closing?0:b(0,b(4,0,g,0,1),g,0,.3)),$=$.map((t,e)=>[t[0],a-t[1]]);const K=((t,e,n,i)=>t.map(t=>[r(t[0],i.xMin,i.xMax,0,e),r(t[1],i.yMin,i.yMax,n,0)]))($,s,a,{yMin:0,yMax:a,xMin:0,xMax:s}),Z=o(K);f.getAttribute("d")!=Z&&(f.setAttributeNS(null,"d",Z),t.style.display="inline-flex",t.offsetHeight,t.style.display="flex"),requestAnimationFrame(e)}catch(t){console.error(t)}var D,O}();var X=!1;function E(t){if(X)return;let e,n;X=!0,setTimeout(()=>{X=!1},300),t.preventDefault(),t.stopPropagation();let r=t.composedPath(),i=h.obj.querySelector(".curtain-page");if(!(h.closed||!h.start||!h.obj.contains(r[0])||i&&i.contains(r[0]))){var o=c(t);e=o.x,n=o.y;var a=h.endX<=-s/2;if(a){if(e>40)return}else{if(!b(n,x-50,x+50))return;if(!b(e,s-50,s+50))return}return a&&A(),h.closing=!a,h.mousedown=!0,h.startX=a?s:e,h.startY=n,w(t),!0}}function Y(t){let e,n;t.preventDefault(),t.stopPropagation();var r=c(t);if(e=r.x,n=r.y,h.mousedown){h.mousedown=!1;var i=!h.closing;h.closing&&h.startX==e&&h.startY==n||h.endX-h.startX<(i?2*-s/3:-s/3)?(h.startX=0,h.endX=-s/1-3,h.next&&h.next(h),h.reversible||(h.closed=!0)):(h.startX=0,h.startY=0,h.endX=0,h.endY=0)}}return h.show=function(){h.start=!0,h.closing=!0},h.hide=function(){h.start=!1,h.closing=!1,h.mousedown=!1,h.startX=0,h.startY=0,h.endX=0,h.endY=0},h.endCurtain=Y,document.addEventListener("mousedown",t=>{E(t)&&document.addEventListener("mousemove",w)}),document.addEventListener("mouseup",t=>{Y(t),document.removeEventListener("mousemove",w)}),document.addEventListener("touchstart",E),document.addEventListener("touchend",(function(t){Y(t)})),document.addEventListener("touchmove",w,{passive:!1}),h}}();function makeCurtains(wrapper){var children=Array.from(wrapper.children);children.reverse(),children.forEach((e,i)=>{if(children[i+1]){var config=e.getAttribute("curtain-config")||"{}";config=eval("("+config+")"),children[i+1].appendChild(e),e.classList.add("curtain-page"),makeCurtain(e,config),i==children.length-2?e.curtain.show():e.curtain.hide()}})}export{makeCurtains};